<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>LBANN: lbann::dropout Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
  <div class="navpath"><a class="el" href="namespacelbann.html">lbann</a>::<a class="el" href="classlbann_1_1dropout.html">dropout</a>
  </div>
<div class="contents">
<h1>lbann::dropout Class Reference</h1><!-- doxytag: class="lbann::dropout" --><!-- doxytag: inherits="lbann::regularizer" -->
<p><code>#include &lt;<a class="el" href="lbann__dropout_8hpp_source.html">lbann_dropout.hpp</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for lbann::dropout:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1dropout__inherit__graph.png" border="0" usemap="#lbann_1_1dropout_inherit__map" alt="Inheritance graph"/></div>
<map name="lbann_1_1dropout_inherit__map" id="lbann_1_1dropout_inherit__map">
<area shape="rect" id="node2" href="classlbann_1_1regularizer.html" title="lbann::regularizer" alt="" coords="5,5,125,35"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for lbann::dropout:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1dropout__coll__graph.png" border="0" usemap="#lbann_1_1dropout_coll__map" alt="Collaboration graph"/></div>
<map name="lbann_1_1dropout_coll__map" id="lbann_1_1dropout_coll__map">
<area shape="rect" id="node2" href="classlbann_1_1regularizer.html" title="lbann::regularizer" alt="" coords="124,197,244,227"/><area shape="rect" id="node4" href="classlbann_1_1Layer.html" title="lbann::Layer" alt="" coords="169,101,263,131"/><area shape="rect" id="node6" href="classlbann_1_1lbann__comm.html" title="lbann::lbann_comm" alt="" coords="5,5,139,35"/><area shape="rect" id="node8" href="classlbann_1_1Optimizer.html" title="lbann::Optimizer" alt="" coords="163,5,280,35"/><area shape="rect" id="node10" href="classlbann_1_1Activation.html" title="lbann::Activation" alt="" coords="304,5,421,35"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="classlbann_1_1dropout-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1dropout.html#ac7df0dc7dd229a22c33141923496c363">dropout</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="classlbann_1_1dropout.html#a8d771ad4215b0235d3270a71ca8bd33e">comm</a>, float keep_prob=0.5f)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1dropout.html#a7c33aee6cc1323496120bb545cd27148">fp_activations</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1dropout.html#a9b1ecd42b39fb914cfb04fde2278e8ed">bp_activations</a> ()</td></tr>
<tr><td colspan="2"><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1dropout.html#a8d771ad4215b0235d3270a71ca8bd33e">comm</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1dropout.html#a2b4540ea622609b518d691d68e6db92c">m_keep_prob</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1dropout.html#ae30b20d94307f03aa6743c46b98eef50">m_cur_mask</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Dropout: probabilistically drop units from a layer. See this paper for full details: Srivastava, Nitish, et al. "Dropout: a simple way to prevent neural networks
 from overfitting." Journal of Machine Learning Research 15.1 (2014). This implementation uses the approach noted in section 10 of that paper of multiplying weights by 1/(keep probability) at training time and not modifying them at test time. The implementation recommends a keep probability of 0.5 for fully-connected layers and 0.8 for input layers as good starting points. </p>

<p>Definition at line <a class="el" href="lbann__dropout_8hpp_source.html#l00047">47</a> of file <a class="el" href="lbann__dropout_8hpp_source.html">lbann_dropout.hpp</a>.</p>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ac7df0dc7dd229a22c33141923496c363"></a><!-- doxytag: member="lbann::dropout::dropout" ref="ac7df0dc7dd229a22c33141923496c363" args="(lbann_comm *comm, float keep_prob=0.5f)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">lbann::dropout::dropout </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&nbsp;</td>
          <td class="paramname"> <em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>keep_prob</em> = <code>0.5f</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Keep units with probabiliy keep_prob. </p>

<p>Definition at line <a class="el" href="lbann__dropout_8cpp_source.html#l00037">37</a> of file <a class="el" href="lbann__dropout_8cpp_source.html">lbann_dropout.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00037"></a>00037                                                   :
<a name="l00038"></a>00038   <a class="code" href="classlbann_1_1dropout.html#a8d771ad4215b0235d3270a71ca8bd33e">comm</a>(<a class="code" href="classlbann_1_1dropout.html#a8d771ad4215b0235d3270a71ca8bd33e">comm</a>), <a class="code" href="classlbann_1_1dropout.html#a2b4540ea622609b518d691d68e6db92c">m_keep_prob</a>(keep_prob)
<a name="l00039"></a>00039 <span class="preprocessor">#ifdef LBANN_PROCDET_DROPOUT</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span>  , <a class="code" href="classlbann_1_1dropout.html#ae30b20d94307f03aa6743c46b98eef50">m_cur_mask</a>(<a class="code" href="classlbann_1_1dropout.html#a8d771ad4215b0235d3270a71ca8bd33e">comm</a>-&gt;get_model_grid())
<a name="l00041"></a>00041 #endif
<a name="l00042"></a>00042 {}

</pre></div></p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a9b1ecd42b39fb914cfb04fde2278e8ed"></a><!-- doxytag: member="lbann::dropout::bp_activations" ref="a9b1ecd42b39fb914cfb04fde2278e8ed" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::dropout::bp_activations </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Adjust gradients for <a class="el" href="classlbann_1_1dropout.html">dropout</a> in backprop. </p>

<p>Reimplemented from <a class="el" href="classlbann_1_1regularizer.html#a520fb6e3ff605f4c5c6de7eda003f0aa">lbann::regularizer</a>.</p>

<p>Definition at line <a class="el" href="lbann__dropout_8cpp_source.html#l00086">86</a> of file <a class="el" href="lbann__dropout_8cpp_source.html">lbann_dropout.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00086"></a>00086                              {
<a name="l00087"></a>00087   <span class="comment">// Terminate early if dropout is disabled</span>
<a name="l00088"></a>00088   <span class="keywordflow">if</span> (<a class="code" href="classlbann_1_1regularizer.html#a6d0d44f4f9a3c8c24d0acdda8cf7d4b5">m_layer</a>-&gt;m_execution_mode != <a class="code" href="lbann__base_8hpp.html#a2781a159088df64ed7d47cc91c4dc0a8aef839bdee87b9298d9be97d3f9c90469">execution_mode::training</a>
<a name="l00089"></a>00089       || <a class="code" href="classlbann_1_1dropout.html#a2b4540ea622609b518d691d68e6db92c">m_keep_prob</a> &lt; 0.0f) <span class="keywordflow">return</span>;
<a name="l00090"></a>00090 
<a name="l00091"></a>00091 <span class="preprocessor">#ifdef LBANN_PROCDET_DROPOUT</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span>  Hadamard(*(<a class="code" href="classlbann_1_1regularizer.html#a6d0d44f4f9a3c8c24d0acdda8cf7d4b5">m_layer</a>-&gt;Ds), <a class="code" href="classlbann_1_1dropout.html#ae30b20d94307f03aa6743c46b98eef50">m_cur_mask</a>, *(<a class="code" href="classlbann_1_1regularizer.html#a6d0d44f4f9a3c8c24d0acdda8cf7d4b5">m_layer</a>-&gt;Ds));
<a name="l00093"></a>00093 <span class="preprocessor">#else</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span>  <span class="comment">// Re-weight the incoming loss using dropout mask</span>
<a name="l00095"></a>00095   <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> local_Ds = <a class="code" href="classlbann_1_1regularizer.html#a6d0d44f4f9a3c8c24d0acdda8cf7d4b5">m_layer</a>-&gt;Ds-&gt;Matrix();
<a name="l00096"></a>00096   Hadamard(local_Ds, <a class="code" href="classlbann_1_1dropout.html#ae30b20d94307f03aa6743c46b98eef50">m_cur_mask</a>, local_Ds);
<a name="l00097"></a>00097 <span class="preprocessor">#endif  // LBANN_PROCDET_DROPOUT</span>
<a name="l00098"></a>00098 <span class="preprocessor"></span>}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7c33aee6cc1323496120bb545cd27148"></a><!-- doxytag: member="lbann::dropout::fp_activations" ref="a7c33aee6cc1323496120bb545cd27148" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::dropout::fp_activations </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Drop out units in forward propagation. </p>

<p>Reimplemented from <a class="el" href="classlbann_1_1regularizer.html#a8006f575c31fd152d2f048d50994e9f6">lbann::regularizer</a>.</p>

<p>Definition at line <a class="el" href="lbann__dropout_8cpp_source.html#l00044">44</a> of file <a class="el" href="lbann__dropout_8cpp_source.html">lbann_dropout.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00044"></a>00044                              {
<a name="l00045"></a>00045   <span class="comment">// Terminate early if dropout is disabled</span>
<a name="l00046"></a>00046   <span class="keywordflow">if</span> (<a class="code" href="classlbann_1_1regularizer.html#a6d0d44f4f9a3c8c24d0acdda8cf7d4b5">m_layer</a>-&gt;m_execution_mode != <a class="code" href="lbann__base_8hpp.html#a2781a159088df64ed7d47cc91c4dc0a8aef839bdee87b9298d9be97d3f9c90469">execution_mode::training</a>
<a name="l00047"></a>00047       || <a class="code" href="classlbann_1_1dropout.html#a2b4540ea622609b518d691d68e6db92c">m_keep_prob</a> &lt; 0.0f) <span class="keywordflow">return</span>;
<a name="l00048"></a>00048 
<a name="l00049"></a>00049   <span class="comment">// Get local activations</span>
<a name="l00050"></a>00050   <a class="code" href="lbann__base_8hpp.html#afad88fb587c304caea8a36ee5a5c1df8">ElMat</a>* acts = <a class="code" href="classlbann_1_1regularizer.html#a6d0d44f4f9a3c8c24d0acdda8cf7d4b5">m_layer</a>-&gt;Acts;
<a name="l00051"></a>00051   <span class="keyword">const</span> Int local_height = acts-&gt;LocalHeight();
<a name="l00052"></a>00052   <span class="keyword">const</span> Int local_width = acts-&gt;LocalWidth();
<a name="l00053"></a>00053   <span class="keyword">const</span> Int global_height = acts-&gt;Height();
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="preprocessor">#ifdef LBANN_PROCDET_DROPOUT</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span>  <a class="code" href="namespacelbann.html#a6add4d3337110d567e7b398a262fd010">bernoulli_fill_procdet</a>(<a class="code" href="classlbann_1_1dropout.html#ae30b20d94307f03aa6743c46b98eef50">m_cur_mask</a>, acts-&gt;Height(), acts-&gt;Width(),
<a name="l00057"></a>00057                          <a class="code" href="classlbann_1_1dropout.html#a2b4540ea622609b518d691d68e6db92c">m_keep_prob</a>);
<a name="l00058"></a>00058   <a class="code" href="classlbann_1_1dropout.html#ae30b20d94307f03aa6743c46b98eef50">m_cur_mask</a> *= 1.0 / <a class="code" href="classlbann_1_1dropout.html#a2b4540ea622609b518d691d68e6db92c">m_keep_prob</a>;
<a name="l00059"></a>00059   <span class="keywordflow">if</span> (acts-&gt;GlobalRow(local_height - 1) == global_height - 1) {
<a name="l00060"></a>00060     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> col = 0; col &lt; local_width; ++col) {
<a name="l00061"></a>00061       m_cur_mask.SetLocal(local_height - 1, col, 1.0f);
<a name="l00062"></a>00062     }
<a name="l00063"></a>00063   }
<a name="l00064"></a>00064   Hadamard(*acts, m_cur_mask, *acts);
<a name="l00065"></a>00065 <span class="preprocessor">#else</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span>  <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> local_acts = acts-&gt;Matrix();
<a name="l00067"></a>00067 
<a name="l00068"></a>00068   <span class="comment">// Construct dropout mask</span>
<a name="l00069"></a>00069   <span class="comment">// Note: Construct Bernoulli matrix and scale by</span>
<a name="l00070"></a>00070   <span class="comment">//   1/m_keep_prob. Entries corresponding to bias row are set to 1</span>
<a name="l00071"></a>00071   <span class="comment">//   to ensure that mask doesn&apos;t affect bias row. This</span>
<a name="l00072"></a>00072   <span class="comment">//   implementation assumes &apos;acts&apos; is in MC,MR; Star,VC; Star,VR; or</span>
<a name="l00073"></a>00073   <span class="comment">//   similar format.</span>
<a name="l00074"></a>00074   Bernoulli(m_cur_mask, local_height, local_width, <a class="code" href="classlbann_1_1dropout.html#a2b4540ea622609b518d691d68e6db92c">m_keep_prob</a>);
<a name="l00075"></a>00075   m_cur_mask *= 1.0 / <a class="code" href="classlbann_1_1dropout.html#a2b4540ea622609b518d691d68e6db92c">m_keep_prob</a>;
<a name="l00076"></a>00076   <span class="keywordflow">if</span> (acts-&gt;GlobalRow(local_height - 1) == global_height - 1) {
<a name="l00077"></a>00077     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> col = 0; col &lt; local_width; ++col) {
<a name="l00078"></a>00078       m_cur_mask.Set(local_height - 1, col, 1.0f);
<a name="l00079"></a>00079     }
<a name="l00080"></a>00080   }
<a name="l00081"></a>00081   <span class="comment">// Apply dropout mask to local activations</span>
<a name="l00082"></a>00082   Hadamard(local_acts, m_cur_mask, local_acts);
<a name="l00083"></a>00083 <span class="preprocessor">#endif  // LBANN_PROCDET_DROPOUT</span>
<a name="l00084"></a>00084 <span class="preprocessor"></span>}
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1dropout_a7c33aee6cc1323496120bb545cd27148_cgraph.png" border="0" usemap="#classlbann_1_1dropout_a7c33aee6cc1323496120bb545cd27148_cgraph_map" alt=""></div>
<map name="classlbann_1_1dropout_a7c33aee6cc1323496120bb545cd27148_cgraph_map" id="classlbann_1_1dropout_a7c33aee6cc1323496120bb545cd27148_cgraph">
<area shape="rect" id="node3" href="namespacelbann.html#a6add4d3337110d567e7b398a262fd010" title="lbann::bernoulli_fill_procdet" alt="" coords="248,5,427,35"/></map>
</div>
</p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a8d771ad4215b0235d3270a71ca8bd33e"></a><!-- doxytag: member="lbann::dropout::comm" ref="a8d771ad4215b0235d3270a71ca8bd33e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a>* <a class="el" href="classlbann_1_1dropout.html#a8d771ad4215b0235d3270a71ca8bd33e">lbann::dropout::comm</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lbann__dropout_8hpp_source.html#l00056">56</a> of file <a class="el" href="lbann__dropout_8hpp_source.html">lbann_dropout.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="ae30b20d94307f03aa6743c46b98eef50"></a><!-- doxytag: member="lbann::dropout::m_cur_mask" ref="ae30b20d94307f03aa6743c46b98eef50" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> <a class="el" href="classlbann_1_1dropout.html#ae30b20d94307f03aa6743c46b98eef50">lbann::dropout::m_cur_mask</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Current <a class="el" href="classlbann_1_1dropout.html">dropout</a> mask (a scaled Bernoulli random matrix). </p>

<p>Definition at line <a class="el" href="lbann__dropout_8hpp_source.html#l00064">64</a> of file <a class="el" href="lbann__dropout_8hpp_source.html">lbann_dropout.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a2b4540ea622609b518d691d68e6db92c"></a><!-- doxytag: member="lbann::dropout::m_keep_prob" ref="a2b4540ea622609b518d691d68e6db92c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float <a class="el" href="classlbann_1_1dropout.html#a2b4540ea622609b518d691d68e6db92c">lbann::dropout::m_keep_prob</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Probability of keeping each unit. </p>

<p>Definition at line <a class="el" href="lbann__dropout_8hpp_source.html#l00058">58</a> of file <a class="el" href="lbann__dropout_8hpp_source.html">lbann_dropout.hpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>include/lbann/regularization/<a class="el" href="lbann__dropout_8hpp_source.html">lbann_dropout.hpp</a></li>
<li>src/regularization/<a class="el" href="lbann__dropout_8cpp_source.html">lbann_dropout.cpp</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 21 Sep 2016 for LBANN by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
