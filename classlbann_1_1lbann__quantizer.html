<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>LBANN: lbann::lbann_quantizer Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
  <div class="navpath"><a class="el" href="namespacelbann.html">lbann</a>::<a class="el" href="classlbann_1_1lbann__quantizer.html">lbann_quantizer</a>
  </div>
<div class="contents">
<h1>lbann::lbann_quantizer Class Reference</h1><!-- doxytag: class="lbann::lbann_quantizer" -->
<p><code>#include &lt;<a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>&gt;</code></p>

<p><a href="classlbann_1_1lbann__quantizer-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public Types</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef uint32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#aad6499ee349e94a461538a8e4f867048">qtype</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef El::Matrix&lt; <a class="el" href="classlbann_1_1lbann__quantizer.html#aad6499ee349e94a461538a8e4f867048">qtype</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef std::vector&lt; <a class="el" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a></td></tr>
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a430cd47f333c678d2cb77f4ab2693914">lbann_quantizer</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ac0cc07008ff963949c2cb7b91786c61c">~lbann_quantizer</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a3801d9cd1a1adefb160b69dbd7e499ef">quantize</a> (const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> &amp;qmat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, bool sample=true)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#aa516ede3d1fd798bb5ef5c2cf28cb53d">quantize</a> (const <a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;mat, <a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> &amp;qmat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, bool sample=true)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a8eb42b16ff79799e3e81733b7921a789">unquantize</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> &amp;qmat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, bool apply=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a20ab13e61298782c5c3280f81d66da69">unquantize</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> &amp;qmat, <a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;mat, bool apply=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a97db186341c0819c8d52e2f815deb2a7">intermodel_sum_quantized</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;im_qerror, bool do_adagrad=false, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> *gradhist=nullptr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a4877befb2683f16a03fdf91ed1353636">intermodel_sum_quantized</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;im_qerror, bool do_adagrad=false, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> *gradhist=nullptr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a0e271e3f75667540f5bde94fbcd3ef0e">intermodel_sum_quantized2</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;im_qerror)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a35ca3e61f358ccb63c233d85236dfec1">intermodel_sum_quantized2</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;im_qerror)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a00106e69ea8a6dfe9e9a91c75b845bcd">threshold_quantize</a> (const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_thresh, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_thresh, bool delta=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ae9949af6bec1e95adf5a32ba9bb4afd8">threshold_quantize</a> (const <a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;mat, <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_thresh, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_thresh, bool delta=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a0f5f3b0149715ab59202b8884a87c7d5">threshold_unquantize</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_thresh, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_thresh, bool delta=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a2324bba3cbb6c0d3e51bbe21555e7f1a">threshold_unquantize</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_thresh, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_thresh, bool delta=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a8b920e254dcdc72b5a4785c740389dfe">adaptive_threshold_quantize</a> (const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, int proportion, bool delta=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ac625cd41e898ab531ecbcdd864e0748e">adaptive_threshold_quantize</a> (const <a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;mat, <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, int proportion, bool delta=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a28e08719534c503f452f7627d9c9c400">adaptive_threshold_unquantize</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, bool delta=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#af9898a10cf9b2ea13ed2a7484bd2199d">adaptive_threshold_unquantize</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;mat, bool delta=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a4cf9d4cd5262b21939e95fc34ad0a09f">intermodel_sum_threshold_quantized</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_thresh, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_thresh, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;im_qerror, bool compress=true)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ae99dc11003cecd04e599d68c99d90c0b">intermodel_sum_threshold_quantized</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_thresh, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_thresh, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;im_qerror, bool compress=true)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a28e74da8473ea1b475ff3976676898c4">intermodel_sum_adaptive_threshold_quantized</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, int proportion, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;im_qerror, bool compress=true)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#acf0864e7c687806af3155655a33ed364">intermodel_sum_adaptive_threshold_quantized</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, int proportion, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;im_qerror, bool compress=true)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ad8d07c3ffddff08800887dff354ffed2">compress_thresholds</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;cq)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a6e75d7f48c309ed184c4de0b9e56c4bb">compress_adaptive_thresholds</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;cq)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#afb58d63b174c3a937f3c3b21eb269b77">uncompress_thresholds</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;cq, <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a02e4bdf26d23de079d763300e71488f1">uncompress_adaptive_thresholds</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;cq, <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::tuple&lt; <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>, <br class="typebreak"/>
<a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a621ce88c0a961cfdb00c94ab24d659e0">proportion_threshold_average</a> (const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, int proportion, int col, bool sample=true)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ad318aefe6f75c8d68363affce55f6190">get_bytes_sent</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a2c1b69b38cf93d43e9b4eca7d4c5e28f">get_rs_bytes_sent</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a6c64c6960852ca25f81ba7bc80c05d2d">get_ag_bytes_sent</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a9a029f692e679ac4475a51fa2ac8f7c1">get_bytes_received</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#aeefaa02ea30dc89f58420e019950207f">get_rs_bytes_received</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a9befb796840b21d1238e8169421005f9">get_ag_bytes_received</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#afa32b747b7ac0dbea8df3b47593d54b7">reset_bytes_counters</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a4484f37237d53c4992d00698b72fd45f">get_rs_time</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#affd6ee0a9c259ba5999c8f18ee7a58a7">get_ag_time</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#aea9f348cd6f48b706870e1a5e48e8827">get_rs_send_trans_time</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a12b8e87e51866a6b028b8dbd4faebe55">get_rs_recv_buf_time</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ae5f4f573c3ed285265e9d7834446b3a0">get_rs_recv_trans_time</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a983b603f83ebdaee5eb924ca0d6495b9">get_ag_reduced_trans_time</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a54a63a467a16d24c12010edcf8b28f03">get_ag_recv_buf_time</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#aebc22819c53ce8a836bd20e938f6c59e">get_ag_recv_trans_time</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#aa205ee6fd0695d248d412bdaa9b8a9c1">get_pta_time</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#af520ee89ffb0419f5e4a9cf96d400744">get_pta_pos_time</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#abdba3762c51a2820f70adba32169f57b">reset_time_counters</a> ()</td></tr>
<tr><td colspan="2"><h2>Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a52820f8b0868a7f8f3a57ade0c663c3c">get_quantized_matrix_height</a> (const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a94d55b41dd60582f4412d5e24a0eeffe">threshold_unquantize_apply</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_thresh, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_thresh, std::vector&lt; unsigned &gt; &amp;positions, bool delta=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a8871704ae757f1bd83f3948d61b1cdad">threshold_quantize_apply</a> (const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_thresh, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_thresh, std::vector&lt; unsigned &gt; &amp;positions, bool delta=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a888effd26dfa024c28f591dda74bd464">adaptive_threshold_unquantize_add</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, bool delta=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ac24afa148151301903c24d86dcdc209c">compress_thresholds</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, ThreshQuantized::const_iterator qstart, <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;cq)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a37d6f4d5b8d990d8ceaedfaec1f58152">uncompress_thresholds</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;cq, ThreshQuantized::const_iterator cqstart, <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q)</td></tr>
<tr><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr><td class="memTemplItemLeft" align="right" valign="top">void&nbsp;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a6a8c8dac0d77378291de4b8703d404ab">intermodel_ring_reduce_scatter</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, bool var_recv, std::function&lt; T *(<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;, IR, IR, int &amp;)&gt; send_trans, std::function&lt; T *(<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;, int &amp;)&gt; get_recv_buf, std::function&lt; void(T *, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;)&gt; recv_trans)</td></tr>
<tr><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr><td class="memTemplItemLeft" align="right" valign="top">void&nbsp;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a4338c9a5afac7e660acf5073efa7ffb0">intermodel_ring_allgather</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, bool var_recv, std::function&lt; void(<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;)&gt; reduced_trans, std::function&lt; T *(int &amp;)&gt; get_send_buf, std::function&lt; T *(<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;, int &amp;)&gt; get_recv_buf, std::function&lt; void(T *, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;)&gt; recv_trans, std::function&lt; void(T *, T *)&gt; swap_bufs)</td></tr>
<tr><td colspan="2"><h2>Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a484e392b671e8eeaa3af5b5faa683bee">rs_bytes_sent</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a3a9e25785189c84ba5a7fe055382ca92">ag_bytes_sent</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a9b02b1adbc432e0d5b417ad6e098ed75">rs_bytes_received</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ae29843bccd4f211f36f4dd357a066a5d">ag_bytes_received</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#aa25d9dbcc7af16370142f46a6c23d178">rs_time</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a4d3c330826fbaff8ee38f4b05cafa84a">ag_time</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a824b8b6d8964621e6a02aee94c38332a">rs_send_trans_time</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a7fa4275835362b7d9ec91201f4f73436">rs_recv_buf_time</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a81db6fb79472d86023dd470c2948ea5a">rs_recv_trans_time</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a0e997657d1164ed23f912809492d8999">ag_reduced_trans_time</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a0b7575ba8c4c3c2fcd7ea7e668c02178">ag_recv_buf_time</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a9258429db2bb93e7f42e7b8573d83225">ag_recv_trans_time</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a74cac02b60940fec951339e9197d8463">pta_time</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a2a02ef2dbcdfdd262146fff6f34510ac">pta_pos_time</a></td></tr>
<tr><td colspan="2"><h2>Static Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a> = sizeof(<a class="el" href="classlbann_1_1lbann__quantizer.html#aad6499ee349e94a461538a8e4f867048">qtype</a>) * 8</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ad98118c77f676fa3d3fb4ba27b814070">GR_M</a> = 16</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a5f645c840854c584c9224af063fee23b">GR_K</a> = 4</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a41cdad23feaf0414ad61cf3ceafc5c39">NUM_PTA_SAMPLES</a> = 128</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a804753c85f84fde1adc2cb7275a1158c">NUM_ONEBIT_SAMPLES</a> = 128</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Perform one-bit quantization of matrices (by column) with the quantization threshold at 0. Optionally do thresholding and entropy coding. Relevant references: "1-Bit Stochastic Gradient Descent and its Application to Data-Parallel
 Distributed Training of Speech DNNs" by Frank Seide et al. (MSR) "Scalable Distributed DNN Training Using Commodity GPU Cloud Computing" by Nikko Strom. (Amazon) </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00049">49</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
<hr/><h2>Member Typedef Documentation</h2>
<a class="anchor" id="aad6499ee349e94a461538a8e4f867048"></a><!-- doxytag: member="lbann::lbann_quantizer::qtype" ref="aad6499ee349e94a461538a8e4f867048" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int32_t <a class="el" href="classlbann_1_1lbann__quantizer.html#aad6499ee349e94a461538a8e4f867048">lbann::lbann_quantizer::qtype</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00054">54</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a2f0b1c91b994c91dfa506869e3329db6"></a><!-- doxytag: member="lbann::lbann_quantizer::QuantizedMatrix" ref="a2f0b1c91b994c91dfa506869e3329db6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef El::Matrix&lt;<a class="el" href="classlbann_1_1lbann__quantizer.html#aad6499ee349e94a461538a8e4f867048">qtype</a>&gt; <a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">lbann::lbann_quantizer::QuantizedMatrix</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This represents a quantized version of a matrix. Each column is quantized separately. The first two entries are floats representing the positive and negative averages for the column (used in dequantizion). The rest is one-bit quantized entries. Quantization is by column to keep averages nice and because Elemental uses column-major ordering. This is int32_t because Elemental matrices don't support unsigned or &gt;32-bit types. It forces some type-casting annoyances. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00065">65</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a84c968d0f772235faa39f6ad91e7eadb"></a><!-- doxytag: member="lbann::lbann_quantizer::ThreshQuantized" ref="a84c968d0f772235faa39f6ad91e7eadb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::vector&lt;<a class="el" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a>&gt; <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">lbann::lbann_quantizer::ThreshQuantized</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00066">66</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="af6bfe410c16ab39ca55861afb7c53134"></a><!-- doxytag: member="lbann::lbann_quantizer::uqtype" ref="af6bfe410c16ab39ca55861afb7c53134" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef uint32_t <a class="el" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">lbann::lbann_quantizer::uqtype</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>We require that sizeof(DataType) == sizeof(qtype) == sizeof(uqtype). </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00053">53</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a430cd47f333c678d2cb77f4ab2693914"></a><!-- doxytag: member="lbann::lbann_quantizer::lbann_quantizer" ref="a430cd47f333c678d2cb77f4ab2693914" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">lbann::lbann_quantizer::lbann_quantizer </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00037">37</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00037"></a>00037                                  {
<a name="l00038"></a>00038   <a class="code" href="classlbann_1_1lbann__quantizer.html#afa32b747b7ac0dbea8df3b47593d54b7">reset_bytes_counters</a>();
<a name="l00039"></a>00039   <a class="code" href="classlbann_1_1lbann__quantizer.html#abdba3762c51a2820f70adba32169f57b">reset_time_counters</a>();
<a name="l00040"></a>00040 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a430cd47f333c678d2cb77f4ab2693914_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a430cd47f333c678d2cb77f4ab2693914_cgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a430cd47f333c678d2cb77f4ab2693914_cgraph_map" id="classlbann_1_1lbann__quantizer_a430cd47f333c678d2cb77f4ab2693914_cgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#afa32b747b7ac0dbea8df3b47593d54b7" title="lbann::lbann_quantizer::reset_bytes_counters" alt="" coords="304,5,589,35"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#abdba3762c51a2820f70adba32169f57b" title="lbann::lbann_quantizer::reset_time_counters" alt="" coords="308,59,585,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac0cc07008ff963949c2cb7b91786c61c"></a><!-- doxytag: member="lbann::lbann_quantizer::~lbann_quantizer" ref="ac0cc07008ff963949c2cb7b91786c61c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">lbann::lbann_quantizer::~lbann_quantizer </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00042">42</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00042"></a>00042                                   {
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 }
</pre></div></p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ac625cd41e898ab531ecbcdd864e0748e"></a><!-- doxytag: member="lbann::lbann_quantizer::adaptive_threshold_quantize" ref="ac625cd41e898ab531ecbcdd864e0748e" args="(const DistMat &amp;mat, ThreshQuantized &amp;q, Mat &amp;qerror, int proportion, bool delta=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::adaptive_threshold_quantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>proportion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>delta</em> = <code>false</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00582">582</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00584"></a>00584               {
<a name="l00585"></a>00585   <a class="code" href="classlbann_1_1lbann__quantizer.html#a8b920e254dcdc72b5a4785c740389dfe">adaptive_threshold_quantize</a>(mat.LockedMatrix(), q, qerror, proportion, delta);
<a name="l00586"></a>00586 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_ac625cd41e898ab531ecbcdd864e0748e_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_ac625cd41e898ab531ecbcdd864e0748e_cgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_ac625cd41e898ab531ecbcdd864e0748e_cgraph_map" id="classlbann_1_1lbann__quantizer_ac625cd41e898ab531ecbcdd864e0748e_cgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a8b920e254dcdc72b5a4785c740389dfe" title="lbann::lbann_quantizer::adaptive_threshold_quantize" alt="" coords="379,32,704,61"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#a621ce88c0a961cfdb00c94ab24d659e0" title="lbann::lbann_quantizer::proportion_threshold_average" alt="" coords="752,32,1083,61"/><area shape="rect" id="node7" href="namespacelbann.html#a4fea7ba21017b49d1e34394b4c20c764" title="lbann::get_generator" alt="" coords="1132,5,1271,35"/><area shape="rect" id="node9" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f" title="lbann::get_time" alt="" coords="1147,59,1256,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a8b920e254dcdc72b5a4785c740389dfe"></a><!-- doxytag: member="lbann::lbann_quantizer::adaptive_threshold_quantize" ref="a8b920e254dcdc72b5a4785c740389dfe" args="(const Mat &amp;mat, ThreshQuantized &amp;q, Mat &amp;qerror, int proportion, bool delta=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::adaptive_threshold_quantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>proportion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>delta</em> = <code>false</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Threshold and quantize a matrix, dynamically choosing the threshold and quantization values. qerror needs to be initialized with: Zeros(qerror, mat.Height(), mat.Width()). </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>mat</em>&nbsp;</td><td>The matrix to quantize. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>q</em>&nbsp;</td><td>The output list of quantized entries. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>qerror</em>&nbsp;</td><td>Running quantization error. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>proportion</em>&nbsp;</td><td>Quantize one in proportion of the values. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>delta</em>&nbsp;</td><td>Whether to do delta encoding (default false). </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00478">478</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00479"></a>00479                                                                                {
<a name="l00480"></a>00480   <span class="comment">// This uses a header to store all information needed to do unquantization in</span>
<a name="l00481"></a>00481   <span class="comment">// one spot, which makes unquantization easier to multi-thread. The header has</span>
<a name="l00482"></a>00482   <span class="comment">// one entry for each column, consisting of the starting offset of the</span>
<a name="l00483"></a>00483   <span class="comment">// quantized data in the array (including the header) and the two</span>
<a name="l00484"></a>00484   <span class="comment">// reconstruction values. The number of quantized entries is included as a</span>
<a name="l00485"></a>00485   <span class="comment">// final entry to simplify unquantization.</span>
<a name="l00486"></a>00486   <span class="keyword">const</span> Int width = mat.Width();
<a name="l00487"></a>00487   <span class="keyword">const</span> Int height = mat.Height();
<a name="l00488"></a>00488   <span class="keyword">const</span> Int ldim = mat.LDim();
<a name="l00489"></a>00489   <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ mat_buf = mat.LockedBuffer();
<a name="l00490"></a>00490   <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ qerror_buf = qerror.Buffer();
<a name="l00491"></a>00491   <span class="keyword">const</span> <span class="keywordtype">int</span> header_len = 3 * width + 1;
<a name="l00492"></a>00492   q.resize(header_len);  <span class="comment">// Space for the header.</span>
<a name="l00493"></a>00493   std::vector&lt;ThreshQuantized&gt; thread_qs(omp_get_max_threads());
<a name="l00494"></a>00494   std::vector&lt;unsigned&gt; quantized_sums(omp_get_max_threads(), 0);
<a name="l00495"></a>00495   <span class="keywordflow">if</span> (!delta) {
<a name="l00496"></a>00496 <span class="preprocessor">    #pragma omp parallel</span>
<a name="l00497"></a>00497 <span class="preprocessor"></span>    {
<a name="l00498"></a>00498       <span class="keyword">const</span> <span class="keywordtype">int</span> tid = omp_get_thread_num();
<a name="l00499"></a>00499       <span class="keywordtype">int</span> num_quantized = header_len;
<a name="l00500"></a>00500 <span class="preprocessor">      #pragma omp for schedule(static)</span>
<a name="l00501"></a>00501 <span class="preprocessor"></span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> col = 0; col &lt; width; ++col) {
<a name="l00502"></a>00502         <span class="keyword">const</span> <span class="keywordtype">int</span> header_loc = 3 * col;
<a name="l00503"></a>00503         q[header_loc] = num_quantized;
<a name="l00504"></a>00504         <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_thresh, neg_thresh, pos_avg, neg_avg;
<a name="l00505"></a>00505         std::tie(pos_thresh, neg_thresh, pos_avg, neg_avg) =
<a name="l00506"></a>00506           <a class="code" href="classlbann_1_1lbann__quantizer.html#a621ce88c0a961cfdb00c94ab24d659e0">proportion_threshold_average</a>(mat, qerror, proportion, col);
<a name="l00507"></a>00507         <span class="comment">// Store the averages for reconstruction.</span>
<a name="l00508"></a>00508         memcpy(&amp;q[header_loc + 1], &amp;pos_avg, <span class="keyword">sizeof</span>(pos_avg));
<a name="l00509"></a>00509         memcpy(&amp;q[header_loc + 2], &amp;neg_avg, <span class="keyword">sizeof</span>(neg_avg));
<a name="l00510"></a>00510         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> row = 0; row &lt; height; ++row) {
<a name="l00511"></a>00511           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> pos = row + col * ldim;
<a name="l00512"></a>00512           <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> val = mat_buf[pos] + qerror_buf[pos];
<a name="l00513"></a>00513           <span class="keywordflow">if</span> (val &gt;= pos_thresh) {
<a name="l00514"></a>00514             qerror_buf[pos] = val - pos_avg;
<a name="l00515"></a>00515             thread_qs[tid].emplace_back((pos &lt;&lt; 1) | 1);
<a name="l00516"></a>00516             ++num_quantized;
<a name="l00517"></a>00517           } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val &lt;= neg_thresh) {
<a name="l00518"></a>00518             qerror_buf[pos] = val - neg_avg;
<a name="l00519"></a>00519             thread_qs[tid].emplace_back(pos &lt;&lt; 1);
<a name="l00520"></a>00520             ++num_quantized;
<a name="l00521"></a>00521           } <span class="keywordflow">else</span> {
<a name="l00522"></a>00522             qerror_buf[pos] = val;
<a name="l00523"></a>00523           }
<a name="l00524"></a>00524         }
<a name="l00525"></a>00525       }
<a name="l00526"></a>00526 <span class="preprocessor">      #pragma omp single</span>
<a name="l00527"></a>00527 <span class="preprocessor"></span>      {
<a name="l00528"></a>00528         <span class="comment">// Compute the amount to adjust header counts by. This is essentially</span>
<a name="l00529"></a>00529         <span class="comment">// a shifted prefix-sum.</span>
<a name="l00530"></a>00530         quantized_sums[0] = 0;
<a name="l00531"></a>00531         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> t = 1; t &lt; omp_get_max_threads(); ++t) {
<a name="l00532"></a>00532           quantized_sums[t] = quantized_sums[t - 1] + thread_qs[t - 1].size();
<a name="l00533"></a>00533         }
<a name="l00534"></a>00534       }
<a name="l00535"></a>00535       <span class="comment">// Have threads patch up the header counts.</span>
<a name="l00536"></a>00536       <span class="comment">// Static schedule guarantees threads are assigned the same way.</span>
<a name="l00537"></a>00537 <span class="preprocessor">      #pragma omp for schedule(static)</span>
<a name="l00538"></a>00538 <span class="preprocessor"></span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> col = 0; col &lt; width; ++col) {
<a name="l00539"></a>00539         q[3 * col] += quantized_sums[tid];
<a name="l00540"></a>00540       }
<a name="l00541"></a>00541     }
<a name="l00542"></a>00542     <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp;&amp; thread_q : thread_qs) {
<a name="l00543"></a>00543       q.insert(q.end(), thread_q.begin(), thread_q.end());
<a name="l00544"></a>00544     }
<a name="l00545"></a>00545     <span class="comment">// Store the final number of entries.</span>
<a name="l00546"></a>00546     q[3 * width] = q.size();
<a name="l00547"></a>00547   } <span class="keywordflow">else</span> {
<a name="l00548"></a>00548     <span class="comment">// Delta encoding is done within each column:</span>
<a name="l00549"></a>00549     <span class="comment">// only the difference between rows is recorded.</span>
<a name="l00550"></a>00550     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> col = 0; col &lt; width; ++col) {
<a name="l00551"></a>00551       <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_thresh, neg_thresh, pos_avg, neg_avg;
<a name="l00552"></a>00552       std::tie(pos_thresh, neg_thresh, pos_avg, neg_avg) =
<a name="l00553"></a>00553         <a class="code" href="classlbann_1_1lbann__quantizer.html#a621ce88c0a961cfdb00c94ab24d659e0">proportion_threshold_average</a>(mat, qerror, proportion, col);
<a name="l00554"></a>00554       <span class="comment">// Store the averages for reconstruction.</span>
<a name="l00555"></a>00555       <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> tmp;
<a name="l00556"></a>00556       memcpy(&amp;tmp, &amp;pos_avg, <span class="keyword">sizeof</span>(pos_avg));
<a name="l00557"></a>00557       q.push_back(tmp);
<a name="l00558"></a>00558       memcpy(&amp;tmp, &amp;neg_avg, <span class="keyword">sizeof</span>(neg_avg));
<a name="l00559"></a>00559       q.push_back(tmp);
<a name="l00560"></a>00560       <span class="keywordtype">unsigned</span> prev_row = 0;
<a name="l00561"></a>00561       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> row = 0; row &lt; height; ++row) {
<a name="l00562"></a>00562         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> pos = row + col * ldim;
<a name="l00563"></a>00563         <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> val = mat_buf[pos] + qerror_buf[pos];
<a name="l00564"></a>00564         <span class="keywordflow">if</span> (val &gt;= pos_thresh) {
<a name="l00565"></a>00565           qerror_buf[pos] = val - pos_avg;
<a name="l00566"></a>00566           <span class="comment">// Delta encode the row.</span>
<a name="l00567"></a>00567           q.emplace_back(((row - prev_row) &lt;&lt; 1) | 1);
<a name="l00568"></a>00568           prev_row = row;
<a name="l00569"></a>00569         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val &lt;= neg_thresh) {
<a name="l00570"></a>00570           qerror_buf[pos] = val - neg_avg;
<a name="l00571"></a>00571           q.emplace_back((row - prev_row) &lt;&lt; 1);
<a name="l00572"></a>00572           prev_row = row;
<a name="l00573"></a>00573         } <span class="keywordflow">else</span> {
<a name="l00574"></a>00574           qerror_buf[pos] = val;
<a name="l00575"></a>00575         }
<a name="l00576"></a>00576       }
<a name="l00577"></a>00577       q.push_back(~((<a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a>) 0));  <span class="comment">// Separator.</span>
<a name="l00578"></a>00578     }
<a name="l00579"></a>00579   }
<a name="l00580"></a>00580 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a8b920e254dcdc72b5a4785c740389dfe_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a8b920e254dcdc72b5a4785c740389dfe_cgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a8b920e254dcdc72b5a4785c740389dfe_cgraph_map" id="classlbann_1_1lbann__quantizer_a8b920e254dcdc72b5a4785c740389dfe_cgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a621ce88c0a961cfdb00c94ab24d659e0" title="lbann::lbann_quantizer::proportion_threshold_average" alt="" coords="379,32,709,61"/><area shape="rect" id="node5" href="namespacelbann.html#a4fea7ba21017b49d1e34394b4c20c764" title="lbann::get_generator" alt="" coords="759,5,897,35"/><area shape="rect" id="node7" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f" title="lbann::get_time" alt="" coords="773,59,883,88"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a8b920e254dcdc72b5a4785c740389dfe_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a8b920e254dcdc72b5a4785c740389dfe_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a8b920e254dcdc72b5a4785c740389dfe_icgraph_map" id="classlbann_1_1lbann__quantizer_a8b920e254dcdc72b5a4785c740389dfe_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#ac625cd41e898ab531ecbcdd864e0748e" title="lbann::lbann_quantizer::adaptive_threshold_quantize" alt="" coords="432,5,757,35"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#a28e74da8473ea1b475ff3976676898c4" title="lbann::lbann_quantizer::intermodel_sum_adaptive_threshold_quantized" alt="" coords="380,59,809,88"/><area shape="rect" id="node7" href="classlbann_1_1lbann__quantizer.html#acf0864e7c687806af3155655a33ed364" title="lbann::lbann_quantizer::intermodel_sum_adaptive_threshold_quantized" alt="" coords="860,32,1289,61"/><area shape="rect" id="node9" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback_imcomm::on_backward_prop_end" alt="" coords="900,85,1249,115"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af9898a10cf9b2ea13ed2a7484bd2199d"></a><!-- doxytag: member="lbann::lbann_quantizer::adaptive_threshold_unquantize" ref="af9898a10cf9b2ea13ed2a7484bd2199d" args="(const ThreshQuantized &amp;q, DistMat &amp;mat, bool delta=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::adaptive_threshold_unquantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>delta</em> = <code>false</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00629">629</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00630"></a>00630                                                       {
<a name="l00631"></a>00631   <a class="code" href="classlbann_1_1lbann__quantizer.html#a28e08719534c503f452f7627d9c9c400">adaptive_threshold_unquantize</a>(q, mat.Matrix(), delta);
<a name="l00632"></a>00632 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_af9898a10cf9b2ea13ed2a7484bd2199d_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_af9898a10cf9b2ea13ed2a7484bd2199d_cgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_af9898a10cf9b2ea13ed2a7484bd2199d_cgraph_map" id="classlbann_1_1lbann__quantizer_af9898a10cf9b2ea13ed2a7484bd2199d_cgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a28e08719534c503f452f7627d9c9c400" title="lbann::lbann_quantizer::adaptive_threshold_unquantize" alt="" coords="392,5,731,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a28e08719534c503f452f7627d9c9c400"></a><!-- doxytag: member="lbann::lbann_quantizer::adaptive_threshold_unquantize" ref="a28e08719534c503f452f7627d9c9c400" args="(const ThreshQuantized &amp;q, Mat &amp;mat, bool delta=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::adaptive_threshold_unquantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>delta</em> = <code>false</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Unquantize an adaptively-thresholded-and-quantized matrix. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>q</em>&nbsp;</td><td>The quantizd matrix. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mat</em>&nbsp;</td><td>The output unquantized matrix. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>delta</em>&nbsp;</td><td>Whether delta encoding was used (default false). </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00588">588</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00589"></a>00589                                                   {
<a name="l00590"></a>00590   <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ buf = mat.Buffer();
<a name="l00591"></a>00591   <span class="keywordflow">if</span> (!delta) {
<a name="l00592"></a>00592     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> header_len = mat.Width() * 3;
<a name="l00593"></a>00593 <span class="preprocessor">    #pragma omp parallel for schedule(static)</span>
<a name="l00594"></a>00594 <span class="preprocessor"></span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> header_loc = 0; header_loc &lt; header_len; header_loc += 3) {
<a name="l00595"></a>00595       <span class="comment">// Extract averages.</span>
<a name="l00596"></a>00596       <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_avg, neg_avg;
<a name="l00597"></a>00597       memcpy(&amp;pos_avg, &amp;q[header_loc + 1], <span class="keyword">sizeof</span>(pos_avg));
<a name="l00598"></a>00598       memcpy(&amp;neg_avg, &amp;q[header_loc + 2], <span class="keyword">sizeof</span>(neg_avg));
<a name="l00599"></a>00599       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = q[header_loc]; i &lt; q[header_loc + 3]; ++i) {
<a name="l00600"></a>00600         <span class="keyword">const</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> val = q[i];
<a name="l00601"></a>00601         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> pos = val &gt;&gt; 1;
<a name="l00602"></a>00602         <span class="keywordflow">if</span> (val &amp; 1) buf[pos] = pos_avg;
<a name="l00603"></a>00603         <span class="keywordflow">else</span> buf[pos] = neg_avg;
<a name="l00604"></a>00604       }
<a name="l00605"></a>00605     }
<a name="l00606"></a>00606   } <span class="keywordflow">else</span> {
<a name="l00607"></a>00607     <span class="keyword">const</span> Int ldim = mat.LDim();
<a name="l00608"></a>00608     <span class="keywordtype">int</span> col = 0;
<a name="l00609"></a>00609     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; q.size(); ++i) {
<a name="l00610"></a>00610       <span class="comment">// Extract averages.</span>
<a name="l00611"></a>00611       <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_avg, neg_avg;
<a name="l00612"></a>00612       memcpy(&amp;pos_avg, &amp;(q[i]), <span class="keyword">sizeof</span>(pos_avg));
<a name="l00613"></a>00613       memcpy(&amp;neg_avg, &amp;(q[i + 1]), <span class="keyword">sizeof</span>(neg_avg));
<a name="l00614"></a>00614       i += 2;  <span class="comment">// Skip the averages.</span>
<a name="l00615"></a>00615       <span class="keywordtype">unsigned</span> prev_row = 0;
<a name="l00616"></a>00616       <span class="keywordflow">for</span> (; q[i] != ~((<a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a>) 0); ++i) {
<a name="l00617"></a>00617         <span class="keyword">const</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> val = q[i];
<a name="l00618"></a>00618         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> row = (val &gt;&gt; 1) + prev_row;
<a name="l00619"></a>00619         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> pos = row + col * ldim;
<a name="l00620"></a>00620         prev_row = row;
<a name="l00621"></a>00621         <span class="keywordflow">if</span> (val &amp; 1) buf[pos] = pos_avg;
<a name="l00622"></a>00622         <span class="keywordflow">else</span> buf[pos] = neg_avg;
<a name="l00623"></a>00623       }
<a name="l00624"></a>00624       ++col;
<a name="l00625"></a>00625     }
<a name="l00626"></a>00626   }
<a name="l00627"></a>00627 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a28e08719534c503f452f7627d9c9c400_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a28e08719534c503f452f7627d9c9c400_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a28e08719534c503f452f7627d9c9c400_icgraph_map" id="classlbann_1_1lbann__quantizer_a28e08719534c503f452f7627d9c9c400_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#af9898a10cf9b2ea13ed2a7484bd2199d" title="lbann::lbann_quantizer::adaptive_threshold_unquantize" alt="" coords="439,5,777,35"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#a28e74da8473ea1b475ff3976676898c4" title="lbann::lbann_quantizer::intermodel_sum_adaptive_threshold_quantized" alt="" coords="393,59,823,88"/><area shape="rect" id="node7" href="classlbann_1_1lbann__quantizer.html#acf0864e7c687806af3155655a33ed364" title="lbann::lbann_quantizer::intermodel_sum_adaptive_threshold_quantized" alt="" coords="873,32,1303,61"/><area shape="rect" id="node9" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback_imcomm::on_backward_prop_end" alt="" coords="913,85,1263,115"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a888effd26dfa024c28f591dda74bd464"></a><!-- doxytag: member="lbann::lbann_quantizer::adaptive_threshold_unquantize_add" ref="a888effd26dfa024c28f591dda74bd464" args="(const ThreshQuantized &amp;q, Mat &amp;mat, bool delta=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::adaptive_threshold_unquantize_add </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>delta</em> = <code>false</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Variant of adaptive_threshold_quantize that adds its entries. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00634">634</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00635"></a>00635                                                   {
<a name="l00636"></a>00636   <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ buf = mat.Buffer();
<a name="l00637"></a>00637   <span class="keywordflow">if</span> (!delta) {
<a name="l00638"></a>00638     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> header_len = mat.Width() * 3;
<a name="l00639"></a>00639 <span class="preprocessor">    #pragma omp parallel for schedule(static)</span>
<a name="l00640"></a>00640 <span class="preprocessor"></span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> header_loc = 0; header_loc &lt; header_len; header_loc += 3) {
<a name="l00641"></a>00641       <span class="comment">// Extract averages.</span>
<a name="l00642"></a>00642       <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_avg, neg_avg;
<a name="l00643"></a>00643       memcpy(&amp;pos_avg, &amp;q[header_loc + 1], <span class="keyword">sizeof</span>(pos_avg));
<a name="l00644"></a>00644       memcpy(&amp;neg_avg, &amp;q[header_loc + 2], <span class="keyword">sizeof</span>(neg_avg));
<a name="l00645"></a>00645       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = q[header_loc]; i &lt; q[header_loc + 3]; ++i) {
<a name="l00646"></a>00646         <span class="keyword">const</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> val = q[i];
<a name="l00647"></a>00647         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> pos = val &gt;&gt; 1;
<a name="l00648"></a>00648         <span class="keywordflow">if</span> (val &amp; 1) buf[pos] += pos_avg;
<a name="l00649"></a>00649         <span class="keywordflow">else</span> buf[pos] += neg_avg;
<a name="l00650"></a>00650       }
<a name="l00651"></a>00651     }
<a name="l00652"></a>00652   } <span class="keywordflow">else</span> {
<a name="l00653"></a>00653     <span class="keyword">const</span> Int ldim = mat.LDim();
<a name="l00654"></a>00654     <span class="keywordtype">int</span> col = 0;
<a name="l00655"></a>00655     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; q.size(); ++i) {
<a name="l00656"></a>00656       <span class="comment">// Extract averages.</span>
<a name="l00657"></a>00657       <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_avg, neg_avg;
<a name="l00658"></a>00658       memcpy(&amp;pos_avg, &amp;(q[i]), <span class="keyword">sizeof</span>(pos_avg));
<a name="l00659"></a>00659       memcpy(&amp;neg_avg, &amp;(q[i + 1]), <span class="keyword">sizeof</span>(neg_avg));
<a name="l00660"></a>00660       i += 2;  <span class="comment">// Skip the averages.</span>
<a name="l00661"></a>00661       <span class="keywordtype">unsigned</span> prev_row = 0;
<a name="l00662"></a>00662       <span class="keywordflow">for</span> (; q[i] != ~((<a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a>) 0); ++i) {
<a name="l00663"></a>00663         <span class="keyword">const</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> val = q[i];
<a name="l00664"></a>00664         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> row = (val &gt;&gt; 1) + prev_row;
<a name="l00665"></a>00665         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> pos = row + col * ldim;
<a name="l00666"></a>00666         prev_row = row;
<a name="l00667"></a>00667         <span class="keywordflow">if</span> (val &amp; 1) buf[pos] += pos_avg;
<a name="l00668"></a>00668         <span class="keywordflow">else</span> buf[pos] += neg_avg;
<a name="l00669"></a>00669       }
<a name="l00670"></a>00670       ++col;
<a name="l00671"></a>00671     }
<a name="l00672"></a>00672   }
<a name="l00673"></a>00673 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a888effd26dfa024c28f591dda74bd464_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a888effd26dfa024c28f591dda74bd464_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a888effd26dfa024c28f591dda74bd464_icgraph_map" id="classlbann_1_1lbann__quantizer_a888effd26dfa024c28f591dda74bd464_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a28e74da8473ea1b475ff3976676898c4" title="lbann::lbann_quantizer::intermodel_sum_adaptive_threshold_quantized" alt="" coords="423,32,852,61"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#acf0864e7c687806af3155655a33ed364" title="lbann::lbann_quantizer::intermodel_sum_adaptive_threshold_quantized" alt="" coords="903,5,1332,35"/><area shape="rect" id="node7" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback_imcomm::on_backward_prop_end" alt="" coords="943,59,1292,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a6e75d7f48c309ed184c4de0b9e56c4bb"></a><!-- doxytag: member="lbann::lbann_quantizer::compress_adaptive_thresholds" ref="a6e75d7f48c309ed184c4de0b9e56c4bb" args="(const ThreshQuantized &amp;q, ThreshQuantized &amp;cq)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::compress_adaptive_thresholds </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>cq</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00972">972</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00973"></a>00973                                                                         {
<a name="l00974"></a>00974   cq.push_back(q[0]);
<a name="l00975"></a>00975   cq.push_back(q[1]);
<a name="l00976"></a>00976   <a class="code" href="classlbann_1_1lbann__quantizer.html#ad8d07c3ffddff08800887dff354ffed2">compress_thresholds</a>(q, std::next(q.begin(), 2), cq);
<a name="l00977"></a>00977 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a6e75d7f48c309ed184c4de0b9e56c4bb_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a6e75d7f48c309ed184c4de0b9e56c4bb_cgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a6e75d7f48c309ed184c4de0b9e56c4bb_cgraph_map" id="classlbann_1_1lbann__quantizer_a6e75d7f48c309ed184c4de0b9e56c4bb_cgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#ad8d07c3ffddff08800887dff354ffed2" title="lbann::lbann_quantizer::compress_thresholds" alt="" coords="396,5,679,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a6e75d7f48c309ed184c4de0b9e56c4bb_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a6e75d7f48c309ed184c4de0b9e56c4bb_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a6e75d7f48c309ed184c4de0b9e56c4bb_icgraph_map" id="classlbann_1_1lbann__quantizer_a6e75d7f48c309ed184c4de0b9e56c4bb_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a28e74da8473ea1b475ff3976676898c4" title="lbann::lbann_quantizer::intermodel_sum_adaptive_threshold_quantized" alt="" coords="396,32,825,61"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#acf0864e7c687806af3155655a33ed364" title="lbann::lbann_quantizer::intermodel_sum_adaptive_threshold_quantized" alt="" coords="876,5,1305,35"/><area shape="rect" id="node7" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback_imcomm::on_backward_prop_end" alt="" coords="916,59,1265,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac24afa148151301903c24d86dcdc209c"></a><!-- doxytag: member="lbann::lbann_quantizer::compress_thresholds" ref="ac24afa148151301903c24d86dcdc209c" args="(const ThreshQuantized &amp;q, ThreshQuantized::const_iterator qstart, ThreshQuantized &amp;cq)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::compress_thresholds </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ThreshQuantized::const_iterator&nbsp;</td>
          <td class="paramname"> <em>qstart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>cq</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Handle compression starting from arbitrary locations. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00874">874</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00876"></a>00876                        {
<a name="l00877"></a>00877   <span class="comment">// Handle empty input.</span>
<a name="l00878"></a>00878   <span class="keywordflow">if</span> (std::distance(qstart, q.end()) == 0) {
<a name="l00879"></a>00879     cq.push_back(~((<a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a>) 0));
<a name="l00880"></a>00880     <span class="keywordflow">return</span>;
<a name="l00881"></a>00881   }
<a name="l00882"></a>00882   <span class="comment">// Write to cur starting from cur&apos;s LSB.</span>
<a name="l00883"></a>00883   <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> cur = 0;
<a name="l00884"></a>00884   <span class="comment">// The current bit to write to. This is between 0 and NUM_BITS-1.</span>
<a name="l00885"></a>00885   <span class="comment">// E.g., between 0, ... 31 inclusive, so the bit is 1 &lt;&lt; cur_bit.</span>
<a name="l00886"></a>00886   <span class="comment">// Thus there are NUM_BITS - cur_bit bits left that can be written.</span>
<a name="l00887"></a>00887   <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> cur_bit = 0;
<a name="l00888"></a>00888   <span class="keywordflow">for</span> (<span class="keyword">auto</span> iter = qstart; iter != q.end(); ++iter) {
<a name="l00889"></a>00889     <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> ent = *iter;
<a name="l00890"></a>00890     <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> quotient = ent &gt;&gt; <a class="code" href="classlbann_1_1lbann__quantizer.html#a5f645c840854c584c9224af063fee23b">GR_K</a>;
<a name="l00891"></a>00891     <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> remainder = ent &amp; (<a class="code" href="classlbann_1_1lbann__quantizer.html#ad98118c77f676fa3d3fb4ba27b814070">GR_M</a> - 1);
<a name="l00892"></a>00892     <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> bits_left = <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a> - cur_bit;
<a name="l00893"></a>00893     <span class="comment">// Write quotient 1s.</span>
<a name="l00894"></a>00894     <span class="keywordflow">if</span> (bits_left &gt;= quotient) {
<a name="l00895"></a>00895       <span class="comment">// Can fit in the current chunk.</span>
<a name="l00896"></a>00896       <span class="keywordflow">if</span> (quotient == <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>) {
<a name="l00897"></a>00897         cq.push_back(~((<a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a>) 0));
<a name="l00898"></a>00898         <span class="comment">// Don&apos;t need to reset cur, cur_bit: already 0.</span>
<a name="l00899"></a>00899       } <span class="keywordflow">else</span> {
<a name="l00900"></a>00900         cur |= ((1 &lt;&lt; quotient) - 1) &lt;&lt; cur_bit;
<a name="l00901"></a>00901         cur_bit += quotient;
<a name="l00902"></a>00902         <span class="keywordflow">if</span> (cur_bit == <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>) {
<a name="l00903"></a>00903           cq.push_back(cur);
<a name="l00904"></a>00904           cur = 0;
<a name="l00905"></a>00905           cur_bit = 0;
<a name="l00906"></a>00906         }
<a name="l00907"></a>00907       }
<a name="l00908"></a>00908     } <span class="keywordflow">else</span> {
<a name="l00909"></a>00909       <span class="comment">// Need to split quotient into multiple chunks.</span>
<a name="l00910"></a>00910       <span class="comment">// Write the first bits_left 1s to the current chunk.</span>
<a name="l00911"></a>00911       <span class="keywordflow">if</span> (bits_left == <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>) {
<a name="l00912"></a>00912         cur = ~((<a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a>) 0);
<a name="l00913"></a>00913       } <span class="keywordflow">else</span> {
<a name="l00914"></a>00914         cur |= ((1 &lt;&lt; bits_left) - 1) &lt;&lt; cur_bit;
<a name="l00915"></a>00915       }
<a name="l00916"></a>00916       cq.push_back(cur);
<a name="l00917"></a>00917       quotient -= bits_left;
<a name="l00918"></a>00918       <span class="comment">// Write chunks of 1s until we have less than NUM_BITS left to write.</span>
<a name="l00919"></a>00919       <span class="keywordflow">for</span> (<a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> i = 0; i &lt; quotient / <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>; ++i) {
<a name="l00920"></a>00920         cq.push_back(~((<a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a>) 0));
<a name="l00921"></a>00921       }
<a name="l00922"></a>00922       <span class="comment">// Lastly write the remaining 1s to a new chunk.</span>
<a name="l00923"></a>00923       quotient %= <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>;
<a name="l00924"></a>00924       <span class="keywordflow">if</span> (quotient &gt; 0) {
<a name="l00925"></a>00925         cur = (1 &lt;&lt; quotient) - 1;
<a name="l00926"></a>00926         cur_bit = quotient;
<a name="l00927"></a>00927       } <span class="keywordflow">else</span> {
<a name="l00928"></a>00928         cur = 0;
<a name="l00929"></a>00929         cur_bit = 0;
<a name="l00930"></a>00930       }
<a name="l00931"></a>00931     }
<a name="l00932"></a>00932     <span class="comment">// Write trailing 0.</span>
<a name="l00933"></a>00933     <span class="comment">// There should always be at least one bit available here.</span>
<a name="l00934"></a>00934     cur_bit += 1;
<a name="l00935"></a>00935     <span class="keywordflow">if</span> (cur_bit == <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>) {
<a name="l00936"></a>00936       cq.push_back(cur);
<a name="l00937"></a>00937       cur = 0;
<a name="l00938"></a>00938       cur_bit = 0;
<a name="l00939"></a>00939     }
<a name="l00940"></a>00940     <span class="comment">// Write remainder as a GR_K-length binary string.</span>
<a name="l00941"></a>00941     <span class="comment">// Always fits in at most two chunks, since GR_K &lt;= 31.</span>
<a name="l00942"></a>00942     bits_left = <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a> - cur_bit;
<a name="l00943"></a>00943     <span class="keywordflow">if</span> (bits_left &gt;= GR_K) {
<a name="l00944"></a>00944       <span class="comment">// Can fit the remainder in the current chunk.</span>
<a name="l00945"></a>00945       cur |= remainder &lt;&lt; cur_bit;
<a name="l00946"></a>00946       cur_bit += GR_K;
<a name="l00947"></a>00947       <span class="keywordflow">if</span> (cur_bit == <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>) {
<a name="l00948"></a>00948         cq.push_back(cur);
<a name="l00949"></a>00949         cur = 0;
<a name="l00950"></a>00950         cur_bit = 0;
<a name="l00951"></a>00951       }
<a name="l00952"></a>00952     } <span class="keywordflow">else</span> {
<a name="l00953"></a>00953       <span class="comment">// Need to split the remainder into two chunks.</span>
<a name="l00954"></a>00954       <span class="comment">// Write the first bits_left bits to the current chunk.</span>
<a name="l00955"></a>00955       cur |= (remainder &amp; ((1 &lt;&lt; bits_left) - 1)) &lt;&lt; cur_bit;
<a name="l00956"></a>00956       cq.push_back(cur);
<a name="l00957"></a>00957       <span class="comment">// Now write the remaining GR_K - bits_left bits to the new chunk.</span>
<a name="l00958"></a>00958       cur = remainder &gt;&gt; bits_left;
<a name="l00959"></a>00959       cur_bit = GR_K - bits_left;
<a name="l00960"></a>00960     }
<a name="l00961"></a>00961   }
<a name="l00962"></a>00962   <span class="comment">// Pad the end of cur with 1s to terminate it (if needed).</span>
<a name="l00963"></a>00963   <span class="keywordflow">if</span> (cur_bit &gt; 0) {
<a name="l00964"></a>00964     <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> bits_left = <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a> - cur_bit;
<a name="l00965"></a>00965     cur |= ((1 &lt;&lt; bits_left) - 1) &lt;&lt; cur_bit;
<a name="l00966"></a>00966   }
<a name="l00967"></a>00967   <span class="keywordflow">if</span> (cur) {
<a name="l00968"></a>00968     cq.push_back(cur);
<a name="l00969"></a>00969   }
<a name="l00970"></a>00970 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad8d07c3ffddff08800887dff354ffed2"></a><!-- doxytag: member="lbann::lbann_quantizer::compress_thresholds" ref="ad8d07c3ffddff08800887dff354ffed2" args="(const ThreshQuantized &amp;q, ThreshQuantized &amp;cq)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::compress_thresholds </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>cq</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Compress the output of threshold_quantize. This uses Golumb-Rice coding, with the quotient stored first, followed by the remainder. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00869">869</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00870"></a>00870                                                                {
<a name="l00871"></a>00871   <a class="code" href="classlbann_1_1lbann__quantizer.html#ad8d07c3ffddff08800887dff354ffed2">compress_thresholds</a>(q, q.begin(), cq);
<a name="l00872"></a>00872 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_ad8d07c3ffddff08800887dff354ffed2_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_ad8d07c3ffddff08800887dff354ffed2_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_ad8d07c3ffddff08800887dff354ffed2_icgraph_map" id="classlbann_1_1lbann__quantizer_ad8d07c3ffddff08800887dff354ffed2_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a6e75d7f48c309ed184c4de0b9e56c4bb" title="lbann::lbann_quantizer::compress_adaptive_thresholds" alt="" coords="357,5,696,35"/><area shape="rect" id="node11" href="classlbann_1_1lbann__quantizer.html#a4cf9d4cd5262b21939e95fc34ad0a09f" title="lbann::lbann_quantizer::intermodel_sum_threshold_quantized" alt="" coords="340,59,713,88"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#a28e74da8473ea1b475ff3976676898c4" title="lbann::lbann_quantizer::intermodel_sum_adaptive_threshold_quantized" alt="" coords="764,5,1193,35"/><area shape="rect" id="node7" href="classlbann_1_1lbann__quantizer.html#acf0864e7c687806af3155655a33ed364" title="lbann::lbann_quantizer::intermodel_sum_adaptive_threshold_quantized" alt="" coords="1244,5,1673,35"/><area shape="rect" id="node9" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback_imcomm::on_backward_prop_end" alt="" coords="1284,59,1633,88"/><area shape="rect" id="node13" href="classlbann_1_1lbann__quantizer.html#ae99dc11003cecd04e599d68c99d90c0b" title="lbann::lbann_quantizer::intermodel_sum_threshold_quantized" alt="" coords="792,111,1165,140"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a9befb796840b21d1238e8169421005f9"></a><!-- doxytag: member="lbann::lbann_quantizer::get_ag_bytes_received" ref="a9befb796840b21d1238e8169421005f9" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t lbann::lbann_quantizer::get_ag_bytes_received </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Get the total number of bytes received during the all-gather phase. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00236">236</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00236"></a>00236 { <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#ae29843bccd4f211f36f4dd357a066a5d">ag_bytes_received</a>; }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a9befb796840b21d1238e8169421005f9_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a9befb796840b21d1238e8169421005f9_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a9befb796840b21d1238e8169421005f9_icgraph_map" id="classlbann_1_1lbann__quantizer_a9befb796840b21d1238e8169421005f9_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback_imcomm::on_backward_prop_end" alt="" coords="349,5,699,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a6c64c6960852ca25f81ba7bc80c05d2d"></a><!-- doxytag: member="lbann::lbann_quantizer::get_ag_bytes_sent" ref="a6c64c6960852ca25f81ba7bc80c05d2d" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t lbann::lbann_quantizer::get_ag_bytes_sent </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Get the total number of bytes sent during the all-gather phase. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00228">228</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00228"></a>00228 { <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a3a9e25785189c84ba5a7fe055382ca92">ag_bytes_sent</a>; }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a6c64c6960852ca25f81ba7bc80c05d2d_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a6c64c6960852ca25f81ba7bc80c05d2d_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a6c64c6960852ca25f81ba7bc80c05d2d_icgraph_map" id="classlbann_1_1lbann__quantizer_a6c64c6960852ca25f81ba7bc80c05d2d_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback_imcomm::on_backward_prop_end" alt="" coords="325,5,675,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a54a63a467a16d24c12010edcf8b28f03"></a><!-- doxytag: member="lbann::lbann_quantizer::get_ag_recv_buf_time" ref="a54a63a467a16d24c12010edcf8b28f03" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::get_ag_recv_buf_time </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Get the time spent in the allgather get_recv_buf. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00257">257</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00257"></a>00257 { <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a0b7575ba8c4c3c2fcd7ea7e668c02178">ag_recv_buf_time</a>; }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aebc22819c53ce8a836bd20e938f6c59e"></a><!-- doxytag: member="lbann::lbann_quantizer::get_ag_recv_trans_time" ref="aebc22819c53ce8a836bd20e938f6c59e" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::get_ag_recv_trans_time </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Get the time spent in the all-gather send_trans. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00259">259</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00259"></a>00259 { <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a9258429db2bb93e7f42e7b8573d83225">ag_recv_trans_time</a>; }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_aebc22819c53ce8a836bd20e938f6c59e_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_aebc22819c53ce8a836bd20e938f6c59e_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_aebc22819c53ce8a836bd20e938f6c59e_icgraph_map" id="classlbann_1_1lbann__quantizer_aebc22819c53ce8a836bd20e938f6c59e_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback_imcomm::on_backward_prop_end" alt="" coords="352,5,701,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a983b603f83ebdaee5eb924ca0d6495b9"></a><!-- doxytag: member="lbann::lbann_quantizer::get_ag_reduced_trans_time" ref="a983b603f83ebdaee5eb924ca0d6495b9" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::get_ag_reduced_trans_time </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Get the time spent in the allgather reduce_trans. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00255">255</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00255"></a>00255 { <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a0e997657d1164ed23f912809492d8999">ag_reduced_trans_time</a>; }
</pre></div></p>

</div>
</div>
<a class="anchor" id="affd6ee0a9c259ba5999c8f18ee7a58a7"></a><!-- doxytag: member="lbann::lbann_quantizer::get_ag_time" ref="affd6ee0a9c259ba5999c8f18ee7a58a7" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::get_ag_time </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Get the time spent in the allgather. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00247">247</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00247"></a>00247 { <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a4d3c330826fbaff8ee38f4b05cafa84a">ag_time</a>; }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9a029f692e679ac4475a51fa2ac8f7c1"></a><!-- doxytag: member="lbann::lbann_quantizer::get_bytes_received" ref="a9a029f692e679ac4475a51fa2ac8f7c1" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t lbann::lbann_quantizer::get_bytes_received </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Get the total number of bytes received during quantization. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00230">230</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00230"></a>00230                                     {
<a name="l00231"></a>00231     <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a9b02b1adbc432e0d5b417ad6e098ed75">rs_bytes_received</a> + <a class="code" href="classlbann_1_1lbann__quantizer.html#ae29843bccd4f211f36f4dd357a066a5d">ag_bytes_received</a>;
<a name="l00232"></a>00232   }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a9a029f692e679ac4475a51fa2ac8f7c1_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a9a029f692e679ac4475a51fa2ac8f7c1_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a9a029f692e679ac4475a51fa2ac8f7c1_icgraph_map" id="classlbann_1_1lbann__quantizer_a9a029f692e679ac4475a51fa2ac8f7c1_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback_imcomm::on_backward_prop_end" alt="" coords="328,5,677,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ad318aefe6f75c8d68363affce55f6190"></a><!-- doxytag: member="lbann::lbann_quantizer::get_bytes_sent" ref="ad318aefe6f75c8d68363affce55f6190" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t lbann::lbann_quantizer::get_bytes_sent </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Get the total number of bytes sent during quantization. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00224">224</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00224"></a>00224 { <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a484e392b671e8eeaa3af5b5faa683bee">rs_bytes_sent</a> + <a class="code" href="classlbann_1_1lbann__quantizer.html#a3a9e25785189c84ba5a7fe055382ca92">ag_bytes_sent</a>; }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_ad318aefe6f75c8d68363affce55f6190_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_ad318aefe6f75c8d68363affce55f6190_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_ad318aefe6f75c8d68363affce55f6190_icgraph_map" id="classlbann_1_1lbann__quantizer_ad318aefe6f75c8d68363affce55f6190_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback_imcomm::on_backward_prop_end" alt="" coords="304,5,653,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af520ee89ffb0419f5e4a9cf96d400744"></a><!-- doxytag: member="lbann::lbann_quantizer::get_pta_pos_time" ref="af520ee89ffb0419f5e4a9cf96d400744" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::get_pta_pos_time </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Get the time spent in proportion_threshold_average_pos. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00263">263</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00263"></a>00263 { <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a2a02ef2dbcdfdd262146fff6f34510ac">pta_pos_time</a>; }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa205ee6fd0695d248d412bdaa9b8a9c1"></a><!-- doxytag: member="lbann::lbann_quantizer::get_pta_time" ref="aa205ee6fd0695d248d412bdaa9b8a9c1" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::get_pta_time </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Get the time spent in proportion_threshold_average. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00261">261</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00261"></a>00261 { <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a74cac02b60940fec951339e9197d8463">pta_time</a>; }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a52820f8b0868a7f8f3a57ade0c663c3c"></a><!-- doxytag: member="lbann::lbann_quantizer::get_quantized_matrix_height" ref="a52820f8b0868a7f8f3a57ade0c663c3c" args="(const Mat &amp;mat) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lbann::lbann_quantizer::get_quantized_matrix_height </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>mat</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Return the height of mat after quantization with <a class="el" href="classlbann_1_1lbann__quantizer.html#a3801d9cd1a1adefb160b69dbd7e499ef">quantize()</a>. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00323">323</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00323"></a>00323                                                                {
<a name="l00324"></a>00324     <span class="keywordflow">return</span> (mat.Height() + (<a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>-1)) / <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a> + 2;
<a name="l00325"></a>00325   }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a52820f8b0868a7f8f3a57ade0c663c3c_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a52820f8b0868a7f8f3a57ade0c663c3c_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a52820f8b0868a7f8f3a57ade0c663c3c_icgraph_map" id="classlbann_1_1lbann__quantizer_a52820f8b0868a7f8f3a57ade0c663c3c_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a97db186341c0819c8d52e2f815deb2a7" title="lbann::lbann_quantizer::intermodel_sum_quantized" alt="" coords="644,59,959,88"/><area shape="rect" id="node9" href="classlbann_1_1lbann__quantizer.html#a3801d9cd1a1adefb160b69dbd7e499ef" title="lbann::lbann_quantizer::quantize" alt="" coords="383,112,591,141"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#a4877befb2683f16a03fdf91ed1353636" title="lbann::lbann_quantizer::intermodel_sum_quantized" alt="" coords="1028,5,1343,35"/><area shape="rect" id="node7" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback_imcomm::on_backward_prop_end" alt="" coords="1011,59,1360,88"/><area shape="rect" id="node12" href="classlbann_1_1lbann__quantizer.html#a0e271e3f75667540f5bde94fbcd3ef0e" title="lbann::lbann_quantizer::intermodel_sum_quantized2" alt="" coords="640,112,963,141"/><area shape="rect" id="node16" href="classlbann_1_1lbann__quantizer.html#aa516ede3d1fd798bb5ef5c2cf28cb53d" title="lbann::lbann_quantizer::quantize" alt="" coords="697,165,905,195"/><area shape="rect" id="node14" href="classlbann_1_1lbann__quantizer.html#a35ca3e61f358ccb63c233d85236dfec1" title="lbann::lbann_quantizer::intermodel_sum_quantized2" alt="" coords="1024,112,1347,141"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aeefaa02ea30dc89f58420e019950207f"></a><!-- doxytag: member="lbann::lbann_quantizer::get_rs_bytes_received" ref="aeefaa02ea30dc89f58420e019950207f" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t lbann::lbann_quantizer::get_rs_bytes_received </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Get the total number of bytes received during the reduce-scatter phase. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00234">234</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00234"></a>00234 { <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a9b02b1adbc432e0d5b417ad6e098ed75">rs_bytes_received</a>; }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_aeefaa02ea30dc89f58420e019950207f_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_aeefaa02ea30dc89f58420e019950207f_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_aeefaa02ea30dc89f58420e019950207f_icgraph_map" id="classlbann_1_1lbann__quantizer_aeefaa02ea30dc89f58420e019950207f_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback_imcomm::on_backward_prop_end" alt="" coords="344,5,693,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2c1b69b38cf93d43e9b4eca7d4c5e28f"></a><!-- doxytag: member="lbann::lbann_quantizer::get_rs_bytes_sent" ref="a2c1b69b38cf93d43e9b4eca7d4c5e28f" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t lbann::lbann_quantizer::get_rs_bytes_sent </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Get the total number of bytes sent during the reduce-scatter phase. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00226">226</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00226"></a>00226 { <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a484e392b671e8eeaa3af5b5faa683bee">rs_bytes_sent</a>; }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a2c1b69b38cf93d43e9b4eca7d4c5e28f_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a2c1b69b38cf93d43e9b4eca7d4c5e28f_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a2c1b69b38cf93d43e9b4eca7d4c5e28f_icgraph_map" id="classlbann_1_1lbann__quantizer_a2c1b69b38cf93d43e9b4eca7d4c5e28f_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback_imcomm::on_backward_prop_end" alt="" coords="320,5,669,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a12b8e87e51866a6b028b8dbd4faebe55"></a><!-- doxytag: member="lbann::lbann_quantizer::get_rs_recv_buf_time" ref="a12b8e87e51866a6b028b8dbd4faebe55" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::get_rs_recv_buf_time </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Get the time spent in the reduce-scatter get_recv_buf. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00251">251</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00251"></a>00251 { <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a7fa4275835362b7d9ec91201f4f73436">rs_recv_buf_time</a>; }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae5f4f573c3ed285265e9d7834446b3a0"></a><!-- doxytag: member="lbann::lbann_quantizer::get_rs_recv_trans_time" ref="ae5f4f573c3ed285265e9d7834446b3a0" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::get_rs_recv_trans_time </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Get the time spent in the reduce-scatter recv_trans. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00253">253</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00253"></a>00253 { <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a81db6fb79472d86023dd470c2948ea5a">rs_recv_trans_time</a>; }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_ae5f4f573c3ed285265e9d7834446b3a0_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_ae5f4f573c3ed285265e9d7834446b3a0_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_ae5f4f573c3ed285265e9d7834446b3a0_icgraph_map" id="classlbann_1_1lbann__quantizer_ae5f4f573c3ed285265e9d7834446b3a0_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback_imcomm::on_backward_prop_end" alt="" coords="349,5,699,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aea9f348cd6f48b706870e1a5e48e8827"></a><!-- doxytag: member="lbann::lbann_quantizer::get_rs_send_trans_time" ref="aea9f348cd6f48b706870e1a5e48e8827" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::get_rs_send_trans_time </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Get the time spent in the reduce-scatter send_trans. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00249">249</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00249"></a>00249 { <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a824b8b6d8964621e6a02aee94c38332a">rs_send_trans_time</a>; }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_aea9f348cd6f48b706870e1a5e48e8827_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_aea9f348cd6f48b706870e1a5e48e8827_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_aea9f348cd6f48b706870e1a5e48e8827_icgraph_map" id="classlbann_1_1lbann__quantizer_aea9f348cd6f48b706870e1a5e48e8827_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback_imcomm::on_backward_prop_end" alt="" coords="352,5,701,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4484f37237d53c4992d00698b72fd45f"></a><!-- doxytag: member="lbann::lbann_quantizer::get_rs_time" ref="a4484f37237d53c4992d00698b72fd45f" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::get_rs_time </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Get the time spent in the reduce-scatter. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00245">245</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00245"></a>00245 { <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#aa25d9dbcc7af16370142f46a6c23d178">rs_time</a>; }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4338c9a5afac7e660acf5073efa7ffb0"></a><!-- doxytag: member="lbann::lbann_quantizer::intermodel_ring_allgather" ref="a4338c9a5afac7e660acf5073efa7ffb0" args="(lbann_comm *comm, Mat &amp;mat, bool var_recv, std::function&lt; void(Mat &amp;)&gt; reduced_trans, std::function&lt; T *(int &amp;)&gt; get_send_buf, std::function&lt; T *(Mat &amp;, int &amp;)&gt; get_recv_buf, std::function&lt; void(T *, Mat &amp;)&gt; recv_trans, std::function&lt; void(T *, T *)&gt; swap_bufs)" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_ring_allgather </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&nbsp;</td>
          <td class="paramname"> <em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>var_recv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; void(<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;)&gt;&nbsp;</td>
          <td class="paramname"> <em>reduced_trans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; T *(int &amp;)&gt;&nbsp;</td>
          <td class="paramname"> <em>get_send_buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; T *(<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;, int &amp;)&gt;&nbsp;</td>
          <td class="paramname"> <em>get_recv_buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; void(T *, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;)&gt;&nbsp;</td>
          <td class="paramname"> <em>recv_trans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; void(T *, T *)&gt;&nbsp;</td>
          <td class="paramname"> <em>swap_bufs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00437">437</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00443"></a>00443                                          {
<a name="l00444"></a>00444   <span class="keywordtype">double</span> ag_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();
<a name="l00445"></a>00445   <span class="keywordtype">int</span> rank = <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;get_model_rank();
<a name="l00446"></a>00446   <span class="keywordtype">int</span> nprocs = <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;get_num_models();
<a name="l00447"></a>00447   <span class="comment">// Compute the number of columns each processor sends.</span>
<a name="l00448"></a>00448   <span class="comment">// The last processor handles the excess.</span>
<a name="l00449"></a>00449   <span class="keywordtype">int</span> cols_per_proc = mat.Width() / nprocs;
<a name="l00450"></a>00450   <span class="keywordtype">int</span> cols_remainder = mat.Width() % nprocs;
<a name="l00451"></a>00451   <span class="keywordtype">int</span> local_col_width = cols_per_proc;
<a name="l00452"></a>00452   <span class="keywordflow">if</span> (rank == nprocs - 1) local_col_width += cols_remainder;
<a name="l00453"></a>00453   <span class="comment">// Get the portion of mat that was reduced.</span>
<a name="l00454"></a>00454   <span class="keywordtype">double</span> reduced_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();
<a name="l00455"></a>00455   <span class="keyword">auto</span> reduced = mat(IR(0, mat.Height()),
<a name="l00456"></a>00456                      IR(rank * cols_per_proc,
<a name="l00457"></a>00457                         rank * cols_per_proc + local_col_width));
<a name="l00458"></a>00458   <span class="comment">// Transform the reduced data.</span>
<a name="l00459"></a>00459   reduced_trans(reduced);
<a name="l00460"></a>00460   <a class="code" href="classlbann_1_1lbann__quantizer.html#a0e997657d1164ed23f912809492d8999">ag_reduced_trans_time</a> += <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - reduced_start;
<a name="l00461"></a>00461   <span class="comment">// Compute the previous/next ranks in the ring.</span>
<a name="l00462"></a>00462   <span class="keywordtype">int</span> src = rank - 1;
<a name="l00463"></a>00463   <span class="keywordflow">if</span> (src &lt; 0) src = nprocs - 1;
<a name="l00464"></a>00464   <span class="keywordtype">int</span> dst = (rank + 1) % nprocs;
<a name="l00465"></a>00465   <span class="comment">// Do the allgather.</span>
<a name="l00466"></a>00466   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> step = 0; step &lt; nprocs - 1; ++step) {
<a name="l00467"></a>00467     <span class="comment">// Send our data or forward received data.</span>
<a name="l00468"></a>00468     lbann_mpi_req&lt;T&gt; req;
<a name="l00469"></a>00469     <span class="keywordtype">int</span> send_size;
<a name="l00470"></a>00470     T* send_buf = get_send_buf(send_size);
<a name="l00471"></a>00471     <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;nb_send(send_buf, send_size, dst, req);
<a name="l00472"></a>00472     <a class="code" href="classlbann_1_1lbann__quantizer.html#a3a9e25785189c84ba5a7fe055382ca92">ag_bytes_sent</a> += send_size * <span class="keyword">sizeof</span>(T);
<a name="l00473"></a>00473     <span class="comment">// Compute the original rank that sent the data we&apos;re going to receive.</span>
<a name="l00474"></a>00474     <span class="keywordtype">int</span> data_src = (rank - step - 1) % nprocs;
<a name="l00475"></a>00475     <span class="keywordflow">if</span> (data_src &lt; 0) data_src += nprocs;
<a name="l00476"></a>00476     <span class="comment">// Compute the amount of data we&apos;re receiving.</span>
<a name="l00477"></a>00477     <span class="keywordtype">int</span> recv_col_width = cols_per_proc;
<a name="l00478"></a>00478     <span class="keywordflow">if</span> (data_src == nprocs - 1) recv_col_width += cols_remainder;
<a name="l00479"></a>00479     <span class="comment">// Get the portion of mat to receive into.</span>
<a name="l00480"></a>00480     <span class="keyword">auto</span> recv_view = mat(IR(0, mat.Height()),
<a name="l00481"></a>00481                          IR(data_src * cols_per_proc,
<a name="l00482"></a>00482                             data_src * cols_per_proc + recv_col_width));
<a name="l00483"></a>00483     <span class="comment">// Get receive buffer.</span>
<a name="l00484"></a>00484     <span class="keywordtype">double</span> recv_buf_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();
<a name="l00485"></a>00485     <span class="keywordtype">int</span> recv_size = 0;
<a name="l00486"></a>00486     <span class="keywordflow">if</span> (var_recv) {
<a name="l00487"></a>00487       recv_size = <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;get_count&lt;T&gt;(src);
<a name="l00488"></a>00488     }
<a name="l00489"></a>00489     T* recv_buf = get_recv_buf(recv_view, recv_size);
<a name="l00490"></a>00490     <a class="code" href="classlbann_1_1lbann__quantizer.html#a0b7575ba8c4c3c2fcd7ea7e668c02178">ag_recv_buf_time</a> += <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - recv_buf_start;
<a name="l00491"></a>00491     <span class="comment">// Receive data.</span>
<a name="l00492"></a>00492     <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;recv(recv_buf, recv_size, src);
<a name="l00493"></a>00493     <a class="code" href="classlbann_1_1lbann__quantizer.html#ae29843bccd4f211f36f4dd357a066a5d">ag_bytes_received</a> += recv_size * <span class="keyword">sizeof</span>(T);
<a name="l00494"></a>00494     <span class="comment">// Transform the received portion.</span>
<a name="l00495"></a>00495     <span class="keywordtype">double</span> recv_trans_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();
<a name="l00496"></a>00496     recv_trans(recv_buf, recv_view);
<a name="l00497"></a>00497     <a class="code" href="classlbann_1_1lbann__quantizer.html#a9258429db2bb93e7f42e7b8573d83225">ag_recv_trans_time</a> += <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - recv_trans_start;
<a name="l00498"></a>00498     <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;wait&lt;T&gt;(req);
<a name="l00499"></a>00499     <span class="comment">// Swap so we forward the data we just received.</span>
<a name="l00500"></a>00500     swap_bufs(send_buf, recv_buf);
<a name="l00501"></a>00501     send_size = recv_size;
<a name="l00502"></a>00502   }
<a name="l00503"></a>00503   <a class="code" href="classlbann_1_1lbann__quantizer.html#a4d3c330826fbaff8ee38f4b05cafa84a">ag_time</a> += <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - ag_start;
<a name="l00504"></a>00504 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a4338c9a5afac7e660acf5073efa7ffb0_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a4338c9a5afac7e660acf5073efa7ffb0_cgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a4338c9a5afac7e660acf5073efa7ffb0_cgraph_map" id="classlbann_1_1lbann__quantizer_a4338c9a5afac7e660acf5073efa7ffb0_cgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__comm.html#a1fa922b6520f44fc817847f7c596e25e" title="lbann::lbann_comm::get_count" alt="" coords="379,5,579,35"/><area shape="rect" id="node7" href="classlbann_1_1lbann__comm.html#a6c201108eb6b5a1e23021db29cef655b" title="lbann::lbann_comm::get_model_rank" alt="" coords="361,59,596,88"/><area shape="rect" id="node9" href="classlbann_1_1lbann__comm.html#a54842b679a3756cf79b43baf46caf637" title="lbann::lbann_comm::get_num_models" alt="" coords="357,112,600,141"/><area shape="rect" id="node11" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f" title="lbann::get_time" alt="" coords="424,165,533,195"/><area shape="rect" id="node13" href="classlbann_1_1lbann__comm.html#a355a5b31dd50bd0fd6fb015621e0ba42" title="lbann::lbann_comm::nb_send" alt="" coords="383,219,575,248"/><area shape="rect" id="node16" href="classlbann_1_1lbann__comm.html#af3560cb26adf60212085e7b1d8e8dade" title="lbann::lbann_comm::recv" alt="" coords="395,272,563,301"/><area shape="rect" id="node19" href="classlbann_1_1lbann__comm.html#ac24c005bf5cec3dfcafbf54253e8d6f2" title="lbann::lbann_comm::wait" alt="" coords="396,325,561,355"/><area shape="rect" id="node5" href="classlbann_1_1lbann__comm.html#a676b64be1b9429b85e8dac09728ba490" title="lbann::lbann_comm::get_world_rank" alt="" coords="649,219,879,248"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a6a8c8dac0d77378291de4b8703d404ab"></a><!-- doxytag: member="lbann::lbann_quantizer::intermodel_ring_reduce_scatter" ref="a6a8c8dac0d77378291de4b8703d404ab" args="(lbann_comm *comm, Mat &amp;mat, bool var_recv, std::function&lt; T *(Mat &amp;, IR, IR, int &amp;)&gt; send_trans, std::function&lt; T *(Mat &amp;, int &amp;)&gt; get_recv_buf, std::function&lt; void(T *, Mat &amp;)&gt; recv_trans)" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_ring_reduce_scatter </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&nbsp;</td>
          <td class="paramname"> <em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>var_recv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; T *(<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;, IR, IR, int &amp;)&gt;&nbsp;</td>
          <td class="paramname"> <em>send_trans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; T *(<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;, int &amp;)&gt;&nbsp;</td>
          <td class="paramname"> <em>get_recv_buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; void(T *, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;)&gt;&nbsp;</td>
          <td class="paramname"> <em>recv_trans</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00378">378</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00382"></a>00382                                           {
<a name="l00383"></a>00383   <span class="keywordtype">double</span> rs_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();
<a name="l00384"></a>00384   <span class="keywordtype">int</span> rank = <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;get_model_rank();
<a name="l00385"></a>00385   <span class="keywordtype">int</span> nprocs = <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;get_num_models();
<a name="l00386"></a>00386   <span class="comment">// Compute the number of columns each processor sends.</span>
<a name="l00387"></a>00387   <span class="comment">// The last processor handles the excess.</span>
<a name="l00388"></a>00388   <span class="keywordtype">int</span> cols_per_proc = mat.Width() / nprocs;
<a name="l00389"></a>00389   <span class="keywordtype">int</span> cols_remainder = mat.Width() % nprocs;
<a name="l00390"></a>00390   <span class="keywordtype">int</span> local_col_width = cols_per_proc;
<a name="l00391"></a>00391   <span class="keywordflow">if</span> (rank == nprocs - 1) local_col_width += cols_remainder;
<a name="l00392"></a>00392   <span class="comment">// Local view into which to accumulate our received data.</span>
<a name="l00393"></a>00393   <span class="keyword">auto</span> accum_view = mat(IR(0, mat.Height()),
<a name="l00394"></a>00394                         IR(rank * cols_per_proc,
<a name="l00395"></a>00395                            rank * cols_per_proc + local_col_width));
<a name="l00396"></a>00396   <span class="comment">// Do the reduce-scatter.</span>
<a name="l00397"></a>00397   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> step = 1; step &lt; nprocs; ++step) {
<a name="l00398"></a>00398     <span class="comment">// Compute the source/destination.</span>
<a name="l00399"></a>00399     <span class="keywordtype">int</span> dst = (rank + step) % nprocs;
<a name="l00400"></a>00400     <span class="keywordtype">int</span> src = (rank - step) % nprocs;
<a name="l00401"></a>00401     <span class="keywordflow">if</span> (src &lt; 0) src += nprocs;
<a name="l00402"></a>00402     <span class="comment">// Determine the number of columns to send.</span>
<a name="l00403"></a>00403     <span class="keywordtype">int</span> send_col_width = cols_per_proc;
<a name="l00404"></a>00404     <span class="keywordflow">if</span> (dst == nprocs - 1) send_col_width += cols_remainder;
<a name="l00405"></a>00405     <span class="comment">// Transform the portion to send.</span>
<a name="l00406"></a>00406     <span class="keywordtype">int</span> send_size;
<a name="l00407"></a>00407     <span class="keywordtype">double</span> send_trans_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();
<a name="l00408"></a>00408     T* send_buf = send_trans(
<a name="l00409"></a>00409       mat, IR(0, mat.Height()),
<a name="l00410"></a>00410       IR(dst * cols_per_proc, dst * cols_per_proc + send_col_width), send_size);
<a name="l00411"></a>00411     <a class="code" href="classlbann_1_1lbann__quantizer.html#a824b8b6d8964621e6a02aee94c38332a">rs_send_trans_time</a> += <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - send_trans_start;
<a name="l00412"></a>00412     <span class="comment">// Send.</span>
<a name="l00413"></a>00413     lbann_mpi_req&lt;T&gt; req;
<a name="l00414"></a>00414     <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;nb_send(send_buf, send_size, dst, req);
<a name="l00415"></a>00415     <a class="code" href="classlbann_1_1lbann__quantizer.html#a484e392b671e8eeaa3af5b5faa683bee">rs_bytes_sent</a> += send_size * <span class="keyword">sizeof</span>(T);
<a name="l00416"></a>00416     <span class="comment">// Get receive buffer.</span>
<a name="l00417"></a>00417     <span class="keywordtype">double</span> recv_buf_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();
<a name="l00418"></a>00418     <span class="keywordtype">int</span> recv_size = 0;
<a name="l00419"></a>00419     <span class="keywordflow">if</span> (var_recv) {
<a name="l00420"></a>00420       recv_size = <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;get_count&lt;T&gt;(src);
<a name="l00421"></a>00421     }
<a name="l00422"></a>00422     T* recv_buf = get_recv_buf(accum_view, recv_size);
<a name="l00423"></a>00423     <a class="code" href="classlbann_1_1lbann__quantizer.html#a7fa4275835362b7d9ec91201f4f73436">rs_recv_buf_time</a> += <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - recv_buf_start;
<a name="l00424"></a>00424     <span class="comment">// Receive.</span>
<a name="l00425"></a>00425     <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;recv(recv_buf, recv_size, src);
<a name="l00426"></a>00426     <a class="code" href="classlbann_1_1lbann__quantizer.html#a9b02b1adbc432e0d5b417ad6e098ed75">rs_bytes_received</a> += recv_size * <span class="keyword">sizeof</span>(T);
<a name="l00427"></a>00427     <span class="comment">// Transform the received portion.</span>
<a name="l00428"></a>00428     <span class="keywordtype">double</span> recv_trans_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();
<a name="l00429"></a>00429     recv_trans(recv_buf, accum_view);
<a name="l00430"></a>00430     <a class="code" href="classlbann_1_1lbann__quantizer.html#a81db6fb79472d86023dd470c2948ea5a">rs_recv_trans_time</a> += <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - recv_trans_start;
<a name="l00431"></a>00431     <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;wait&lt;T&gt;(req);
<a name="l00432"></a>00432   }
<a name="l00433"></a>00433   <a class="code" href="classlbann_1_1lbann__quantizer.html#aa25d9dbcc7af16370142f46a6c23d178">rs_time</a> += <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - rs_start;
<a name="l00434"></a>00434 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a6a8c8dac0d77378291de4b8703d404ab_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a6a8c8dac0d77378291de4b8703d404ab_cgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a6a8c8dac0d77378291de4b8703d404ab_cgraph_map" id="classlbann_1_1lbann__quantizer_a6a8c8dac0d77378291de4b8703d404ab_cgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__comm.html#a1fa922b6520f44fc817847f7c596e25e" title="lbann::lbann_comm::get_count" alt="" coords="416,5,616,35"/><area shape="rect" id="node7" href="classlbann_1_1lbann__comm.html#a6c201108eb6b5a1e23021db29cef655b" title="lbann::lbann_comm::get_model_rank" alt="" coords="399,59,633,88"/><area shape="rect" id="node9" href="classlbann_1_1lbann__comm.html#a54842b679a3756cf79b43baf46caf637" title="lbann::lbann_comm::get_num_models" alt="" coords="395,112,637,141"/><area shape="rect" id="node11" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f" title="lbann::get_time" alt="" coords="461,165,571,195"/><area shape="rect" id="node13" href="classlbann_1_1lbann__comm.html#a355a5b31dd50bd0fd6fb015621e0ba42" title="lbann::lbann_comm::nb_send" alt="" coords="420,219,612,248"/><area shape="rect" id="node16" href="classlbann_1_1lbann__comm.html#af3560cb26adf60212085e7b1d8e8dade" title="lbann::lbann_comm::recv" alt="" coords="432,272,600,301"/><area shape="rect" id="node19" href="classlbann_1_1lbann__comm.html#ac24c005bf5cec3dfcafbf54253e8d6f2" title="lbann::lbann_comm::wait" alt="" coords="433,325,599,355"/><area shape="rect" id="node5" href="classlbann_1_1lbann__comm.html#a676b64be1b9429b85e8dac09728ba490" title="lbann::lbann_comm::get_world_rank" alt="" coords="687,219,916,248"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="acf0864e7c687806af3155655a33ed364"></a><!-- doxytag: member="lbann::lbann_quantizer::intermodel_sum_adaptive_threshold_quantized" ref="acf0864e7c687806af3155655a33ed364" args="(lbann_comm *comm, DistMat &amp;mat, Mat &amp;qerror, int proportion, Mat &amp;im_qerror, bool compress=true)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_adaptive_threshold_quantized </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&nbsp;</td>
          <td class="paramname"> <em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>proportion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>im_qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>compress</em> = <code>true</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00862">862</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00864"></a>00864                  {
<a name="l00865"></a>00865   <a class="code" href="classlbann_1_1lbann__quantizer.html#a28e74da8473ea1b475ff3976676898c4">intermodel_sum_adaptive_threshold_quantized</a>(<a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat.Matrix(), qerror,
<a name="l00866"></a>00866                                               proportion, im_qerror, compress);
<a name="l00867"></a>00867 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_acf0864e7c687806af3155655a33ed364_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_acf0864e7c687806af3155655a33ed364_cgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_acf0864e7c687806af3155655a33ed364_cgraph_map" id="classlbann_1_1lbann__quantizer_acf0864e7c687806af3155655a33ed364_cgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a28e74da8473ea1b475ff3976676898c4" title="lbann::lbann_quantizer::intermodel_sum_adaptive_threshold_quantized" alt="" coords="487,139,916,168"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#a8b920e254dcdc72b5a4785c740389dfe" title="lbann::lbann_quantizer::adaptive_threshold_quantize" alt="" coords="987,32,1312,61"/><area shape="rect" id="node13" href="classlbann_1_1lbann__quantizer.html#a28e08719534c503f452f7627d9c9c400" title="lbann::lbann_quantizer::adaptive_threshold_unquantize" alt="" coords="980,85,1319,115"/><area shape="rect" id="node15" href="classlbann_1_1lbann__quantizer.html#a888effd26dfa024c28f591dda74bd464" title="lbann::lbann_quantizer::adaptive_threshold_unquantize_add" alt="" coords="967,139,1332,168"/><area shape="rect" id="node17" href="classlbann_1_1lbann__quantizer.html#a6e75d7f48c309ed184c4de0b9e56c4bb" title="lbann::lbann_quantizer::compress_adaptive_thresholds" alt="" coords="980,192,1319,221"/><area shape="rect" id="node21" href="classlbann_1_1lbann__quantizer.html#a02e4bdf26d23de079d763300e71488f1" title="lbann::lbann_quantizer::uncompress_adaptive_thresholds" alt="" coords="972,245,1327,275"/><area shape="rect" id="node7" href="classlbann_1_1lbann__quantizer.html#a621ce88c0a961cfdb00c94ab24d659e0" title="lbann::lbann_quantizer::proportion_threshold_average" alt="" coords="1381,32,1712,61"/><area shape="rect" id="node9" href="namespacelbann.html#a4fea7ba21017b49d1e34394b4c20c764" title="lbann::get_generator" alt="" coords="1761,5,1900,35"/><area shape="rect" id="node11" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f" title="lbann::get_time" alt="" coords="1776,59,1885,88"/><area shape="rect" id="node19" href="classlbann_1_1lbann__quantizer.html#ad8d07c3ffddff08800887dff354ffed2" title="lbann::lbann_quantizer::compress_thresholds" alt="" coords="1405,192,1688,221"/><area shape="rect" id="node23" href="classlbann_1_1lbann__quantizer.html#afb58d63b174c3a937f3c3b21eb269b77" title="lbann::lbann_quantizer::uncompress_thresholds" alt="" coords="1397,245,1696,275"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a28e74da8473ea1b475ff3976676898c4"></a><!-- doxytag: member="lbann::lbann_quantizer::intermodel_sum_adaptive_threshold_quantized" ref="a28e74da8473ea1b475ff3976676898c4" args="(lbann_comm *comm, Mat &amp;mat, Mat &amp;qerror, int proportion, Mat &amp;im_qerror, bool compress=true)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_adaptive_threshold_quantized </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&nbsp;</td>
          <td class="paramname"> <em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>proportion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>im_qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>compress</em> = <code>true</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>As with intermodel_sum_quantized, but use adaptive threshold quantization. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00772">772</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00774"></a>00774                  {
<a name="l00775"></a>00775   <span class="keywordflow">if</span> (qerror.Height() == 0) {
<a name="l00776"></a>00776     qerror.Resize(mat.Height(), mat.Width(), mat.LDim());
<a name="l00777"></a>00777     Zero(qerror);
<a name="l00778"></a>00778   }
<a name="l00779"></a>00779   <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> rs_quant;
<a name="l00780"></a>00780   <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> rs_recv;
<a name="l00781"></a>00781   <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> comp_buf;
<a name="l00782"></a>00782   <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> uncomp_buf;
<a name="l00783"></a>00783   <span class="keyword">auto</span> rs_send_trans = 
<a name="l00784"></a>00784     [&amp;qerror, &amp;rs_quant, compress, proportion, <span class="keyword">this</span>]
<a name="l00785"></a>00785     (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; mat, IR h, IR w, <span class="keywordtype">int</span>&amp; count) {
<a name="l00786"></a>00786       <span class="keyword">auto</span> to_send = mat(h, w);
<a name="l00787"></a>00787       <span class="keyword">auto</span> to_send_qerr = qerror(h, w);
<a name="l00788"></a>00788       rs_quant.clear();
<a name="l00789"></a>00789       <a class="code" href="classlbann_1_1lbann__quantizer.html#a8b920e254dcdc72b5a4785c740389dfe">adaptive_threshold_quantize</a>(to_send, rs_quant, to_send_qerr, proportion,
<a name="l00790"></a>00790                                   compress);
<a name="l00791"></a>00791       <span class="keywordflow">if</span> (compress) {
<a name="l00792"></a>00792         <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> comp;
<a name="l00793"></a>00793         <a class="code" href="classlbann_1_1lbann__quantizer.html#a6e75d7f48c309ed184c4de0b9e56c4bb">compress_adaptive_thresholds</a>(rs_quant, comp);
<a name="l00794"></a>00794         std::swap(rs_quant, comp);
<a name="l00795"></a>00795       }
<a name="l00796"></a>00796       count = rs_quant.size();
<a name="l00797"></a>00797       <span class="keywordflow">return</span> rs_quant.data();
<a name="l00798"></a>00798     };
<a name="l00799"></a>00799   <span class="keyword">auto</span> rs_get_recv_buf = 
<a name="l00800"></a>00800     [&amp;rs_recv] (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; mat, <span class="keywordtype">int</span>&amp; count) {
<a name="l00801"></a>00801       rs_recv.resize(count);
<a name="l00802"></a>00802       <span class="keywordflow">return</span> rs_recv.data();
<a name="l00803"></a>00803     };
<a name="l00804"></a>00804   <span class="keyword">auto</span> rs_recv_trans = 
<a name="l00805"></a>00805     [&amp;rs_recv, compress, <span class="keyword">this</span>]
<a name="l00806"></a>00806     (<a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a>* buf, <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; accum) {
<a name="l00807"></a>00807       <span class="keywordflow">if</span> (compress) {
<a name="l00808"></a>00808         <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> uncomp;
<a name="l00809"></a>00809         <a class="code" href="classlbann_1_1lbann__quantizer.html#a02e4bdf26d23de079d763300e71488f1">uncompress_adaptive_thresholds</a>(rs_recv, uncomp);
<a name="l00810"></a>00810         std::swap(rs_recv, uncomp);
<a name="l00811"></a>00811       }
<a name="l00812"></a>00812       <a class="code" href="classlbann_1_1lbann__quantizer.html#a888effd26dfa024c28f591dda74bd464">adaptive_threshold_unquantize_add</a>(rs_recv, accum, compress);
<a name="l00813"></a>00813     };
<a name="l00814"></a>00814   intermodel_ring_reduce_scatter&lt;uqtype&gt;(<a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat, <span class="keyword">true</span>, rs_send_trans,
<a name="l00815"></a>00815                                          rs_get_recv_buf, rs_recv_trans);
<a name="l00816"></a>00816   <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> ag_send;
<a name="l00817"></a>00817   <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> ag_recv;
<a name="l00818"></a>00818   <span class="keyword">auto</span> ag_reduced_trans =
<a name="l00819"></a>00819     [&amp;im_qerror, &amp;ag_send, compress, proportion, <span class="keyword">this</span>]
<a name="l00820"></a>00820     (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; reduced) {
<a name="l00821"></a>00821       <span class="keywordflow">if</span> (im_qerror.Height() == 0) {
<a name="l00822"></a>00822         im_qerror.Resize(reduced.Height(), reduced.Width(), reduced.LDim());
<a name="l00823"></a>00823         Zero(im_qerror);
<a name="l00824"></a>00824       }
<a name="l00825"></a>00825       <a class="code" href="classlbann_1_1lbann__quantizer.html#a8b920e254dcdc72b5a4785c740389dfe">adaptive_threshold_quantize</a>(reduced, ag_send, im_qerror, proportion,
<a name="l00826"></a>00826                                   compress);
<a name="l00827"></a>00827       <span class="keywordflow">if</span> (compress) {
<a name="l00828"></a>00828         <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> comp;
<a name="l00829"></a>00829         <a class="code" href="classlbann_1_1lbann__quantizer.html#a6e75d7f48c309ed184c4de0b9e56c4bb">compress_adaptive_thresholds</a>(ag_send, comp);
<a name="l00830"></a>00830         std::swap(comp, ag_send);
<a name="l00831"></a>00831       }
<a name="l00832"></a>00832     };
<a name="l00833"></a>00833   <span class="keyword">auto</span> ag_get_send_buf = [&amp;ag_send] (<span class="keywordtype">int</span>&amp; count) {
<a name="l00834"></a>00834       count = ag_send.size();
<a name="l00835"></a>00835       <span class="keywordflow">return</span> ag_send.data();
<a name="l00836"></a>00836     };
<a name="l00837"></a>00837   <span class="keyword">auto</span> ag_get_recv_buf =
<a name="l00838"></a>00838     [&amp;ag_recv] (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; recv_view, <span class="keywordtype">int</span>&amp; count) {
<a name="l00839"></a>00839       ag_recv.resize(count);
<a name="l00840"></a>00840       <span class="keywordflow">return</span> ag_recv.data();
<a name="l00841"></a>00841     };
<a name="l00842"></a>00842   <span class="keyword">auto</span> ag_recv_trans = 
<a name="l00843"></a>00843     [&amp;ag_recv, compress, proportion, <span class="keyword">this</span>]
<a name="l00844"></a>00844     (<a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a>*, <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; accum) {
<a name="l00845"></a>00845       <span class="keywordflow">if</span> (compress) {
<a name="l00846"></a>00846         <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> uncomp;
<a name="l00847"></a>00847         <a class="code" href="classlbann_1_1lbann__quantizer.html#a02e4bdf26d23de079d763300e71488f1">uncompress_adaptive_thresholds</a>(ag_recv, uncomp);
<a name="l00848"></a>00848         <a class="code" href="classlbann_1_1lbann__quantizer.html#a28e08719534c503f452f7627d9c9c400">adaptive_threshold_unquantize</a>(uncomp, accum, compress);
<a name="l00849"></a>00849       } <span class="keywordflow">else</span> {
<a name="l00850"></a>00850         <a class="code" href="classlbann_1_1lbann__quantizer.html#a28e08719534c503f452f7627d9c9c400">adaptive_threshold_unquantize</a>(ag_recv, accum);
<a name="l00851"></a>00851       }
<a name="l00852"></a>00852     };
<a name="l00853"></a>00853   <span class="keyword">auto</span> ag_swap_bufs =
<a name="l00854"></a>00854     [&amp;ag_send, &amp;ag_recv] (uqtype*, uqtype*) {
<a name="l00855"></a>00855       std::swap(ag_send, ag_recv);
<a name="l00856"></a>00856     };
<a name="l00857"></a>00857   intermodel_ring_allgather&lt;uqtype&gt;(comm, mat, <span class="keyword">true</span>, ag_reduced_trans,
<a name="l00858"></a>00858                                     ag_get_send_buf, ag_get_recv_buf,
<a name="l00859"></a>00859                                     ag_recv_trans, ag_swap_bufs);
<a name="l00860"></a>00860 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a28e74da8473ea1b475ff3976676898c4_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a28e74da8473ea1b475ff3976676898c4_cgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a28e74da8473ea1b475ff3976676898c4_cgraph_map" id="classlbann_1_1lbann__quantizer_a28e74da8473ea1b475ff3976676898c4_cgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a8b920e254dcdc72b5a4785c740389dfe" title="lbann::lbann_quantizer::adaptive_threshold_quantize" alt="" coords="507,32,832,61"/><area shape="rect" id="node11" href="classlbann_1_1lbann__quantizer.html#a28e08719534c503f452f7627d9c9c400" title="lbann::lbann_quantizer::adaptive_threshold_unquantize" alt="" coords="500,85,839,115"/><area shape="rect" id="node13" href="classlbann_1_1lbann__quantizer.html#a888effd26dfa024c28f591dda74bd464" title="lbann::lbann_quantizer::adaptive_threshold_unquantize_add" alt="" coords="487,139,852,168"/><area shape="rect" id="node15" href="classlbann_1_1lbann__quantizer.html#a6e75d7f48c309ed184c4de0b9e56c4bb" title="lbann::lbann_quantizer::compress_adaptive_thresholds" alt="" coords="500,192,839,221"/><area shape="rect" id="node19" href="classlbann_1_1lbann__quantizer.html#a02e4bdf26d23de079d763300e71488f1" title="lbann::lbann_quantizer::uncompress_adaptive_thresholds" alt="" coords="492,245,847,275"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#a621ce88c0a961cfdb00c94ab24d659e0" title="lbann::lbann_quantizer::proportion_threshold_average" alt="" coords="901,32,1232,61"/><area shape="rect" id="node7" href="namespacelbann.html#a4fea7ba21017b49d1e34394b4c20c764" title="lbann::get_generator" alt="" coords="1281,5,1420,35"/><area shape="rect" id="node9" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f" title="lbann::get_time" alt="" coords="1296,59,1405,88"/><area shape="rect" id="node17" href="classlbann_1_1lbann__quantizer.html#ad8d07c3ffddff08800887dff354ffed2" title="lbann::lbann_quantizer::compress_thresholds" alt="" coords="925,192,1208,221"/><area shape="rect" id="node21" href="classlbann_1_1lbann__quantizer.html#afb58d63b174c3a937f3c3b21eb269b77" title="lbann::lbann_quantizer::uncompress_thresholds" alt="" coords="917,245,1216,275"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a28e74da8473ea1b475ff3976676898c4_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a28e74da8473ea1b475ff3976676898c4_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a28e74da8473ea1b475ff3976676898c4_icgraph_map" id="classlbann_1_1lbann__quantizer_a28e74da8473ea1b475ff3976676898c4_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#acf0864e7c687806af3155655a33ed364" title="lbann::lbann_quantizer::intermodel_sum_adaptive_threshold_quantized" alt="" coords="487,5,916,35"/><area shape="rect" id="node5" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback_imcomm::on_backward_prop_end" alt="" coords="527,59,876,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4877befb2683f16a03fdf91ed1353636"></a><!-- doxytag: member="lbann::lbann_quantizer::intermodel_sum_quantized" ref="a4877befb2683f16a03fdf91ed1353636" args="(lbann_comm *comm, DistMat &amp;mat, Mat &amp;qerror, Mat &amp;im_qerror, bool do_adagrad=false, Mat *gradhist=nullptr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_quantized </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&nbsp;</td>
          <td class="paramname"> <em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>im_qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>do_adagrad</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> *&nbsp;</td>
          <td class="paramname"> <em>gradhist</em> = <code>nullptr</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00265">265</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00267"></a>00267                                   {
<a name="l00268"></a>00268   <a class="code" href="classlbann_1_1lbann__quantizer.html#a97db186341c0819c8d52e2f815deb2a7">intermodel_sum_quantized</a>(<a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat.Matrix(), qerror, im_qerror, do_adagrad,
<a name="l00269"></a>00269                            gradhist);
<a name="l00270"></a>00270 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a4877befb2683f16a03fdf91ed1353636_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a4877befb2683f16a03fdf91ed1353636_cgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a4877befb2683f16a03fdf91ed1353636_cgraph_map" id="classlbann_1_1lbann__quantizer_a4877befb2683f16a03fdf91ed1353636_cgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a97db186341c0819c8d52e2f815deb2a7" title="lbann::lbann_quantizer::intermodel_sum_quantized" alt="" coords="368,111,683,140"/><area shape="rect" id="node5" href="lbann__layer__fully__connected_8cpp.html#a199b2df97e18b083eb9ee655fec2dfc7" title="_sq" alt="" coords="821,5,864,35"/><area shape="rect" id="node7" href="lbann__layer__fully__connected_8cpp.html#afc141da3841a084e603a2e8db5b4a839" title="_sqrt" alt="" coords="817,59,868,88"/><area shape="rect" id="node9" href="classlbann_1_1lbann__quantizer.html#a52820f8b0868a7f8f3a57ade0c663c3c" title="lbann::lbann_quantizer::get_quantized_matrix_height" alt="" coords="1004,111,1329,140"/><area shape="rect" id="node11" href="classlbann_1_1lbann__quantizer.html#a3801d9cd1a1adefb160b69dbd7e499ef" title="lbann::lbann_quantizer::quantize" alt="" coords="739,163,947,192"/><area shape="rect" id="node16" href="classlbann_1_1lbann__quantizer.html#a8eb42b16ff79799e3e81733b7921a789" title="lbann::lbann_quantizer::unquantize" alt="" coords="732,216,953,245"/><area shape="rect" id="node13" href="namespacelbann.html#a4fea7ba21017b49d1e34394b4c20c764" title="lbann::get_generator" alt="" coords="1097,164,1236,193"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a97db186341c0819c8d52e2f815deb2a7"></a><!-- doxytag: member="lbann::lbann_quantizer::intermodel_sum_quantized" ref="a97db186341c0819c8d52e2f815deb2a7" args="(lbann_comm *comm, Mat &amp;mat, Mat &amp;qerror, Mat &amp;im_qerror, bool do_adagrad=false, Mat *gradhist=nullptr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_quantized </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&nbsp;</td>
          <td class="paramname"> <em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>im_qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>do_adagrad</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> *&nbsp;</td>
          <td class="paramname"> <em>gradhist</em> = <code>nullptr</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Do a sum reduction of mat over comm's inter-model communicator, with all communication being quantized. im_querror is a separate quantization error matrix that should be passed in each time this is called. This implements the allreduce using a ring-based reduce-scatter followed by a ring-based allgather. Matrices are sent quantized, are unquantized for the reduction, then the reduced matrix is requantized for the allgather. If do_adagrad is true, this scales the inter-mediate unquantized result as in AdaGrad, and uses gradhist to store the gradient history. If used, you should use <a class="el" href="classlbann_1_1SGD.html">SGD</a> as the optimizer for those layers to avoid applying AdaGrad twice. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00182">182</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00184"></a>00184                                   {
<a name="l00185"></a>00185   <span class="comment">// Initialize qerror.</span>
<a name="l00186"></a>00186   <span class="keywordflow">if</span> (qerror.Height() == 0) {
<a name="l00187"></a>00187     qerror.Resize(mat.Height(), mat.Width(), mat.LDim());
<a name="l00188"></a>00188     Zero(qerror);
<a name="l00189"></a>00189   }
<a name="l00190"></a>00190   <a class="code" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> to_send_quant;
<a name="l00191"></a>00191   <a class="code" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> rs_recv;
<a name="l00192"></a>00192   <span class="keyword">auto</span> rs_send_trans =
<a name="l00193"></a>00193     [&amp;qerror, &amp;to_send_quant, <span class="keyword">this</span>] (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; mat, IR h, IR w, <span class="keywordtype">int</span>&amp; count) {
<a name="l00194"></a>00194       <span class="keyword">auto</span> to_send = mat(h, w);
<a name="l00195"></a>00195       <span class="keyword">auto</span> to_send_qerr = qerror(h, w);
<a name="l00196"></a>00196       <a class="code" href="classlbann_1_1lbann__quantizer.html#a3801d9cd1a1adefb160b69dbd7e499ef">quantize</a>(to_send, to_send_quant, to_send_qerr);
<a name="l00197"></a>00197       count = to_send_quant.Height() * to_send_quant.Width();
<a name="l00198"></a>00198       <span class="keywordflow">return</span> to_send_quant.Buffer();
<a name="l00199"></a>00199     };
<a name="l00200"></a>00200   <span class="keyword">auto</span> rs_get_recv_buf = 
<a name="l00201"></a>00201     [&amp;rs_recv, <span class="keyword">this</span>] (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; mat, <span class="keywordtype">int</span>&amp; count) {
<a name="l00202"></a>00202       <span class="keywordflow">if</span> (rs_recv.Width() != mat.Width()) {
<a name="l00203"></a>00203         rs_recv.Resize(<a class="code" href="classlbann_1_1lbann__quantizer.html#a52820f8b0868a7f8f3a57ade0c663c3c">get_quantized_matrix_height</a>(mat), mat.Width());
<a name="l00204"></a>00204       }
<a name="l00205"></a>00205       count = rs_recv.Height() * rs_recv.Width();
<a name="l00206"></a>00206       <span class="keywordflow">return</span> rs_recv.Buffer();
<a name="l00207"></a>00207     };
<a name="l00208"></a>00208   <span class="keyword">auto</span> rs_recv_trans = 
<a name="l00209"></a>00209     [&amp;rs_recv, <span class="keyword">this</span>] (<a class="code" href="classlbann_1_1lbann__quantizer.html#aad6499ee349e94a461538a8e4f867048">qtype</a>*, <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; accum) {
<a name="l00210"></a>00210       <a class="code" href="classlbann_1_1lbann__quantizer.html#a8eb42b16ff79799e3e81733b7921a789">unquantize</a>(rs_recv, accum, <span class="keyword">true</span>);
<a name="l00211"></a>00211     };
<a name="l00212"></a>00212   intermodel_ring_reduce_scatter&lt;qtype&gt;(<a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat, <span class="keyword">false</span>, rs_send_trans,
<a name="l00213"></a>00213                                         rs_get_recv_buf, rs_recv_trans);
<a name="l00214"></a>00214   <a class="code" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> ag_send;
<a name="l00215"></a>00215   <a class="code" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> ag_recv;
<a name="l00216"></a>00216   std::function&lt;DataType(DataType)&gt; <a class="code" href="lbann__layer__fully__connected_8cpp.html#a199b2df97e18b083eb9ee655fec2dfc7">_sq</a> = [](<a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> x) { <span class="keywordflow">return</span> x*x; };
<a name="l00217"></a>00217   std::function&lt;DataType(DataType)&gt; <a class="code" href="lbann__layer__fully__connected_8cpp.html#afc141da3841a084e603a2e8db5b4a839">_sqrt</a> =
<a name="l00218"></a>00218     [](<a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> x) { <span class="keywordflow">return</span> 1.0f / (std::sqrt(x) + 1e-8f); };
<a name="l00219"></a>00219   <span class="keyword">auto</span> ag_reduced_trans =
<a name="l00220"></a>00220     [&amp;im_qerror, &amp;ag_send, gradhist, do_adagrad, _sq, _sqrt, <span class="keyword">this</span>] (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; reduced) {
<a name="l00221"></a>00221       <span class="keywordflow">if</span> (do_adagrad) {
<a name="l00222"></a>00222         <span class="keywordflow">if</span> (gradhist-&gt;Height() == 0) {
<a name="l00223"></a>00223           Zeros(*gradhist, reduced.Height(), reduced.Width());
<a name="l00224"></a>00224         }
<a name="l00225"></a>00225         <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> tmp(reduced);  <span class="comment">// Temporary for AdaGrad computations.</span>
<a name="l00226"></a>00226         <span class="comment">// Compute squared gradient and store in history.</span>
<a name="l00227"></a>00227         EntrywiseMap(tmp, _sq);
<a name="l00228"></a>00228         *gradhist += tmp;
<a name="l00229"></a>00229         <span class="comment">// Compute 1/sqrt(gradhist) with small perturbation.</span>
<a name="l00230"></a>00230         Copy(*gradhist, tmp);
<a name="l00231"></a>00231         EntrywiseMap(tmp, _sqrt);                     
<a name="l00232"></a>00232         <span class="comment">// Adjust update.</span>
<a name="l00233"></a>00233         <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> reduced_copy(reduced);
<a name="l00234"></a>00234         Hadamard(tmp, reduced_copy, reduced);
<a name="l00235"></a>00235       }
<a name="l00236"></a>00236       <span class="keywordflow">if</span> (im_qerror.Height() == 0) {
<a name="l00237"></a>00237         im_qerror.Resize(reduced.Height(), reduced.Width(), reduced.LDim());
<a name="l00238"></a>00238         Zero(im_qerror);
<a name="l00239"></a>00239       }
<a name="l00240"></a>00240       <a class="code" href="classlbann_1_1lbann__quantizer.html#a3801d9cd1a1adefb160b69dbd7e499ef">quantize</a>(reduced, ag_send, im_qerror);
<a name="l00241"></a>00241     };
<a name="l00242"></a>00242   <span class="keyword">auto</span> ag_get_send_buf = [&amp;ag_send] (<span class="keywordtype">int</span>&amp; count) {
<a name="l00243"></a>00243       count = ag_send.Height() * ag_send.Width();
<a name="l00244"></a>00244       <span class="keywordflow">return</span> ag_send.Buffer();
<a name="l00245"></a>00245     };
<a name="l00246"></a>00246   <span class="keyword">auto</span> ag_get_recv_buf = 
<a name="l00247"></a>00247     [&amp;ag_recv, <span class="keyword">this</span>] (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; recv_view, <span class="keywordtype">int</span>&amp; count) {
<a name="l00248"></a>00248       ag_recv.Resize(<a class="code" href="classlbann_1_1lbann__quantizer.html#a52820f8b0868a7f8f3a57ade0c663c3c">get_quantized_matrix_height</a>(recv_view), recv_view.Width());
<a name="l00249"></a>00249       count = ag_recv.Height() * ag_recv.Width();
<a name="l00250"></a>00250       <span class="keywordflow">return</span> ag_recv.Buffer();
<a name="l00251"></a>00251     };
<a name="l00252"></a>00252   <span class="keyword">auto</span> ag_recv_trans = 
<a name="l00253"></a>00253     [&amp;ag_recv, <span class="keyword">this</span>] (qtype*, <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; accum) {
<a name="l00254"></a>00254       <a class="code" href="classlbann_1_1lbann__quantizer.html#a8eb42b16ff79799e3e81733b7921a789">unquantize</a>(ag_recv, accum);
<a name="l00255"></a>00255     };
<a name="l00256"></a>00256   <span class="keyword">auto</span> ag_swap_bufs = 
<a name="l00257"></a>00257     [&amp;ag_send, &amp;ag_recv] (qtype*, qtype*) {
<a name="l00258"></a>00258       std::swap(ag_send, ag_recv);
<a name="l00259"></a>00259     };
<a name="l00260"></a>00260   intermodel_ring_allgather&lt;qtype&gt;(comm, mat, <span class="keyword">false</span>, ag_reduced_trans,
<a name="l00261"></a>00261                                    ag_get_send_buf, ag_get_recv_buf,
<a name="l00262"></a>00262                                    ag_recv_trans, ag_swap_bufs);
<a name="l00263"></a>00263 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a97db186341c0819c8d52e2f815deb2a7_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a97db186341c0819c8d52e2f815deb2a7_cgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a97db186341c0819c8d52e2f815deb2a7_cgraph_map" id="classlbann_1_1lbann__quantizer_a97db186341c0819c8d52e2f815deb2a7_cgraph">
<area shape="rect" id="node3" href="lbann__layer__fully__connected_8cpp.html#a199b2df97e18b083eb9ee655fec2dfc7" title="_sq" alt="" coords="459,5,501,35"/><area shape="rect" id="node5" href="lbann__layer__fully__connected_8cpp.html#afc141da3841a084e603a2e8db5b4a839" title="_sqrt" alt="" coords="455,59,505,88"/><area shape="rect" id="node7" href="classlbann_1_1lbann__quantizer.html#a52820f8b0868a7f8f3a57ade0c663c3c" title="lbann::lbann_quantizer::get_quantized_matrix_height" alt="" coords="641,111,967,140"/><area shape="rect" id="node9" href="classlbann_1_1lbann__quantizer.html#a3801d9cd1a1adefb160b69dbd7e499ef" title="lbann::lbann_quantizer::quantize" alt="" coords="376,163,584,192"/><area shape="rect" id="node14" href="classlbann_1_1lbann__quantizer.html#a8eb42b16ff79799e3e81733b7921a789" title="lbann::lbann_quantizer::unquantize" alt="" coords="369,216,591,245"/><area shape="rect" id="node11" href="namespacelbann.html#a4fea7ba21017b49d1e34394b4c20c764" title="lbann::get_generator" alt="" coords="735,164,873,193"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a97db186341c0819c8d52e2f815deb2a7_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a97db186341c0819c8d52e2f815deb2a7_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a97db186341c0819c8d52e2f815deb2a7_icgraph_map" id="classlbann_1_1lbann__quantizer_a97db186341c0819c8d52e2f815deb2a7_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a4877befb2683f16a03fdf91ed1353636" title="lbann::lbann_quantizer::intermodel_sum_quantized" alt="" coords="385,5,700,35"/><area shape="rect" id="node5" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback_imcomm::on_backward_prop_end" alt="" coords="368,59,717,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a35ca3e61f358ccb63c233d85236dfec1"></a><!-- doxytag: member="lbann::lbann_quantizer::intermodel_sum_quantized2" ref="a35ca3e61f358ccb63c233d85236dfec1" args="(lbann_comm *comm, DistMat &amp;mat, Mat &amp;qerror, Mat &amp;im_qerror)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_quantized2 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&nbsp;</td>
          <td class="paramname"> <em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>im_qerror</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00304">304</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00305"></a>00305                                                                              {
<a name="l00306"></a>00306   <a class="code" href="classlbann_1_1lbann__quantizer.html#a0e271e3f75667540f5bde94fbcd3ef0e">intermodel_sum_quantized2</a>(<a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat.Matrix(), qerror, im_qerror);
<a name="l00307"></a>00307 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a35ca3e61f358ccb63c233d85236dfec1_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a35ca3e61f358ccb63c233d85236dfec1_cgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a35ca3e61f358ccb63c233d85236dfec1_cgraph_map" id="classlbann_1_1lbann__quantizer_a35ca3e61f358ccb63c233d85236dfec1_cgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a0e271e3f75667540f5bde94fbcd3ef0e" title="lbann::lbann_quantizer::intermodel_sum_quantized2" alt="" coords="376,139,699,168"/><area shape="rect" id="node5" href="classlbann_1_1lbann__comm.html#a6c201108eb6b5a1e23021db29cef655b" title="lbann::lbann_comm::get_model_rank" alt="" coords="751,5,985,35"/><area shape="rect" id="node7" href="classlbann_1_1lbann__comm.html#a54842b679a3756cf79b43baf46caf637" title="lbann::lbann_comm::get_num_models" alt="" coords="747,59,989,88"/><area shape="rect" id="node9" href="classlbann_1_1lbann__quantizer.html#a3801d9cd1a1adefb160b69dbd7e499ef" title="lbann::lbann_quantizer::quantize" alt="" coords="764,112,972,141"/><area shape="rect" id="node15" href="classlbann_1_1lbann__comm.html#af3560cb26adf60212085e7b1d8e8dade" title="lbann::lbann_comm::recv" alt="" coords="784,165,952,195"/><area shape="rect" id="node19" href="classlbann_1_1lbann__comm.html#ac7e32d53c55b0e0fc8b72ae943d997ce" title="lbann::lbann_comm::send" alt="" coords="783,219,953,248"/><area shape="rect" id="node22" href="classlbann_1_1lbann__quantizer.html#a8eb42b16ff79799e3e81733b7921a789" title="lbann::lbann_quantizer::unquantize" alt="" coords="757,272,979,301"/><area shape="rect" id="node11" href="namespacelbann.html#a4fea7ba21017b49d1e34394b4c20c764" title="lbann::get_generator" alt="" coords="1132,85,1271,115"/><area shape="rect" id="node13" href="classlbann_1_1lbann__quantizer.html#a52820f8b0868a7f8f3a57ade0c663c3c" title="lbann::lbann_quantizer::get_quantized_matrix_height" alt="" coords="1039,139,1364,168"/><area shape="rect" id="node17" href="classlbann_1_1lbann__comm.html#a676b64be1b9429b85e8dac09728ba490" title="lbann::lbann_comm::get_world_rank" alt="" coords="1087,205,1316,235"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0e271e3f75667540f5bde94fbcd3ef0e"></a><!-- doxytag: member="lbann::lbann_quantizer::intermodel_sum_quantized2" ref="a0e271e3f75667540f5bde94fbcd3ef0e" args="(lbann_comm *comm, Mat &amp;mat, Mat &amp;qerror, Mat &amp;im_qerror)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_quantized2 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&nbsp;</td>
          <td class="paramname"> <em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>im_qerror</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00272">272</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00273"></a>00273                                                                               {
<a name="l00274"></a>00274   <span class="keywordflow">if</span> (qerror_.Height() == 0) {
<a name="l00275"></a>00275     Zeros(qerror_, mat_.Height(), mat_.Width());
<a name="l00276"></a>00276   }
<a name="l00277"></a>00277   <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> mat;
<a name="l00278"></a>00278   Transpose(mat_, mat);
<a name="l00279"></a>00279   <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> qerror;
<a name="l00280"></a>00280   Transpose(qerror_, qerror);
<a name="l00281"></a>00281   <a class="code" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> qmat;
<a name="l00282"></a>00282   <a class="code" href="classlbann_1_1lbann__quantizer.html#a3801d9cd1a1adefb160b69dbd7e499ef">quantize</a>(mat, qmat, qerror);
<a name="l00283"></a>00283   <a class="code" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> recv_qmat;
<a name="l00284"></a>00284   recv_qmat.Resize(qmat.Height(), qmat.Width());
<a name="l00285"></a>00285   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;get_num_models(); ++i) {
<a name="l00286"></a>00286     <span class="keywordflow">if</span> (i == <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;get_model_rank()) {
<a name="l00287"></a>00287       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> dst = 0; dst &lt; <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;get_num_models(); ++dst) {
<a name="l00288"></a>00288         <span class="keywordflow">if</span> (dst != <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;get_model_rank()) {
<a name="l00289"></a>00289           <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;send(qmat.Buffer(), qmat.Width() * qmat.Height(), dst);
<a name="l00290"></a>00290         }
<a name="l00291"></a>00291       }
<a name="l00292"></a>00292     } <span class="keywordflow">else</span> {
<a name="l00293"></a>00293       <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;recv(recv_qmat.Buffer(), recv_qmat.Width() * recv_qmat.Height(), i);
<a name="l00294"></a>00294       <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> uqmat;
<a name="l00295"></a>00295       uqmat.Resize(mat.Height(), mat.Width());
<a name="l00296"></a>00296       <a class="code" href="classlbann_1_1lbann__quantizer.html#a8eb42b16ff79799e3e81733b7921a789">unquantize</a>(recv_qmat, uqmat);
<a name="l00297"></a>00297       mat += uqmat;
<a name="l00298"></a>00298     }
<a name="l00299"></a>00299   }
<a name="l00300"></a>00300   Transpose(mat, mat_);
<a name="l00301"></a>00301   Transpose(qerror, qerror_);
<a name="l00302"></a>00302 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a0e271e3f75667540f5bde94fbcd3ef0e_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a0e271e3f75667540f5bde94fbcd3ef0e_cgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a0e271e3f75667540f5bde94fbcd3ef0e_cgraph_map" id="classlbann_1_1lbann__quantizer_a0e271e3f75667540f5bde94fbcd3ef0e_cgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__comm.html#a6c201108eb6b5a1e23021db29cef655b" title="lbann::lbann_comm::get_model_rank" alt="" coords="380,5,615,35"/><area shape="rect" id="node5" href="classlbann_1_1lbann__comm.html#a54842b679a3756cf79b43baf46caf637" title="lbann::lbann_comm::get_num_models" alt="" coords="376,59,619,88"/><area shape="rect" id="node7" href="classlbann_1_1lbann__quantizer.html#a3801d9cd1a1adefb160b69dbd7e499ef" title="lbann::lbann_quantizer::quantize" alt="" coords="393,112,601,141"/><area shape="rect" id="node13" href="classlbann_1_1lbann__comm.html#af3560cb26adf60212085e7b1d8e8dade" title="lbann::lbann_comm::recv" alt="" coords="413,165,581,195"/><area shape="rect" id="node17" href="classlbann_1_1lbann__comm.html#ac7e32d53c55b0e0fc8b72ae943d997ce" title="lbann::lbann_comm::send" alt="" coords="412,219,583,248"/><area shape="rect" id="node20" href="classlbann_1_1lbann__quantizer.html#a8eb42b16ff79799e3e81733b7921a789" title="lbann::lbann_quantizer::unquantize" alt="" coords="387,272,608,301"/><area shape="rect" id="node9" href="namespacelbann.html#a4fea7ba21017b49d1e34394b4c20c764" title="lbann::get_generator" alt="" coords="761,85,900,115"/><area shape="rect" id="node11" href="classlbann_1_1lbann__quantizer.html#a52820f8b0868a7f8f3a57ade0c663c3c" title="lbann::lbann_quantizer::get_quantized_matrix_height" alt="" coords="668,139,993,168"/><area shape="rect" id="node15" href="classlbann_1_1lbann__comm.html#a676b64be1b9429b85e8dac09728ba490" title="lbann::lbann_comm::get_world_rank" alt="" coords="716,205,945,235"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a0e271e3f75667540f5bde94fbcd3ef0e_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a0e271e3f75667540f5bde94fbcd3ef0e_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a0e271e3f75667540f5bde94fbcd3ef0e_icgraph_map" id="classlbann_1_1lbann__quantizer_a0e271e3f75667540f5bde94fbcd3ef0e_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a35ca3e61f358ccb63c233d85236dfec1" title="lbann::lbann_quantizer::intermodel_sum_quantized2" alt="" coords="376,5,699,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae99dc11003cecd04e599d68c99d90c0b"></a><!-- doxytag: member="lbann::lbann_quantizer::intermodel_sum_threshold_quantized" ref="ae99dc11003cecd04e599d68c99d90c0b" args="(lbann_comm *comm, DistMat &amp;mat, Mat &amp;qerror, DataType pos_thresh, DataType neg_thresh, Mat &amp;im_qerror, bool compress=true)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_threshold_quantized </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&nbsp;</td>
          <td class="paramname"> <em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&nbsp;</td>
          <td class="paramname"> <em>pos_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&nbsp;</td>
          <td class="paramname"> <em>neg_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>im_qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>compress</em> = <code>true</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00765">765</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00767"></a>00767                                                       {
<a name="l00768"></a>00768   <a class="code" href="classlbann_1_1lbann__quantizer.html#a4cf9d4cd5262b21939e95fc34ad0a09f">intermodel_sum_threshold_quantized</a>(<a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat.Matrix(), qerror, pos_thresh,
<a name="l00769"></a>00769                                      neg_thresh, im_qerror, compress);
<a name="l00770"></a>00770 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_ae99dc11003cecd04e599d68c99d90c0b_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_ae99dc11003cecd04e599d68c99d90c0b_cgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_ae99dc11003cecd04e599d68c99d90c0b_cgraph_map" id="classlbann_1_1lbann__quantizer_ae99dc11003cecd04e599d68c99d90c0b_cgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a4cf9d4cd5262b21939e95fc34ad0a09f" title="lbann::lbann_quantizer::intermodel_sum_threshold_quantized" alt="" coords="431,139,804,168"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#ad8d07c3ffddff08800887dff354ffed2" title="lbann::lbann_quantizer::compress_thresholds" alt="" coords="873,5,1156,35"/><area shape="rect" id="node7" href="classlbann_1_1lbann__quantizer.html#a00106e69ea8a6dfe9e9a91c75b845bcd" title="lbann::lbann_quantizer::threshold_quantize" alt="" coords="880,59,1149,88"/><area shape="rect" id="node9" href="classlbann_1_1lbann__quantizer.html#a8871704ae757f1bd83f3948d61b1cdad" title="lbann::lbann_quantizer::threshold_quantize_apply" alt="" coords="861,112,1168,141"/><area shape="rect" id="node11" href="classlbann_1_1lbann__quantizer.html#a0f5f3b0149715ab59202b8884a87c7d5" title="lbann::lbann_quantizer::threshold_unquantize" alt="" coords="873,165,1156,195"/><area shape="rect" id="node13" href="classlbann_1_1lbann__quantizer.html#a94d55b41dd60582f4412d5e24a0eeffe" title="lbann::lbann_quantizer::threshold_unquantize_apply" alt="" coords="855,219,1175,248"/><area shape="rect" id="node15" href="classlbann_1_1lbann__quantizer.html#afb58d63b174c3a937f3c3b21eb269b77" title="lbann::lbann_quantizer::uncompress_thresholds" alt="" coords="865,272,1164,301"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4cf9d4cd5262b21939e95fc34ad0a09f"></a><!-- doxytag: member="lbann::lbann_quantizer::intermodel_sum_threshold_quantized" ref="a4cf9d4cd5262b21939e95fc34ad0a09f" args="(lbann_comm *comm, Mat &amp;mat, Mat &amp;qerror, DataType pos_thresh, DataType neg_thresh, Mat &amp;im_qerror, bool compress=true)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_threshold_quantized </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&nbsp;</td>
          <td class="paramname"> <em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&nbsp;</td>
          <td class="paramname"> <em>pos_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&nbsp;</td>
          <td class="paramname"> <em>neg_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>im_qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>compress</em> = <code>true</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>As with intermodel_sum_quantized, but use threshold quantization. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00675">675</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00677"></a>00677                                                       {
<a name="l00678"></a>00678   <span class="keywordflow">if</span> (qerror.Height() == 0) {
<a name="l00679"></a>00679     qerror.Resize(mat.Height(), mat.Width(), mat.LDim());
<a name="l00680"></a>00680     Zero(qerror);
<a name="l00681"></a>00681   }
<a name="l00682"></a>00682   <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> rs_quant;
<a name="l00683"></a>00683   <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> rs_recv;
<a name="l00684"></a>00684   std::vector&lt;unsigned&gt; positions;
<a name="l00685"></a>00685   <span class="keyword">auto</span> rs_send_trans = 
<a name="l00686"></a>00686     [&amp;qerror, &amp;rs_quant, compress, pos_thresh, neg_thresh, <span class="keyword">this</span>]
<a name="l00687"></a>00687     (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; mat, IR h, IR w, <span class="keywordtype">int</span>&amp; count) {
<a name="l00688"></a>00688       <span class="keyword">auto</span> to_send = mat(h, w);
<a name="l00689"></a>00689       <span class="keyword">auto</span> to_send_qerr = qerror(h, w);
<a name="l00690"></a>00690       rs_quant.clear();
<a name="l00691"></a>00691       <a class="code" href="classlbann_1_1lbann__quantizer.html#a00106e69ea8a6dfe9e9a91c75b845bcd">threshold_quantize</a>(to_send, rs_quant, to_send_qerr, pos_thresh,
<a name="l00692"></a>00692                          neg_thresh, compress);
<a name="l00693"></a>00693       <span class="keywordflow">if</span> (compress) {
<a name="l00694"></a>00694         <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> comp;
<a name="l00695"></a>00695         <a class="code" href="classlbann_1_1lbann__quantizer.html#ad8d07c3ffddff08800887dff354ffed2">compress_thresholds</a>(rs_quant, comp);
<a name="l00696"></a>00696         std::swap(rs_quant, comp);
<a name="l00697"></a>00697       }
<a name="l00698"></a>00698       count = rs_quant.size();
<a name="l00699"></a>00699       <span class="keywordflow">return</span> rs_quant.data();
<a name="l00700"></a>00700     };
<a name="l00701"></a>00701   <span class="keyword">auto</span> rs_get_recv_buf = 
<a name="l00702"></a>00702     [&amp;rs_recv] (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; mat, <span class="keywordtype">int</span>&amp; count) {
<a name="l00703"></a>00703       rs_recv.resize(count);
<a name="l00704"></a>00704       <span class="keywordflow">return</span> rs_recv.data();
<a name="l00705"></a>00705     };
<a name="l00706"></a>00706   <span class="keyword">auto</span> rs_recv_trans = 
<a name="l00707"></a>00707     [&amp;rs_recv, &amp;positions, compress, pos_thresh, neg_thresh, <span class="keyword">this</span>]
<a name="l00708"></a>00708     (<a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a>* buf, <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; accum) {
<a name="l00709"></a>00709       <span class="keywordflow">if</span> (compress) {
<a name="l00710"></a>00710         <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> uncomp;
<a name="l00711"></a>00711         <a class="code" href="classlbann_1_1lbann__quantizer.html#afb58d63b174c3a937f3c3b21eb269b77">uncompress_thresholds</a>(rs_recv, uncomp);
<a name="l00712"></a>00712         std::swap(rs_recv, uncomp);
<a name="l00713"></a>00713       }
<a name="l00714"></a>00714       <a class="code" href="classlbann_1_1lbann__quantizer.html#a94d55b41dd60582f4412d5e24a0eeffe">threshold_unquantize_apply</a>(rs_recv, accum, pos_thresh,
<a name="l00715"></a>00715                                  neg_thresh, positions, compress);
<a name="l00716"></a>00716     };
<a name="l00717"></a>00717   intermodel_ring_reduce_scatter&lt;uqtype&gt;(<a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat, <span class="keyword">true</span>, rs_send_trans,
<a name="l00718"></a>00718                                          rs_get_recv_buf, rs_recv_trans);
<a name="l00719"></a>00719   <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> ag_send;
<a name="l00720"></a>00720   <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> ag_recv;
<a name="l00721"></a>00721   <span class="keyword">auto</span> ag_reduced_trans =
<a name="l00722"></a>00722     [&amp;im_qerror, &amp;ag_send, &amp;positions, compress, pos_thresh, neg_thresh, <span class="keyword">this</span>]
<a name="l00723"></a>00723     (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; reduced) {
<a name="l00724"></a>00724       <span class="keywordflow">if</span> (im_qerror.Height() == 0) {
<a name="l00725"></a>00725         im_qerror.Resize(reduced.Height(), reduced.Width(), reduced.LDim());
<a name="l00726"></a>00726         Zero(im_qerror);
<a name="l00727"></a>00727       }
<a name="l00728"></a>00728       <a class="code" href="classlbann_1_1lbann__quantizer.html#a8871704ae757f1bd83f3948d61b1cdad">threshold_quantize_apply</a>(reduced, ag_send, im_qerror, pos_thresh,
<a name="l00729"></a>00729                                neg_thresh, positions, compress);
<a name="l00730"></a>00730       <span class="keywordflow">if</span> (compress) {
<a name="l00731"></a>00731         <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> comp;
<a name="l00732"></a>00732         <a class="code" href="classlbann_1_1lbann__quantizer.html#ad8d07c3ffddff08800887dff354ffed2">compress_thresholds</a>(ag_send, comp);
<a name="l00733"></a>00733         std::swap(ag_send, comp);
<a name="l00734"></a>00734       }
<a name="l00735"></a>00735     };
<a name="l00736"></a>00736   <span class="keyword">auto</span> ag_get_send_buf = [&amp;ag_send] (<span class="keywordtype">int</span>&amp; count) {
<a name="l00737"></a>00737       count = ag_send.size();
<a name="l00738"></a>00738       <span class="keywordflow">return</span> ag_send.data();
<a name="l00739"></a>00739     };
<a name="l00740"></a>00740   <span class="keyword">auto</span> ag_get_recv_buf =
<a name="l00741"></a>00741     [&amp;ag_recv] (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; recv_view, <span class="keywordtype">int</span>&amp; count) {
<a name="l00742"></a>00742       ag_recv.resize(count);
<a name="l00743"></a>00743       <span class="keywordflow">return</span> ag_recv.data();
<a name="l00744"></a>00744     };
<a name="l00745"></a>00745   <span class="keyword">auto</span> ag_recv_trans = 
<a name="l00746"></a>00746     [&amp;ag_recv, compress, pos_thresh, neg_thresh, <span class="keyword">this</span>]
<a name="l00747"></a>00747     (<a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a>*, <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; accum) {
<a name="l00748"></a>00748       <span class="keywordflow">if</span> (compress) {
<a name="l00749"></a>00749         <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> uncomp;
<a name="l00750"></a>00750         <a class="code" href="classlbann_1_1lbann__quantizer.html#afb58d63b174c3a937f3c3b21eb269b77">uncompress_thresholds</a>(ag_recv, uncomp);
<a name="l00751"></a>00751         <a class="code" href="classlbann_1_1lbann__quantizer.html#a0f5f3b0149715ab59202b8884a87c7d5">threshold_unquantize</a>(uncomp, accum, pos_thresh, neg_thresh, compress);
<a name="l00752"></a>00752       } <span class="keywordflow">else</span> {
<a name="l00753"></a>00753         <a class="code" href="classlbann_1_1lbann__quantizer.html#a0f5f3b0149715ab59202b8884a87c7d5">threshold_unquantize</a>(ag_recv, accum, pos_thresh, neg_thresh);
<a name="l00754"></a>00754       }
<a name="l00755"></a>00755     };
<a name="l00756"></a>00756   <span class="keyword">auto</span> ag_swap_bufs =
<a name="l00757"></a>00757     [&amp;ag_send, &amp;ag_recv] (uqtype*, uqtype*) {
<a name="l00758"></a>00758       std::swap(ag_send, ag_recv);
<a name="l00759"></a>00759     };
<a name="l00760"></a>00760   intermodel_ring_allgather&lt;uqtype&gt;(comm, mat, <span class="keyword">true</span>, ag_reduced_trans,
<a name="l00761"></a>00761                                     ag_get_send_buf, ag_get_recv_buf,
<a name="l00762"></a>00762                                     ag_recv_trans, ag_swap_bufs);
<a name="l00763"></a>00763 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a4cf9d4cd5262b21939e95fc34ad0a09f_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a4cf9d4cd5262b21939e95fc34ad0a09f_cgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a4cf9d4cd5262b21939e95fc34ad0a09f_cgraph_map" id="classlbann_1_1lbann__quantizer_a4cf9d4cd5262b21939e95fc34ad0a09f_cgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#ad8d07c3ffddff08800887dff354ffed2" title="lbann::lbann_quantizer::compress_thresholds" alt="" coords="449,5,732,35"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#a00106e69ea8a6dfe9e9a91c75b845bcd" title="lbann::lbann_quantizer::threshold_quantize" alt="" coords="456,59,725,88"/><area shape="rect" id="node7" href="classlbann_1_1lbann__quantizer.html#a8871704ae757f1bd83f3948d61b1cdad" title="lbann::lbann_quantizer::threshold_quantize_apply" alt="" coords="437,112,744,141"/><area shape="rect" id="node9" href="classlbann_1_1lbann__quantizer.html#a0f5f3b0149715ab59202b8884a87c7d5" title="lbann::lbann_quantizer::threshold_unquantize" alt="" coords="449,165,732,195"/><area shape="rect" id="node11" href="classlbann_1_1lbann__quantizer.html#a94d55b41dd60582f4412d5e24a0eeffe" title="lbann::lbann_quantizer::threshold_unquantize_apply" alt="" coords="431,219,751,248"/><area shape="rect" id="node13" href="classlbann_1_1lbann__quantizer.html#afb58d63b174c3a937f3c3b21eb269b77" title="lbann::lbann_quantizer::uncompress_thresholds" alt="" coords="441,272,740,301"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a4cf9d4cd5262b21939e95fc34ad0a09f_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a4cf9d4cd5262b21939e95fc34ad0a09f_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a4cf9d4cd5262b21939e95fc34ad0a09f_icgraph_map" id="classlbann_1_1lbann__quantizer_a4cf9d4cd5262b21939e95fc34ad0a09f_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#ae99dc11003cecd04e599d68c99d90c0b" title="lbann::lbann_quantizer::intermodel_sum_threshold_quantized" alt="" coords="431,5,804,35"/><area shape="rect" id="node5" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback_imcomm::on_backward_prop_end" alt="" coords="443,59,792,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a621ce88c0a961cfdb00c94ab24d659e0"></a><!-- doxytag: member="lbann::lbann_quantizer::proportion_threshold_average" ref="a621ce88c0a961cfdb00c94ab24d659e0" args="(const Mat &amp;mat, const Mat &amp;qerror, int proportion, int col, bool sample=true)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::tuple&lt; <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> &gt; lbann::lbann_quantizer::proportion_threshold_average </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>proportion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>col</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>sample</em> = <code>true</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Compute positive and negative threshold values such that only one in proportion of positive and negative entries are greater than or equal to the threshold. Additionally, compute the average value of the positive and negative values greater than this threshold. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>mat</em>&nbsp;</td><td>The matrix to compute threshold values for. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>qerror</em>&nbsp;</td><td>The accumulated quantization error in mat. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>proportion</em>&nbsp;</td><td>Proportion of entries to keep. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>col</em>&nbsp;</td><td>The column to compute values for. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sample</em>&nbsp;</td><td>Whether to approximate stats with a sample. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>In this order: The positive and negative threshold values, then the positive and negative averages. </dd></dl>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l01050">1050</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01051"></a>01051                                                                            {
<a name="l01052"></a>01052   <span class="keywordtype">double</span> pta_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();
<a name="l01053"></a>01053   std::vector&lt;DataType&gt; pos_entries;
<a name="l01054"></a>01054   std::vector&lt;DataType&gt; neg_entries;
<a name="l01055"></a>01055   <span class="keyword">const</span> Int height = mat.Height();
<a name="l01056"></a>01056   <span class="keyword">const</span> Int col_offset = col * mat.LDim();
<a name="l01057"></a>01057   <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ mat_buf = mat.LockedBuffer();
<a name="l01058"></a>01058   <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ qerror_buf = qerror.LockedBuffer();
<a name="l01059"></a>01059   <span class="keywordflow">if</span> (height &lt;= <a class="code" href="classlbann_1_1lbann__quantizer.html#a41cdad23feaf0414ad61cf3ceafc5c39">NUM_PTA_SAMPLES</a> || !sample) {
<a name="l01060"></a>01060     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> row = 0; row &lt; height; ++row) {
<a name="l01061"></a>01061       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> pos = row + col_offset;
<a name="l01062"></a>01062       <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> val = mat_buf[pos] + qerror_buf[pos];
<a name="l01063"></a>01063       <span class="keywordflow">if</span> (val &gt;= 0.0f) {
<a name="l01064"></a>01064         pos_entries.emplace_back(val);
<a name="l01065"></a>01065       } <span class="keywordflow">else</span> {
<a name="l01066"></a>01066         <span class="comment">// Flip negative entries to make selection easier.</span>
<a name="l01067"></a>01067         neg_entries.emplace_back(-1 * val);
<a name="l01068"></a>01068       }
<a name="l01069"></a>01069     }
<a name="l01070"></a>01070   } <span class="keywordflow">else</span> {
<a name="l01071"></a>01071     <span class="comment">// Randomly sample NUM_PTA_SAMPLES entries and use these to approximate</span>
<a name="l01072"></a>01072     <span class="comment">// everything.</span>
<a name="l01073"></a>01073     std::uniform_int_distribution&lt;int&gt; row_dist(0, height - 1);
<a name="l01074"></a>01074     <a class="code" href="namespacelbann.html#aa54070c91e931f303a89f162e91de8cc">rng_gen</a>&amp; gen = <a class="code" href="namespacelbann.html#a4fea7ba21017b49d1e34394b4c20c764">get_generator</a>();
<a name="l01075"></a>01075     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; <a class="code" href="classlbann_1_1lbann__quantizer.html#a41cdad23feaf0414ad61cf3ceafc5c39">NUM_PTA_SAMPLES</a>; ++i) {
<a name="l01076"></a>01076       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> pos = row_dist(gen) + col_offset;
<a name="l01077"></a>01077       <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> val = mat_buf[pos] + qerror_buf[pos];
<a name="l01078"></a>01078       <span class="keywordflow">if</span> (val &gt;= 0.0f) {
<a name="l01079"></a>01079         pos_entries.emplace_back(val);
<a name="l01080"></a>01080       } <span class="keywordflow">else</span> {
<a name="l01081"></a>01081         neg_entries.emplace_back(-1 * val);
<a name="l01082"></a>01082       }
<a name="l01083"></a>01083     }
<a name="l01084"></a>01084   }
<a name="l01085"></a>01085   <span class="comment">// Determine how many positive/negative entries we need to keep.</span>
<a name="l01086"></a>01086   <span class="keywordtype">int</span> pos_to_keep = pos_entries.size() / proportion;
<a name="l01087"></a>01087   <span class="keywordflow">if</span> (pos_to_keep == 0) {
<a name="l01088"></a>01088     pos_to_keep = 1;
<a name="l01089"></a>01089   }
<a name="l01090"></a>01090   <span class="keywordtype">int</span> neg_to_keep = neg_entries.size() / proportion;
<a name="l01091"></a>01091   <span class="keywordflow">if</span> (neg_to_keep == 0) {
<a name="l01092"></a>01092     neg_to_keep = 1;
<a name="l01093"></a>01093   }
<a name="l01094"></a>01094   <span class="comment">// Determine the threshold value with a selection algorithm to keep only the</span>
<a name="l01095"></a>01095   <span class="comment">// largest pos/neg_to_keep elements.</span>
<a name="l01096"></a>01096   <span class="comment">// Set to 0 if there&apos;s none.</span>
<a name="l01097"></a>01097   <span class="comment">// The partitioning also guarantees everything after the i&apos;th element is</span>
<a name="l01098"></a>01098   <span class="comment">// greater than or equal to it.</span>
<a name="l01099"></a>01099   <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_thresh = 0.0f;
<a name="l01100"></a>01100   <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_thresh = 0.0f;
<a name="l01101"></a>01101   <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_avg = 0.0f;
<a name="l01102"></a>01102   <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_avg = 0.0f;
<a name="l01103"></a>01103   <span class="keywordflow">if</span> (pos_to_keep &gt; 0 &amp;&amp; pos_entries.size() &gt; 0) {
<a name="l01104"></a>01104     <span class="keyword">auto</span> i = pos_entries.begin() + (pos_entries.size() - pos_to_keep);
<a name="l01105"></a>01105     std::nth_element(pos_entries.begin(), i, pos_entries.end());
<a name="l01106"></a>01106     pos_thresh = *i;
<a name="l01107"></a>01107     <span class="keywordflow">for</span> (; i != pos_entries.end(); ++i) {
<a name="l01108"></a>01108       pos_avg += *i;
<a name="l01109"></a>01109     }
<a name="l01110"></a>01110     pos_avg /= pos_to_keep;
<a name="l01111"></a>01111   }
<a name="l01112"></a>01112   <span class="keywordflow">if</span> (neg_to_keep &gt; 0 &amp;&amp; neg_entries.size() &gt; 0) {
<a name="l01113"></a>01113     <span class="keyword">auto</span> i = neg_entries.begin() + (neg_entries.size() - neg_to_keep);
<a name="l01114"></a>01114     std::nth_element(neg_entries.begin(), i, neg_entries.end());
<a name="l01115"></a>01115     neg_thresh = -1 * (*i);
<a name="l01116"></a>01116     <span class="keywordflow">for</span> (; i != neg_entries.end(); ++i) {
<a name="l01117"></a>01117       neg_avg -= *i;
<a name="l01118"></a>01118     }
<a name="l01119"></a>01119     neg_avg /= neg_to_keep;
<a name="l01120"></a>01120   }
<a name="l01121"></a>01121   <a class="code" href="classlbann_1_1lbann__quantizer.html#a74cac02b60940fec951339e9197d8463">pta_time</a> += <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - pta_start;
<a name="l01122"></a>01122   <span class="keywordflow">return</span> std::make_tuple(pos_thresh, neg_thresh, pos_avg, neg_avg);
<a name="l01123"></a>01123 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a621ce88c0a961cfdb00c94ab24d659e0_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a621ce88c0a961cfdb00c94ab24d659e0_cgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a621ce88c0a961cfdb00c94ab24d659e0_cgraph_map" id="classlbann_1_1lbann__quantizer_a621ce88c0a961cfdb00c94ab24d659e0_cgraph">
<area shape="rect" id="node3" href="namespacelbann.html#a4fea7ba21017b49d1e34394b4c20c764" title="lbann::get_generator" alt="" coords="385,5,524,35"/><area shape="rect" id="node5" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f" title="lbann::get_time" alt="" coords="400,59,509,88"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a621ce88c0a961cfdb00c94ab24d659e0_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a621ce88c0a961cfdb00c94ab24d659e0_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a621ce88c0a961cfdb00c94ab24d659e0_icgraph_map" id="classlbann_1_1lbann__quantizer_a621ce88c0a961cfdb00c94ab24d659e0_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a8b920e254dcdc72b5a4785c740389dfe" title="lbann::lbann_quantizer::adaptive_threshold_quantize" alt="" coords="384,32,709,61"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#ac625cd41e898ab531ecbcdd864e0748e" title="lbann::lbann_quantizer::adaptive_threshold_quantize" alt="" coords="811,5,1136,35"/><area shape="rect" id="node7" href="classlbann_1_1lbann__quantizer.html#a28e74da8473ea1b475ff3976676898c4" title="lbann::lbann_quantizer::intermodel_sum_adaptive_threshold_quantized" alt="" coords="759,59,1188,88"/><area shape="rect" id="node9" href="classlbann_1_1lbann__quantizer.html#acf0864e7c687806af3155655a33ed364" title="lbann::lbann_quantizer::intermodel_sum_adaptive_threshold_quantized" alt="" coords="1239,32,1668,61"/><area shape="rect" id="node11" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback_imcomm::on_backward_prop_end" alt="" coords="1279,85,1628,115"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa516ede3d1fd798bb5ef5c2cf28cb53d"></a><!-- doxytag: member="lbann::lbann_quantizer::quantize" ref="aa516ede3d1fd798bb5ef5c2cf28cb53d" args="(const DistMat &amp;mat, QuantizedMatrix &amp;qmat, Mat &amp;qerror, bool sample=true)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::quantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>qmat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>sample</em> = <code>true</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00136">136</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00137"></a>00137                                                          {
<a name="l00138"></a>00138   <a class="code" href="classlbann_1_1lbann__quantizer.html#a3801d9cd1a1adefb160b69dbd7e499ef">quantize</a>(mat.LockedMatrix(), qmat, qerror, sample);
<a name="l00139"></a>00139 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_aa516ede3d1fd798bb5ef5c2cf28cb53d_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_aa516ede3d1fd798bb5ef5c2cf28cb53d_cgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_aa516ede3d1fd798bb5ef5c2cf28cb53d_cgraph_map" id="classlbann_1_1lbann__quantizer_aa516ede3d1fd798bb5ef5c2cf28cb53d_cgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a3801d9cd1a1adefb160b69dbd7e499ef" title="lbann::lbann_quantizer::quantize" alt="" coords="265,32,473,61"/><area shape="rect" id="node5" href="namespacelbann.html#a4fea7ba21017b49d1e34394b4c20c764" title="lbann::get_generator" alt="" coords="617,5,756,35"/><area shape="rect" id="node7" href="classlbann_1_1lbann__quantizer.html#a52820f8b0868a7f8f3a57ade0c663c3c" title="lbann::lbann_quantizer::get_quantized_matrix_height" alt="" coords="524,59,849,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a3801d9cd1a1adefb160b69dbd7e499ef"></a><!-- doxytag: member="lbann::lbann_quantizer::quantize" ref="a3801d9cd1a1adefb160b69dbd7e499ef" args="(const Mat &amp;mat, QuantizedMatrix &amp;qmat, Mat &amp;qerror, bool sample=true)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::quantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>qmat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>sample</em> = <code>true</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Quantize a matrix. qerror needs to be initialized with: Zeros(qerror, mat.Height(), mat.Width()). </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>mat</em>&nbsp;</td><td>The matrix to quantize. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>qmat</em>&nbsp;</td><td>The output quantized matrix (will be resized). </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>qerror</em>&nbsp;</td><td>Running quantization error. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sample</em>&nbsp;</td><td>Whether to use samples to approximate averages. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00046">46</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00047"></a>00047                                                                    {
<a name="l00048"></a>00048   <span class="comment">// Set up the quantized matrix. (+2 for the averages.)</span>
<a name="l00049"></a>00049   <span class="keyword">const</span> <span class="keywordtype">int</span> qheight = <a class="code" href="classlbann_1_1lbann__quantizer.html#a52820f8b0868a7f8f3a57ade0c663c3c">get_quantized_matrix_height</a>(mat);
<a name="l00050"></a>00050   <span class="keyword">const</span> <span class="keywordtype">int</span> qwidth = mat.Width();
<a name="l00051"></a>00051   qmat.Resize(qheight, qwidth);
<a name="l00052"></a>00052 
<a name="l00053"></a>00053   <span class="keyword">const</span> Int width = mat.Width();
<a name="l00054"></a>00054   <span class="keyword">const</span> Int height = mat.Height();
<a name="l00055"></a>00055   <span class="keyword">const</span> Int ldim = mat.LDim();
<a name="l00056"></a>00056   <span class="keyword">const</span> Int qmat_ldim = qmat.LDim();
<a name="l00057"></a>00057   <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ mat_buf = mat.LockedBuffer();
<a name="l00058"></a>00058   <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ qerror_buf = qerror.Buffer();
<a name="l00059"></a>00059   <a class="code" href="classlbann_1_1lbann__quantizer.html#aad6499ee349e94a461538a8e4f867048">qtype</a>* __restrict__ qmat_buf = qmat.Buffer();
<a name="l00060"></a>00060 <span class="preprocessor">  #pragma omp parallel for schedule(static)</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> col = 0; col &lt; width; ++col) {
<a name="l00062"></a>00062     <span class="comment">// First compute the positive and negative column averages.</span>
<a name="l00063"></a>00063     <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_sum = 0.0f;
<a name="l00064"></a>00064     <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_sum = 0.0f;
<a name="l00065"></a>00065     <span class="keywordtype">size_t</span> num_pos = 0;
<a name="l00066"></a>00066     <span class="keywordtype">size_t</span> num_neg = 0;
<a name="l00067"></a>00067     <span class="keywordflow">if</span> (height &lt;= <a class="code" href="classlbann_1_1lbann__quantizer.html#a804753c85f84fde1adc2cb7275a1158c">NUM_ONEBIT_SAMPLES</a> || !sample) {
<a name="l00068"></a>00068       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> row = 0; row &lt; height; ++row) {
<a name="l00069"></a>00069         <span class="keyword">const</span> <span class="keywordtype">int</span> pos = row + col * ldim;
<a name="l00070"></a>00070         <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> val = mat_buf[pos] + qerror_buf[pos];
<a name="l00071"></a>00071         <span class="keywordflow">if</span> (val &gt;= 0.0f) {
<a name="l00072"></a>00072           pos_sum += val;
<a name="l00073"></a>00073           ++num_pos;
<a name="l00074"></a>00074         } <span class="keywordflow">else</span> {
<a name="l00075"></a>00075           neg_sum += val;
<a name="l00076"></a>00076           ++num_neg;
<a name="l00077"></a>00077         }
<a name="l00078"></a>00078       }
<a name="l00079"></a>00079     } <span class="keywordflow">else</span> {
<a name="l00080"></a>00080       <span class="comment">// Randomly sample NUM_ONEBIT_SAMPLES to approximate.</span>
<a name="l00081"></a>00081       std::uniform_int_distribution&lt;int&gt; row_dist(0, height - 1);
<a name="l00082"></a>00082       <a class="code" href="namespacelbann.html#aa54070c91e931f303a89f162e91de8cc">rng_gen</a>&amp; gen = <a class="code" href="namespacelbann.html#a4fea7ba21017b49d1e34394b4c20c764">get_generator</a>();
<a name="l00083"></a>00083       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; <a class="code" href="classlbann_1_1lbann__quantizer.html#a804753c85f84fde1adc2cb7275a1158c">NUM_ONEBIT_SAMPLES</a>; ++i) {
<a name="l00084"></a>00084         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> pos = row_dist(gen) + col * ldim;
<a name="l00085"></a>00085         <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> val = mat_buf[pos] + qerror_buf[pos];
<a name="l00086"></a>00086         <span class="keywordflow">if</span> (val &gt;= 0.0f) {
<a name="l00087"></a>00087           pos_sum += val;
<a name="l00088"></a>00088           ++num_pos;
<a name="l00089"></a>00089         } <span class="keywordflow">else</span> {
<a name="l00090"></a>00090           neg_sum += val;
<a name="l00091"></a>00091           ++num_neg;
<a name="l00092"></a>00092         }
<a name="l00093"></a>00093       }
<a name="l00094"></a>00094     }
<a name="l00095"></a>00095     <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> avg_pos = 0.0f;
<a name="l00096"></a>00096     <span class="keywordflow">if</span> (num_pos &gt; 0) {
<a name="l00097"></a>00097       avg_pos = pos_sum / num_pos;
<a name="l00098"></a>00098     }
<a name="l00099"></a>00099     <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> avg_neg = 0.0f;
<a name="l00100"></a>00100     <span class="keywordflow">if</span> (num_neg &gt; 0) {
<a name="l00101"></a>00101       avg_neg = neg_sum / num_neg;
<a name="l00102"></a>00102     }
<a name="l00103"></a>00103 
<a name="l00104"></a>00104     <span class="comment">// Store the averages.</span>
<a name="l00105"></a>00105     <span class="comment">// Use memcpy so that we don&apos;t violate aliasing rules.</span>
<a name="l00106"></a>00106     <a class="code" href="classlbann_1_1lbann__quantizer.html#aad6499ee349e94a461538a8e4f867048">qtype</a> tmp;
<a name="l00107"></a>00107     memcpy(&amp;tmp, &amp;avg_pos, <span class="keyword">sizeof</span>(avg_pos));
<a name="l00108"></a>00108     qmat.Set(0, col, tmp);
<a name="l00109"></a>00109     memcpy(&amp;tmp, &amp;avg_neg, <span class="keyword">sizeof</span>(avg_neg));
<a name="l00110"></a>00110     qmat.Set(1, col, tmp);
<a name="l00111"></a>00111 
<a name="l00112"></a>00112     <span class="comment">// Now quantize the column, NUM_BITS entries at a time.</span>
<a name="l00113"></a>00113     <span class="keywordtype">int</span> qrow = 2;
<a name="l00114"></a>00114     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> row_chunk = 0; row_chunk &lt; height; row_chunk += <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>) {
<a name="l00115"></a>00115       <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> q = 0;
<a name="l00116"></a>00116       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> bit = 0; bit &lt; <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>; ++bit) {
<a name="l00117"></a>00117         <span class="keywordtype">int</span> row = row_chunk + bit;
<a name="l00118"></a>00118         <span class="keywordflow">if</span> (row &gt;= height) {
<a name="l00119"></a>00119           <span class="keywordflow">break</span>;
<a name="l00120"></a>00120         }
<a name="l00121"></a>00121         <span class="keyword">const</span> <span class="keywordtype">int</span> pos = row + col * ldim;
<a name="l00122"></a>00122         <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> val = mat_buf[pos] + qerror_buf[pos];
<a name="l00123"></a>00123         <span class="keywordflow">if</span> (val &gt;= 0.0f) {
<a name="l00124"></a>00124           q |= 1 &lt;&lt; bit;
<a name="l00125"></a>00125           qerror_buf[pos] = val - avg_pos;
<a name="l00126"></a>00126         } <span class="keywordflow">else</span> {
<a name="l00127"></a>00127           qerror_buf[pos] = val - avg_neg;
<a name="l00128"></a>00128         }
<a name="l00129"></a>00129       }
<a name="l00130"></a>00130       qmat_buf[qrow + col * qmat_ldim] = (<a class="code" href="classlbann_1_1lbann__quantizer.html#aad6499ee349e94a461538a8e4f867048">qtype</a>) q;
<a name="l00131"></a>00131       ++qrow;
<a name="l00132"></a>00132     }
<a name="l00133"></a>00133   }
<a name="l00134"></a>00134 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a3801d9cd1a1adefb160b69dbd7e499ef_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a3801d9cd1a1adefb160b69dbd7e499ef_cgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a3801d9cd1a1adefb160b69dbd7e499ef_cgraph_map" id="classlbann_1_1lbann__quantizer_a3801d9cd1a1adefb160b69dbd7e499ef_cgraph">
<area shape="rect" id="node3" href="namespacelbann.html#a4fea7ba21017b49d1e34394b4c20c764" title="lbann::get_generator" alt="" coords="359,5,497,35"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#a52820f8b0868a7f8f3a57ade0c663c3c" title="lbann::lbann_quantizer::get_quantized_matrix_height" alt="" coords="265,59,591,88"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a3801d9cd1a1adefb160b69dbd7e499ef_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a3801d9cd1a1adefb160b69dbd7e499ef_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a3801d9cd1a1adefb160b69dbd7e499ef_icgraph_map" id="classlbann_1_1lbann__quantizer_a3801d9cd1a1adefb160b69dbd7e499ef_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a97db186341c0819c8d52e2f815deb2a7" title="lbann::lbann_quantizer::intermodel_sum_quantized" alt="" coords="268,59,583,88"/><area shape="rect" id="node9" href="classlbann_1_1lbann__quantizer.html#a0e271e3f75667540f5bde94fbcd3ef0e" title="lbann::lbann_quantizer::intermodel_sum_quantized2" alt="" coords="264,112,587,141"/><area shape="rect" id="node13" href="classlbann_1_1lbann__quantizer.html#aa516ede3d1fd798bb5ef5c2cf28cb53d" title="lbann::lbann_quantizer::quantize" alt="" coords="321,165,529,195"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#a4877befb2683f16a03fdf91ed1353636" title="lbann::lbann_quantizer::intermodel_sum_quantized" alt="" coords="652,5,967,35"/><area shape="rect" id="node7" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback_imcomm::on_backward_prop_end" alt="" coords="635,59,984,88"/><area shape="rect" id="node11" href="classlbann_1_1lbann__quantizer.html#a35ca3e61f358ccb63c233d85236dfec1" title="lbann::lbann_quantizer::intermodel_sum_quantized2" alt="" coords="648,112,971,141"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="afa32b747b7ac0dbea8df3b47593d54b7"></a><!-- doxytag: member="lbann::lbann_quantizer::reset_bytes_counters" ref="afa32b747b7ac0dbea8df3b47593d54b7" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::reset_bytes_counters </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Reset recorded bytes counters. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00238">238</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00238"></a>00238                               {
<a name="l00239"></a>00239     <a class="code" href="classlbann_1_1lbann__quantizer.html#a484e392b671e8eeaa3af5b5faa683bee">rs_bytes_sent</a> = 0;
<a name="l00240"></a>00240     <a class="code" href="classlbann_1_1lbann__quantizer.html#a3a9e25785189c84ba5a7fe055382ca92">ag_bytes_sent</a> = 0;
<a name="l00241"></a>00241     <a class="code" href="classlbann_1_1lbann__quantizer.html#a9b02b1adbc432e0d5b417ad6e098ed75">rs_bytes_received</a> = 0;
<a name="l00242"></a>00242     <a class="code" href="classlbann_1_1lbann__quantizer.html#ae29843bccd4f211f36f4dd357a066a5d">ag_bytes_received</a> = 0;
<a name="l00243"></a>00243   }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_afa32b747b7ac0dbea8df3b47593d54b7_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_afa32b747b7ac0dbea8df3b47593d54b7_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_afa32b747b7ac0dbea8df3b47593d54b7_icgraph_map" id="classlbann_1_1lbann__quantizer_afa32b747b7ac0dbea8df3b47593d54b7_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a430cd47f333c678d2cb77f4ab2693914" title="lbann::lbann_quantizer::lbann_quantizer" alt="" coords="388,5,639,35"/><area shape="rect" id="node5" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback_imcomm::on_backward_prop_end" alt="" coords="339,59,688,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="abdba3762c51a2820f70adba32169f57b"></a><!-- doxytag: member="lbann::lbann_quantizer::reset_time_counters" ref="abdba3762c51a2820f70adba32169f57b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::reset_time_counters </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Reset recorded time counters. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00265">265</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00265"></a>00265                              {
<a name="l00266"></a>00266     <a class="code" href="classlbann_1_1lbann__quantizer.html#aa25d9dbcc7af16370142f46a6c23d178">rs_time</a> = 0.0;
<a name="l00267"></a>00267     <a class="code" href="classlbann_1_1lbann__quantizer.html#a4d3c330826fbaff8ee38f4b05cafa84a">ag_time</a> = 0.0;
<a name="l00268"></a>00268     <a class="code" href="classlbann_1_1lbann__quantizer.html#a824b8b6d8964621e6a02aee94c38332a">rs_send_trans_time</a> = 0.0;
<a name="l00269"></a>00269     <a class="code" href="classlbann_1_1lbann__quantizer.html#a7fa4275835362b7d9ec91201f4f73436">rs_recv_buf_time</a> = 0.0;
<a name="l00270"></a>00270     <a class="code" href="classlbann_1_1lbann__quantizer.html#a81db6fb79472d86023dd470c2948ea5a">rs_recv_trans_time</a> = 0.0;
<a name="l00271"></a>00271     <a class="code" href="classlbann_1_1lbann__quantizer.html#a0e997657d1164ed23f912809492d8999">ag_reduced_trans_time</a> = 0.0;
<a name="l00272"></a>00272     <a class="code" href="classlbann_1_1lbann__quantizer.html#a0b7575ba8c4c3c2fcd7ea7e668c02178">ag_recv_buf_time</a> = 0.0;
<a name="l00273"></a>00273     <a class="code" href="classlbann_1_1lbann__quantizer.html#a9258429db2bb93e7f42e7b8573d83225">ag_recv_trans_time</a> = 0.0;
<a name="l00274"></a>00274     <a class="code" href="classlbann_1_1lbann__quantizer.html#a74cac02b60940fec951339e9197d8463">pta_time</a> = 0.0;
<a name="l00275"></a>00275     <a class="code" href="classlbann_1_1lbann__quantizer.html#a2a02ef2dbcdfdd262146fff6f34510ac">pta_pos_time</a> = 0.0;
<a name="l00276"></a>00276   }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_abdba3762c51a2820f70adba32169f57b_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_abdba3762c51a2820f70adba32169f57b_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_abdba3762c51a2820f70adba32169f57b_icgraph_map" id="classlbann_1_1lbann__quantizer_abdba3762c51a2820f70adba32169f57b_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a430cd47f333c678d2cb77f4ab2693914" title="lbann::lbann_quantizer::lbann_quantizer" alt="" coords="383,5,633,35"/><area shape="rect" id="node5" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback_imcomm::on_backward_prop_end" alt="" coords="333,59,683,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae9949af6bec1e95adf5a32ba9bb4afd8"></a><!-- doxytag: member="lbann::lbann_quantizer::threshold_quantize" ref="ae9949af6bec1e95adf5a32ba9bb4afd8" args="(const DistMat &amp;mat, ThreshQuantized &amp;q, Mat &amp;qerror, DataType pos_thresh, DataType neg_thresh, bool delta=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::threshold_quantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&nbsp;</td>
          <td class="paramname"> <em>pos_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&nbsp;</td>
          <td class="paramname"> <em>neg_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>delta</em> = <code>false</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00367">367</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00369"></a>00369                                    {
<a name="l00370"></a>00370   <a class="code" href="classlbann_1_1lbann__quantizer.html#a00106e69ea8a6dfe9e9a91c75b845bcd">threshold_quantize</a>(mat.LockedMatrix(), q, qerror, pos_thresh, neg_thresh,
<a name="l00371"></a>00371                      delta);
<a name="l00372"></a>00372 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_ae9949af6bec1e95adf5a32ba9bb4afd8_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_ae9949af6bec1e95adf5a32ba9bb4afd8_cgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_ae9949af6bec1e95adf5a32ba9bb4afd8_cgraph_map" id="classlbann_1_1lbann__quantizer_ae9949af6bec1e95adf5a32ba9bb4afd8_cgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a00106e69ea8a6dfe9e9a91c75b845bcd" title="lbann::lbann_quantizer::threshold_quantize" alt="" coords="323,5,592,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a00106e69ea8a6dfe9e9a91c75b845bcd"></a><!-- doxytag: member="lbann::lbann_quantizer::threshold_quantize" ref="a00106e69ea8a6dfe9e9a91c75b845bcd" args="(const Mat &amp;mat, ThreshQuantized &amp;q, Mat &amp;qerror, DataType pos_thresh, DataType neg_thresh, bool delta=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::threshold_quantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&nbsp;</td>
          <td class="paramname"> <em>pos_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&nbsp;</td>
          <td class="paramname"> <em>neg_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>delta</em> = <code>false</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Threshold and quantize a matrix. qerror needs to be initialized with: Zeros(qerror, mat.Height(), mat.Width())). </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>mat</em>&nbsp;</td><td>The matrix to quantize. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>q</em>&nbsp;</td><td>The output list of quantized entries. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>qerror</em>&nbsp;</td><td>Running quantization error. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pos_thresh</em>&nbsp;</td><td>The positive threshold level. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>neg_thresh</em>&nbsp;</td><td>The negative threshold level. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>delta</em>&nbsp;</td><td>Whether to do delta encoding (default false). </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00309">309</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00311"></a>00311                                                                           {
<a name="l00312"></a>00312   <span class="keyword">const</span> Int ldim = mat.LDim();
<a name="l00313"></a>00313   <span class="keyword">const</span> Int width = mat.Width();
<a name="l00314"></a>00314   <span class="keyword">const</span> Int height = mat.Height();
<a name="l00315"></a>00315   <span class="keywordflow">if</span> (ldim != qerror.LDim()) std::cout &lt;&lt; <span class="stringliteral">&quot;ldims don&apos;t match!&quot;</span> &lt;&lt; std::endl;
<a name="l00316"></a>00316   <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ mat_buf = mat.LockedBuffer();
<a name="l00317"></a>00317   <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ qerror_buf = qerror.Buffer();
<a name="l00318"></a>00318   std::vector&lt;ThreshQuantized&gt; thread_qs(omp_get_max_threads());
<a name="l00319"></a>00319   <span class="keywordflow">if</span> (delta) {
<a name="l00320"></a>00320     <span class="keywordtype">unsigned</span> prev_pos = 0;
<a name="l00321"></a>00321     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> col = 0; col &lt; width; ++col) {
<a name="l00322"></a>00322       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> row = 0; row &lt; height; ++row) {
<a name="l00323"></a>00323         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> pos = row + col * ldim;
<a name="l00324"></a>00324         <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> val = mat_buf[pos] + qerror_buf[pos];
<a name="l00325"></a>00325         <span class="keywordflow">if</span> (val &gt;= pos_thresh) {
<a name="l00326"></a>00326           qerror_buf[pos] = val - pos_thresh;
<a name="l00327"></a>00327           <span class="comment">// Delta encode pos.</span>
<a name="l00328"></a>00328           quant.emplace_back(((pos - prev_pos) &lt;&lt; 1) | 1);
<a name="l00329"></a>00329           prev_pos = pos;
<a name="l00330"></a>00330         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val &lt;= neg_thresh) {
<a name="l00331"></a>00331           qerror_buf[pos] = val - neg_thresh;
<a name="l00332"></a>00332           quant.emplace_back((pos - prev_pos) &lt;&lt; 1);
<a name="l00333"></a>00333           prev_pos = pos;
<a name="l00334"></a>00334         } <span class="keywordflow">else</span> {
<a name="l00335"></a>00335           qerror_buf[pos] = val;
<a name="l00336"></a>00336         }
<a name="l00337"></a>00337       }
<a name="l00338"></a>00338     }
<a name="l00339"></a>00339   } <span class="keywordflow">else</span> {
<a name="l00340"></a>00340 <span class="preprocessor">    #pragma omp parallel</span>
<a name="l00341"></a>00341 <span class="preprocessor"></span>    {
<a name="l00342"></a>00342       <span class="keyword">const</span> <span class="keywordtype">int</span> tid = omp_get_thread_num();
<a name="l00343"></a>00343 <span class="preprocessor">      #pragma omp for schedule(static)</span>
<a name="l00344"></a>00344 <span class="preprocessor"></span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> col = 0; col &lt; width; ++col) {
<a name="l00345"></a>00345         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> row = 0; row &lt; height; ++row) {
<a name="l00346"></a>00346           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> pos = row + col * ldim;
<a name="l00347"></a>00347           <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> val = mat_buf[pos] + qerror_buf[pos];
<a name="l00348"></a>00348           <span class="keywordflow">if</span> (val &gt;= pos_thresh) {
<a name="l00349"></a>00349             qerror_buf[pos] = val - pos_thresh;
<a name="l00350"></a>00350             thread_qs[tid].emplace_back((pos &lt;&lt; 1) | 1);
<a name="l00351"></a>00351           } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val &lt;= neg_thresh) {
<a name="l00352"></a>00352             qerror_buf[pos] = val - neg_thresh;
<a name="l00353"></a>00353             thread_qs[tid].emplace_back(pos &lt;&lt; 1);
<a name="l00354"></a>00354           } <span class="keywordflow">else</span> {
<a name="l00355"></a>00355             qerror_buf[pos] = val;
<a name="l00356"></a>00356           }
<a name="l00357"></a>00357         }
<a name="l00358"></a>00358       }
<a name="l00359"></a>00359     }
<a name="l00360"></a>00360     <span class="comment">// Copy the temporary vectors.</span>
<a name="l00361"></a>00361     <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp;&amp; thread_q : thread_qs) {
<a name="l00362"></a>00362       quant.insert(quant.end(), thread_q.begin(), thread_q.end());
<a name="l00363"></a>00363     }
<a name="l00364"></a>00364   }
<a name="l00365"></a>00365 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a00106e69ea8a6dfe9e9a91c75b845bcd_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a00106e69ea8a6dfe9e9a91c75b845bcd_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a00106e69ea8a6dfe9e9a91c75b845bcd_icgraph_map" id="classlbann_1_1lbann__quantizer_a00106e69ea8a6dfe9e9a91c75b845bcd_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a4cf9d4cd5262b21939e95fc34ad0a09f" title="lbann::lbann_quantizer::intermodel_sum_threshold_quantized" alt="" coords="324,32,697,61"/><area shape="rect" id="node9" href="classlbann_1_1lbann__quantizer.html#ae9949af6bec1e95adf5a32ba9bb4afd8" title="lbann::lbann_quantizer::threshold_quantize" alt="" coords="376,85,645,115"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#ae99dc11003cecd04e599d68c99d90c0b" title="lbann::lbann_quantizer::intermodel_sum_threshold_quantized" alt="" coords="748,5,1121,35"/><area shape="rect" id="node7" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback_imcomm::on_backward_prop_end" alt="" coords="760,59,1109,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a8871704ae757f1bd83f3948d61b1cdad"></a><!-- doxytag: member="lbann::lbann_quantizer::threshold_quantize_apply" ref="a8871704ae757f1bd83f3948d61b1cdad" args="(const Mat &amp;mat, ThreshQuantized &amp;q, Mat &amp;qerror, DataType pos_thresh, DataType neg_thresh, std::vector&lt; unsigned &gt; &amp;positions, bool delta=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::threshold_quantize_apply </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&nbsp;</td>
          <td class="paramname"> <em>pos_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&nbsp;</td>
          <td class="paramname"> <em>neg_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; unsigned &gt; &amp;&nbsp;</td>
          <td class="paramname"> <em>positions</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>delta</em> = <code>false</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Quantize only the locations in mat in positions; the companion of threshold_unquantize_apply. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00438">438</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00440"></a>00440                                                                    {
<a name="l00441"></a>00441   <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ mat_buf = mat.LockedBuffer();
<a name="l00442"></a>00442   <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ qerror_buf = qerror.Buffer();
<a name="l00443"></a>00443   <span class="keywordflow">if</span> (delta) {
<a name="l00444"></a>00444     <span class="comment">// Need to sort so positions are in order, otherwise our delta encoding</span>
<a name="l00445"></a>00445     <span class="comment">// doesn&apos;t work. (Could be solved by adding stops, but maybe not worth it.)</span>
<a name="l00446"></a>00446     std::sort(positions.begin(), positions.end());
<a name="l00447"></a>00447     <span class="keywordtype">unsigned</span> prev_pos = 0;
<a name="l00448"></a>00448     <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pos : positions) {
<a name="l00449"></a>00449       <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> val = mat_buf[pos] + qerror_buf[pos];
<a name="l00450"></a>00450       <span class="keywordflow">if</span> (val &gt;= pos_thresh) {
<a name="l00451"></a>00451         qerror_buf[pos] = val - pos_thresh;
<a name="l00452"></a>00452         quant.emplace_back(((pos - prev_pos) &lt;&lt; 1) | 1);
<a name="l00453"></a>00453         prev_pos = pos;
<a name="l00454"></a>00454       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val &lt;= neg_thresh) {
<a name="l00455"></a>00455         qerror_buf[pos] = val - neg_thresh;
<a name="l00456"></a>00456         quant.emplace_back((pos - prev_pos) &lt;&lt; 1);
<a name="l00457"></a>00457         prev_pos = pos;
<a name="l00458"></a>00458       } <span class="keywordflow">else</span> {
<a name="l00459"></a>00459         qerror_buf[pos] = val;
<a name="l00460"></a>00460       }
<a name="l00461"></a>00461     }
<a name="l00462"></a>00462   } <span class="keywordflow">else</span> {
<a name="l00463"></a>00463     <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pos : positions) {
<a name="l00464"></a>00464       <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> val = mat_buf[pos] + qerror_buf[pos];
<a name="l00465"></a>00465       <span class="keywordflow">if</span> (val &gt;= pos_thresh) {
<a name="l00466"></a>00466         quant.emplace_back((pos &lt;&lt; 1) | 1);
<a name="l00467"></a>00467         qerror_buf[pos] = val - pos_thresh;
<a name="l00468"></a>00468       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val &lt;= neg_thresh) {
<a name="l00469"></a>00469         quant.emplace_back(pos &lt;&lt; 1);
<a name="l00470"></a>00470         qerror_buf[pos] = val - neg_thresh;
<a name="l00471"></a>00471       } <span class="keywordflow">else</span> {
<a name="l00472"></a>00472         qerror_buf[pos] = val;
<a name="l00473"></a>00473       }
<a name="l00474"></a>00474     }
<a name="l00475"></a>00475   }
<a name="l00476"></a>00476 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a8871704ae757f1bd83f3948d61b1cdad_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a8871704ae757f1bd83f3948d61b1cdad_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a8871704ae757f1bd83f3948d61b1cdad_icgraph_map" id="classlbann_1_1lbann__quantizer_a8871704ae757f1bd83f3948d61b1cdad_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a4cf9d4cd5262b21939e95fc34ad0a09f" title="lbann::lbann_quantizer::intermodel_sum_threshold_quantized" alt="" coords="361,32,735,61"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#ae99dc11003cecd04e599d68c99d90c0b" title="lbann::lbann_quantizer::intermodel_sum_threshold_quantized" alt="" coords="785,5,1159,35"/><area shape="rect" id="node7" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback_imcomm::on_backward_prop_end" alt="" coords="797,59,1147,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2324bba3cbb6c0d3e51bbe21555e7f1a"></a><!-- doxytag: member="lbann::lbann_quantizer::threshold_unquantize" ref="a2324bba3cbb6c0d3e51bbe21555e7f1a" args="(const ThreshQuantized &amp;q, DistMat &amp;mat, DataType pos_thresh, DataType neg_thresh, bool delta=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::threshold_unquantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&nbsp;</td>
          <td class="paramname"> <em>pos_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&nbsp;</td>
          <td class="paramname"> <em>neg_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>delta</em> = <code>false</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00398">398</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00400"></a>00400                                    {
<a name="l00401"></a>00401   <a class="code" href="classlbann_1_1lbann__quantizer.html#a0f5f3b0149715ab59202b8884a87c7d5">threshold_unquantize</a>(quant, mat.Matrix(), pos_thresh, neg_thresh, delta);
<a name="l00402"></a>00402 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a2324bba3cbb6c0d3e51bbe21555e7f1a_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a2324bba3cbb6c0d3e51bbe21555e7f1a_cgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a2324bba3cbb6c0d3e51bbe21555e7f1a_cgraph_map" id="classlbann_1_1lbann__quantizer_a2324bba3cbb6c0d3e51bbe21555e7f1a_cgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a0f5f3b0149715ab59202b8884a87c7d5" title="lbann::lbann_quantizer::threshold_unquantize" alt="" coords="336,5,619,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0f5f3b0149715ab59202b8884a87c7d5"></a><!-- doxytag: member="lbann::lbann_quantizer::threshold_unquantize" ref="a0f5f3b0149715ab59202b8884a87c7d5" args="(const ThreshQuantized &amp;q, Mat &amp;mat, DataType pos_thresh, DataType neg_thresh, bool delta=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::threshold_unquantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&nbsp;</td>
          <td class="paramname"> <em>pos_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&nbsp;</td>
          <td class="paramname"> <em>neg_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>delta</em> = <code>false</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Unquantize a thresholded-and-quantized matrix. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>q</em>&nbsp;</td><td>The quantized matrix. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mat</em>&nbsp;</td><td>The output unquantized matrix. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pos_thresh</em>&nbsp;</td><td>The positive threshold value. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>neg_thresh</em>&nbsp;</td><td>The negative negative value. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>delta</em>&nbsp;</td><td>Whether q was quantized with delta encoding (default false). </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00374">374</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00376"></a>00376                                    {
<a name="l00377"></a>00377   <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ buf = mat.Buffer();
<a name="l00378"></a>00378   <span class="keywordflow">if</span> (delta) {
<a name="l00379"></a>00379     <span class="keywordtype">unsigned</span> prev_pos = 0;
<a name="l00380"></a>00380     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; quant.size(); ++i) {
<a name="l00381"></a>00381       <span class="keyword">const</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> q = quant[i];
<a name="l00382"></a>00382       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> pos = (q &gt;&gt; 1) + prev_pos;
<a name="l00383"></a>00383       prev_pos = pos;
<a name="l00384"></a>00384       <span class="keywordflow">if</span> (q &amp; 1) buf[pos] = pos_thresh;
<a name="l00385"></a>00385       <span class="keywordflow">else</span> buf[pos] = neg_thresh;
<a name="l00386"></a>00386     }
<a name="l00387"></a>00387   } <span class="keywordflow">else</span> {
<a name="l00388"></a>00388 <span class="preprocessor">    #pragma omp parallel for schedule(static)</span>
<a name="l00389"></a>00389 <span class="preprocessor"></span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; quant.size(); ++i) {
<a name="l00390"></a>00390       <span class="keyword">const</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> q = quant[i];
<a name="l00391"></a>00391       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> pos = q &gt;&gt; 1;
<a name="l00392"></a>00392       <span class="keywordflow">if</span> (q &amp; 1) buf[pos] = pos_thresh;
<a name="l00393"></a>00393       <span class="keywordflow">else</span> buf[pos] = neg_thresh;
<a name="l00394"></a>00394     }
<a name="l00395"></a>00395   }
<a name="l00396"></a>00396 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a0f5f3b0149715ab59202b8884a87c7d5_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a0f5f3b0149715ab59202b8884a87c7d5_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a0f5f3b0149715ab59202b8884a87c7d5_icgraph_map" id="classlbann_1_1lbann__quantizer_a0f5f3b0149715ab59202b8884a87c7d5_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a4cf9d4cd5262b21939e95fc34ad0a09f" title="lbann::lbann_quantizer::intermodel_sum_threshold_quantized" alt="" coords="337,32,711,61"/><area shape="rect" id="node9" href="classlbann_1_1lbann__quantizer.html#a2324bba3cbb6c0d3e51bbe21555e7f1a" title="lbann::lbann_quantizer::threshold_unquantize" alt="" coords="383,85,665,115"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#ae99dc11003cecd04e599d68c99d90c0b" title="lbann::lbann_quantizer::intermodel_sum_threshold_quantized" alt="" coords="761,5,1135,35"/><area shape="rect" id="node7" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback_imcomm::on_backward_prop_end" alt="" coords="773,59,1123,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a94d55b41dd60582f4412d5e24a0eeffe"></a><!-- doxytag: member="lbann::lbann_quantizer::threshold_unquantize_apply" ref="a94d55b41dd60582f4412d5e24a0eeffe" args="(const ThreshQuantized &amp;q, Mat &amp;mat, DataType pos_thresh, DataType neg_thresh, std::vector&lt; unsigned &gt; &amp;positions, bool delta=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::threshold_unquantize_apply </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&nbsp;</td>
          <td class="paramname"> <em>pos_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&nbsp;</td>
          <td class="paramname"> <em>neg_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; unsigned &gt; &amp;&nbsp;</td>
          <td class="paramname"> <em>positions</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>delta</em> = <code>false</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Do threshold unquantization from arbitrary locations, adding the unquantized values to existing ones instead of replacing them, and storing the locations applied. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00404">404</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00406"></a>00406                                                                    {
<a name="l00407"></a>00407   <span class="comment">// A general note on positions that I&apos;m putting here because I&apos;m not sure</span>
<a name="l00408"></a>00408   <span class="comment">// where else to: Using a vector admits the possibility that we have</span>
<a name="l00409"></a>00409   <span class="comment">// duplicate entries. This could be fixed by using an unordered_set, but when</span>
<a name="l00410"></a>00410   <span class="comment">// I benchmarked this, it increased our runtime by ~5 times. Having duplicate</span>
<a name="l00411"></a>00411   <span class="comment">// entries should not change the final result: it means that</span>
<a name="l00412"></a>00412   <span class="comment">// threshold_quantize_apply may quantize the same entry multiple times, but</span>
<a name="l00413"></a>00413   <span class="comment">// the final unquantize is not an _apply, and so will just set that entry to</span>
<a name="l00414"></a>00414   <span class="comment">// the same value multiple times. We send some extra data, but the overhead</span>
<a name="l00415"></a>00415   <span class="comment">// is small.</span>
<a name="l00416"></a>00416   <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ buf = mat.Buffer();
<a name="l00417"></a>00417   <span class="keywordflow">if</span> (delta) {
<a name="l00418"></a>00418     <span class="keywordtype">unsigned</span> prev_pos = 0;
<a name="l00419"></a>00419     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; quant.size(); ++i) {
<a name="l00420"></a>00420       <span class="keyword">const</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> q = quant[i];
<a name="l00421"></a>00421       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> pos = (q &gt;&gt; 1) + prev_pos;
<a name="l00422"></a>00422       prev_pos = pos;
<a name="l00423"></a>00423       positions.emplace_back(pos);
<a name="l00424"></a>00424       <span class="keywordflow">if</span> (q &amp; 1) buf[pos] += pos_thresh;
<a name="l00425"></a>00425       <span class="keywordflow">else</span> buf[pos] += neg_thresh;
<a name="l00426"></a>00426     }
<a name="l00427"></a>00427   } <span class="keywordflow">else</span> {
<a name="l00428"></a>00428     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; quant.size(); ++i) {
<a name="l00429"></a>00429       <span class="keyword">const</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> q = quant[i];
<a name="l00430"></a>00430       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> pos = q &gt;&gt; 1;
<a name="l00431"></a>00431       positions.emplace_back(pos);
<a name="l00432"></a>00432       <span class="keywordflow">if</span> (q &amp; 1) buf[pos] += pos_thresh;
<a name="l00433"></a>00433       <span class="keywordflow">else</span> buf[pos] += neg_thresh;
<a name="l00434"></a>00434     }
<a name="l00435"></a>00435   }
<a name="l00436"></a>00436 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a94d55b41dd60582f4412d5e24a0eeffe_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a94d55b41dd60582f4412d5e24a0eeffe_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a94d55b41dd60582f4412d5e24a0eeffe_icgraph_map" id="classlbann_1_1lbann__quantizer_a94d55b41dd60582f4412d5e24a0eeffe_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a4cf9d4cd5262b21939e95fc34ad0a09f" title="lbann::lbann_quantizer::intermodel_sum_threshold_quantized" alt="" coords="377,32,751,61"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#ae99dc11003cecd04e599d68c99d90c0b" title="lbann::lbann_quantizer::intermodel_sum_threshold_quantized" alt="" coords="801,5,1175,35"/><area shape="rect" id="node7" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback_imcomm::on_backward_prop_end" alt="" coords="813,59,1163,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a02e4bdf26d23de079d763300e71488f1"></a><!-- doxytag: member="lbann::lbann_quantizer::uncompress_adaptive_thresholds" ref="a02e4bdf26d23de079d763300e71488f1" args="(const ThreshQuantized &amp;cq, ThreshQuantized &amp;q)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::uncompress_adaptive_thresholds </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>cq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>q</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l01042">1042</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01043"></a>01043                                                                          {
<a name="l01044"></a>01044   q.push_back(cq[0]);
<a name="l01045"></a>01045   q.push_back(cq[1]);
<a name="l01046"></a>01046   <a class="code" href="classlbann_1_1lbann__quantizer.html#afb58d63b174c3a937f3c3b21eb269b77">uncompress_thresholds</a>(cq, std::next(cq.begin(), 2), q);
<a name="l01047"></a>01047 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a02e4bdf26d23de079d763300e71488f1_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a02e4bdf26d23de079d763300e71488f1_cgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a02e4bdf26d23de079d763300e71488f1_cgraph_map" id="classlbann_1_1lbann__quantizer_a02e4bdf26d23de079d763300e71488f1_cgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#afb58d63b174c3a937f3c3b21eb269b77" title="lbann::lbann_quantizer::uncompress_thresholds" alt="" coords="408,5,707,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a02e4bdf26d23de079d763300e71488f1_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a02e4bdf26d23de079d763300e71488f1_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a02e4bdf26d23de079d763300e71488f1_icgraph_map" id="classlbann_1_1lbann__quantizer_a02e4bdf26d23de079d763300e71488f1_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a28e74da8473ea1b475ff3976676898c4" title="lbann::lbann_quantizer::intermodel_sum_adaptive_threshold_quantized" alt="" coords="409,32,839,61"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#acf0864e7c687806af3155655a33ed364" title="lbann::lbann_quantizer::intermodel_sum_adaptive_threshold_quantized" alt="" coords="889,5,1319,35"/><area shape="rect" id="node7" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback_imcomm::on_backward_prop_end" alt="" coords="929,59,1279,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a37d6f4d5b8d990d8ceaedfaec1f58152"></a><!-- doxytag: member="lbann::lbann_quantizer::uncompress_thresholds" ref="a37d6f4d5b8d990d8ceaedfaec1f58152" args="(const ThreshQuantized &amp;cq, ThreshQuantized::const_iterator cqstart, ThreshQuantized &amp;q)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::uncompress_thresholds </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>cq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ThreshQuantized::const_iterator&nbsp;</td>
          <td class="paramname"> <em>cqstart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>q</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Handle uncompression starting from arbitrary locations. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00984">984</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00986"></a>00986                       {
<a name="l00987"></a>00987   <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> quotient = 0;
<a name="l00988"></a>00988   <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> remainder = 0;
<a name="l00989"></a>00989   <span class="comment">// Like in compress, cur_bit is the current bit being read.</span>
<a name="l00990"></a>00990   <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> cur_bit = 0;
<a name="l00991"></a>00991   <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = std::distance(cq.begin(), cqstart); i &lt; cq.size();) {
<a name="l00992"></a>00992     <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> cur = cq[i];
<a name="l00993"></a>00993     <span class="comment">// Decode the quotient by continuing until we find a 0.</span>
<a name="l00994"></a>00994     <span class="comment">// If we hit the end without finding a 0, this was the end of the list.</span>
<a name="l00995"></a>00995     <span class="keywordflow">while</span> ((cur &gt;&gt; cur_bit) &amp; 0x1) {
<a name="l00996"></a>00996       ++quotient;
<a name="l00997"></a>00997       ++cur_bit;
<a name="l00998"></a>00998       <span class="keywordflow">if</span> (cur_bit == <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>) {
<a name="l00999"></a>00999         <span class="comment">// Hit end of current chunk.</span>
<a name="l01000"></a>01000         ++i;
<a name="l01001"></a>01001         <span class="keywordflow">if</span> (i == cq.size()) {
<a name="l01002"></a>01002           <span class="keywordflow">return</span>;  <span class="comment">// Nothing left.</span>
<a name="l01003"></a>01003         }
<a name="l01004"></a>01004         cur = cq[i];
<a name="l01005"></a>01005         cur_bit = 0;
<a name="l01006"></a>01006       }
<a name="l01007"></a>01007     }
<a name="l01008"></a>01008     <span class="comment">// Skip past the 0.</span>
<a name="l01009"></a>01009     ++cur_bit;
<a name="l01010"></a>01010     <span class="keywordflow">if</span> (cur_bit == <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>) {
<a name="l01011"></a>01011       ++i;
<a name="l01012"></a>01012       cur = cq[i];
<a name="l01013"></a>01013       cur_bit = 0;
<a name="l01014"></a>01014     }
<a name="l01015"></a>01015     <span class="comment">// Decode the remainder (GR_K bits).</span>
<a name="l01016"></a>01016     <span class="keywordflow">if</span> (cur_bit + <a class="code" href="classlbann_1_1lbann__quantizer.html#a5f645c840854c584c9224af063fee23b">GR_K</a> &lt;= <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>) {
<a name="l01017"></a>01017       <span class="comment">// Remainder is entirely in the current chunk.</span>
<a name="l01018"></a>01018       remainder = (cur &gt;&gt; cur_bit) &amp; (<a class="code" href="classlbann_1_1lbann__quantizer.html#ad98118c77f676fa3d3fb4ba27b814070">GR_M</a> - 1);
<a name="l01019"></a>01019       cur_bit += <a class="code" href="classlbann_1_1lbann__quantizer.html#a5f645c840854c584c9224af063fee23b">GR_K</a>;
<a name="l01020"></a>01020       <span class="keywordflow">if</span> (cur_bit == <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>) {
<a name="l01021"></a>01021         ++i;
<a name="l01022"></a>01022         cur_bit = 0;
<a name="l01023"></a>01023       }
<a name="l01024"></a>01024     } <span class="keywordflow">else</span> {
<a name="l01025"></a>01025       <span class="comment">// Remainder is split over this and the next chunk.</span>
<a name="l01026"></a>01026       <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> bits_left = <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a> - cur_bit;
<a name="l01027"></a>01027       <span class="comment">// Start with the top bits_left bits.</span>
<a name="l01028"></a>01028       remainder = cur &gt;&gt; cur_bit;
<a name="l01029"></a>01029       ++i;
<a name="l01030"></a>01030       cur = cq[i];
<a name="l01031"></a>01031       <span class="comment">// Now get remaining GR_K - bits_left bits from the new cur.</span>
<a name="l01032"></a>01032       remainder |= (cur &amp; ((1 &lt;&lt; (<a class="code" href="classlbann_1_1lbann__quantizer.html#a5f645c840854c584c9224af063fee23b">GR_K</a> - bits_left)) - 1)) &lt;&lt; bits_left;
<a name="l01033"></a>01033       cur_bit = <a class="code" href="classlbann_1_1lbann__quantizer.html#a5f645c840854c584c9224af063fee23b">GR_K</a> - bits_left;
<a name="l01034"></a>01034     }
<a name="l01035"></a>01035     <span class="comment">// Now decode the final value.</span>
<a name="l01036"></a>01036     q.push_back(quotient * <a class="code" href="classlbann_1_1lbann__quantizer.html#ad98118c77f676fa3d3fb4ba27b814070">GR_M</a> + remainder);
<a name="l01037"></a>01037     quotient = 0;
<a name="l01038"></a>01038     remainder = 0;
<a name="l01039"></a>01039   }
<a name="l01040"></a>01040 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afb58d63b174c3a937f3c3b21eb269b77"></a><!-- doxytag: member="lbann::lbann_quantizer::uncompress_thresholds" ref="afb58d63b174c3a937f3c3b21eb269b77" args="(const ThreshQuantized &amp;cq, ThreshQuantized &amp;q)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::uncompress_thresholds </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>cq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>q</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Corresponding uncompress. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00979">979</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00980"></a>00980                                                                 {
<a name="l00981"></a>00981   <a class="code" href="classlbann_1_1lbann__quantizer.html#afb58d63b174c3a937f3c3b21eb269b77">uncompress_thresholds</a>(cq, cq.begin(), q);
<a name="l00982"></a>00982 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_afb58d63b174c3a937f3c3b21eb269b77_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_afb58d63b174c3a937f3c3b21eb269b77_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_afb58d63b174c3a937f3c3b21eb269b77_icgraph_map" id="classlbann_1_1lbann__quantizer_afb58d63b174c3a937f3c3b21eb269b77_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a4cf9d4cd5262b21939e95fc34ad0a09f" title="lbann::lbann_quantizer::intermodel_sum_threshold_quantized" alt="" coords="353,57,727,87"/><area shape="rect" id="node9" href="classlbann_1_1lbann__quantizer.html#a02e4bdf26d23de079d763300e71488f1" title="lbann::lbann_quantizer::uncompress_adaptive_thresholds" alt="" coords="363,111,717,140"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#ae99dc11003cecd04e599d68c99d90c0b" title="lbann::lbann_quantizer::intermodel_sum_threshold_quantized" alt="" coords="805,5,1179,35"/><area shape="rect" id="node7" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback_imcomm::on_backward_prop_end" alt="" coords="1297,57,1647,87"/><area shape="rect" id="node11" href="classlbann_1_1lbann__quantizer.html#a28e74da8473ea1b475ff3976676898c4" title="lbann::lbann_quantizer::intermodel_sum_adaptive_threshold_quantized" alt="" coords="777,111,1207,140"/><area shape="rect" id="node13" href="classlbann_1_1lbann__quantizer.html#acf0864e7c687806af3155655a33ed364" title="lbann::lbann_quantizer::intermodel_sum_adaptive_threshold_quantized" alt="" coords="1257,111,1687,140"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a20ab13e61298782c5c3280f81d66da69"></a><!-- doxytag: member="lbann::lbann_quantizer::unquantize" ref="a20ab13e61298782c5c3280f81d66da69" args="(const QuantizedMatrix &amp;qmat, DistMat &amp;mat, bool apply=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::unquantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>qmat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>apply</em> = <code>false</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00177">177</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00178"></a>00178                                              {
<a name="l00179"></a>00179   <a class="code" href="classlbann_1_1lbann__quantizer.html#a8eb42b16ff79799e3e81733b7921a789">unquantize</a>(qmat, mat.Matrix(), apply);
<a name="l00180"></a>00180 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a20ab13e61298782c5c3280f81d66da69_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a20ab13e61298782c5c3280f81d66da69_cgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a20ab13e61298782c5c3280f81d66da69_cgraph_map" id="classlbann_1_1lbann__quantizer_a20ab13e61298782c5c3280f81d66da69_cgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a8eb42b16ff79799e3e81733b7921a789" title="lbann::lbann_quantizer::unquantize" alt="" coords="279,5,500,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a8eb42b16ff79799e3e81733b7921a789"></a><!-- doxytag: member="lbann::lbann_quantizer::unquantize" ref="a8eb42b16ff79799e3e81733b7921a789" args="(const QuantizedMatrix &amp;qmat, Mat &amp;mat, bool apply=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::unquantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>qmat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>apply</em> = <code>false</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Unquantize a matrix. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>qmat</em>&nbsp;</td><td>The matrix to unquantize. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mat</em>&nbsp;</td><td>The output unquantized matrix. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>apply</em>&nbsp;</td><td>Whether to add or replace existing entries. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00141">141</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00141"></a>00141                                                                                   {
<a name="l00142"></a>00142   <span class="keyword">const</span> Int width = mat.Width();
<a name="l00143"></a>00143   <span class="keyword">const</span> Int height = mat.Height();
<a name="l00144"></a>00144   <span class="keyword">const</span> Int ldim = mat.LDim();
<a name="l00145"></a>00145   <span class="keyword">const</span> Int qmat_ldim = qmat.LDim();
<a name="l00146"></a>00146   <span class="keyword">const</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#aad6499ee349e94a461538a8e4f867048">qtype</a>* __restrict__ qmat_buf = qmat.LockedBuffer();
<a name="l00147"></a>00147   <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ mat_buf = mat.Buffer();
<a name="l00148"></a>00148 <span class="preprocessor">  #pragma omp parallel for schedule(static)</span>
<a name="l00149"></a>00149 <span class="preprocessor"></span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> col = 0; col &lt; width; ++col) {
<a name="l00150"></a>00150     <span class="keywordtype">int</span> qrow = 2;
<a name="l00151"></a>00151     <span class="comment">// Extract the averages.</span>
<a name="l00152"></a>00152     <a class="code" href="classlbann_1_1lbann__quantizer.html#aad6499ee349e94a461538a8e4f867048">qtype</a> tmp = qmat.Get(0, col);
<a name="l00153"></a>00153     <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> avg_pos;
<a name="l00154"></a>00154     memcpy(&amp;avg_pos, &amp;tmp, <span class="keyword">sizeof</span>(avg_pos));
<a name="l00155"></a>00155     tmp = qmat.Get(1, col);
<a name="l00156"></a>00156     <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> avg_neg;
<a name="l00157"></a>00157     memcpy(&amp;avg_neg, &amp;tmp, <span class="keyword">sizeof</span>(avg_neg));
<a name="l00158"></a>00158     <span class="comment">// Unquantize this column.</span>
<a name="l00159"></a>00159     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> row_chunk = 0; row_chunk &lt; height; row_chunk += <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>) {
<a name="l00160"></a>00160       <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> q = (<a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a>) qmat_buf[qrow + col * qmat_ldim];
<a name="l00161"></a>00161       <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> bit = 0; bit &lt; <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>; ++bit) {
<a name="l00162"></a>00162         <span class="keywordtype">int</span> row = row_chunk + bit;
<a name="l00163"></a>00163         <span class="keywordflow">if</span> (row &gt;= height) {
<a name="l00164"></a>00164           <span class="keywordflow">break</span>;
<a name="l00165"></a>00165         }
<a name="l00166"></a>00166         <span class="keywordflow">if</span> (apply) {
<a name="l00167"></a>00167           mat_buf[row + col * ldim] += (q &gt;&gt; bit) &amp; 0x1 ? avg_pos : avg_neg;
<a name="l00168"></a>00168         } <span class="keywordflow">else</span> {
<a name="l00169"></a>00169           mat_buf[row + col * ldim] = (q &gt;&gt; bit) &amp; 0x1 ? avg_pos : avg_neg;
<a name="l00170"></a>00170         }
<a name="l00171"></a>00171       }
<a name="l00172"></a>00172       ++qrow;
<a name="l00173"></a>00173     }
<a name="l00174"></a>00174   }
<a name="l00175"></a>00175 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a8eb42b16ff79799e3e81733b7921a789_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a8eb42b16ff79799e3e81733b7921a789_icgraph_map" alt=""></div>
<map name="classlbann_1_1lbann__quantizer_a8eb42b16ff79799e3e81733b7921a789_icgraph_map" id="classlbann_1_1lbann__quantizer_a8eb42b16ff79799e3e81733b7921a789_icgraph">
<area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a97db186341c0819c8d52e2f815deb2a7" title="lbann::lbann_quantizer::intermodel_sum_quantized" alt="" coords="281,59,596,88"/><area shape="rect" id="node9" href="classlbann_1_1lbann__quantizer.html#a0e271e3f75667540f5bde94fbcd3ef0e" title="lbann::lbann_quantizer::intermodel_sum_quantized2" alt="" coords="277,112,600,141"/><area shape="rect" id="node13" href="classlbann_1_1lbann__quantizer.html#a20ab13e61298782c5c3280f81d66da69" title="lbann::lbann_quantizer::unquantize" alt="" coords="328,165,549,195"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#a4877befb2683f16a03fdf91ed1353636" title="lbann::lbann_quantizer::intermodel_sum_quantized" alt="" coords="665,5,980,35"/><area shape="rect" id="node7" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback_imcomm::on_backward_prop_end" alt="" coords="648,59,997,88"/><area shape="rect" id="node11" href="classlbann_1_1lbann__quantizer.html#a35ca3e61f358ccb63c233d85236dfec1" title="lbann::lbann_quantizer::intermodel_sum_quantized2" alt="" coords="661,112,984,141"/></map>
</div>
</p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="ae29843bccd4f211f36f4dd357a066a5d"></a><!-- doxytag: member="lbann::lbann_quantizer::ag_bytes_received" ref="ae29843bccd4f211f36f4dd357a066a5d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t <a class="el" href="classlbann_1_1lbann__quantizer.html#ae29843bccd4f211f36f4dd357a066a5d">lbann::lbann_quantizer::ag_bytes_received</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Bytes received in doing the all-gather. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00300">300</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a3a9e25785189c84ba5a7fe055382ca92"></a><!-- doxytag: member="lbann::lbann_quantizer::ag_bytes_sent" ref="a3a9e25785189c84ba5a7fe055382ca92" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t <a class="el" href="classlbann_1_1lbann__quantizer.html#a3a9e25785189c84ba5a7fe055382ca92">lbann::lbann_quantizer::ag_bytes_sent</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Bytes sent in doing the all-gather. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00296">296</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a0b7575ba8c4c3c2fcd7ea7e668c02178"></a><!-- doxytag: member="lbann::lbann_quantizer::ag_recv_buf_time" ref="a0b7575ba8c4c3c2fcd7ea7e668c02178" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classlbann_1_1lbann__quantizer.html#a0b7575ba8c4c3c2fcd7ea7e668c02178">lbann::lbann_quantizer::ag_recv_buf_time</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Time spent in the allgather get_recv_buf. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00314">314</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a9258429db2bb93e7f42e7b8573d83225"></a><!-- doxytag: member="lbann::lbann_quantizer::ag_recv_trans_time" ref="a9258429db2bb93e7f42e7b8573d83225" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classlbann_1_1lbann__quantizer.html#a9258429db2bb93e7f42e7b8573d83225">lbann::lbann_quantizer::ag_recv_trans_time</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Time spent in the all-gather recv_trans. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00316">316</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a0e997657d1164ed23f912809492d8999"></a><!-- doxytag: member="lbann::lbann_quantizer::ag_reduced_trans_time" ref="a0e997657d1164ed23f912809492d8999" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classlbann_1_1lbann__quantizer.html#a0e997657d1164ed23f912809492d8999">lbann::lbann_quantizer::ag_reduced_trans_time</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Time spent in the allgather reduced_trans. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00312">312</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a4d3c330826fbaff8ee38f4b05cafa84a"></a><!-- doxytag: member="lbann::lbann_quantizer::ag_time" ref="a4d3c330826fbaff8ee38f4b05cafa84a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classlbann_1_1lbann__quantizer.html#a4d3c330826fbaff8ee38f4b05cafa84a">lbann::lbann_quantizer::ag_time</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Time spent in the all-gather. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00304">304</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a5f645c840854c584c9224af063fee23b"></a><!-- doxytag: member="lbann::lbann_quantizer::GR_K" ref="a5f645c840854c584c9224af063fee23b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> <a class="el" href="classlbann_1_1lbann__quantizer.html#a5f645c840854c584c9224af063fee23b">lbann::lbann_quantizer::GR_K</a> = 4<code> [static, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>log_2(GR_M). </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00287">287</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="ad98118c77f676fa3d3fb4ba27b814070"></a><!-- doxytag: member="lbann::lbann_quantizer::GR_M" ref="ad98118c77f676fa3d3fb4ba27b814070" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> <a class="el" href="classlbann_1_1lbann__quantizer.html#ad98118c77f676fa3d3fb4ba27b814070">lbann::lbann_quantizer::GR_M</a> = 16<code> [static, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Golumb-Rice M parameter, a power of 2. Should be large-ish relative to the data being encoded, but log_2(GR_M) should be &lt;= 31. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00285">285</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a33ea17392f53b90e91aea1ffb7e11d68"></a><!-- doxytag: member="lbann::lbann_quantizer::NUM_BITS" ref="a33ea17392f53b90e91aea1ffb7e11d68" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const size_t <a class="el" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">lbann::lbann_quantizer::NUM_BITS</a> = sizeof(<a class="el" href="classlbann_1_1lbann__quantizer.html#aad6499ee349e94a461538a8e4f867048">qtype</a>) * 8<code> [static, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Number of bits per quantized word. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00280">280</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a804753c85f84fde1adc2cb7275a1158c"></a><!-- doxytag: member="lbann::lbann_quantizer::NUM_ONEBIT_SAMPLES" ref="a804753c85f84fde1adc2cb7275a1158c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const int <a class="el" href="classlbann_1_1lbann__quantizer.html#a804753c85f84fde1adc2cb7275a1158c">lbann::lbann_quantizer::NUM_ONEBIT_SAMPLES</a> = 128<code> [static, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Samples to use to approximate column averages in onebit quantization. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00291">291</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a41cdad23feaf0414ad61cf3ceafc5c39"></a><!-- doxytag: member="lbann::lbann_quantizer::NUM_PTA_SAMPLES" ref="a41cdad23feaf0414ad61cf3ceafc5c39" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const int <a class="el" href="classlbann_1_1lbann__quantizer.html#a41cdad23feaf0414ad61cf3ceafc5c39">lbann::lbann_quantizer::NUM_PTA_SAMPLES</a> = 128<code> [static, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Number of samples to use in proportion_threshold_average. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00289">289</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a2a02ef2dbcdfdd262146fff6f34510ac"></a><!-- doxytag: member="lbann::lbann_quantizer::pta_pos_time" ref="a2a02ef2dbcdfdd262146fff6f34510ac" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classlbann_1_1lbann__quantizer.html#a2a02ef2dbcdfdd262146fff6f34510ac">lbann::lbann_quantizer::pta_pos_time</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Time spent in proportion_threshold_average_pos. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00320">320</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a74cac02b60940fec951339e9197d8463"></a><!-- doxytag: member="lbann::lbann_quantizer::pta_time" ref="a74cac02b60940fec951339e9197d8463" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classlbann_1_1lbann__quantizer.html#a74cac02b60940fec951339e9197d8463">lbann::lbann_quantizer::pta_time</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Time spent in proportion_threshold_average. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00318">318</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a9b02b1adbc432e0d5b417ad6e098ed75"></a><!-- doxytag: member="lbann::lbann_quantizer::rs_bytes_received" ref="a9b02b1adbc432e0d5b417ad6e098ed75" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t <a class="el" href="classlbann_1_1lbann__quantizer.html#a9b02b1adbc432e0d5b417ad6e098ed75">lbann::lbann_quantizer::rs_bytes_received</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Bytes received in doing the reduce-scatter. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00298">298</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a484e392b671e8eeaa3af5b5faa683bee"></a><!-- doxytag: member="lbann::lbann_quantizer::rs_bytes_sent" ref="a484e392b671e8eeaa3af5b5faa683bee" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t <a class="el" href="classlbann_1_1lbann__quantizer.html#a484e392b671e8eeaa3af5b5faa683bee">lbann::lbann_quantizer::rs_bytes_sent</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Bytes sent in doing the reduce-scatter. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00294">294</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a7fa4275835362b7d9ec91201f4f73436"></a><!-- doxytag: member="lbann::lbann_quantizer::rs_recv_buf_time" ref="a7fa4275835362b7d9ec91201f4f73436" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classlbann_1_1lbann__quantizer.html#a7fa4275835362b7d9ec91201f4f73436">lbann::lbann_quantizer::rs_recv_buf_time</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Time spent in the reduce-scatter get_recv_buf. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00308">308</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a81db6fb79472d86023dd470c2948ea5a"></a><!-- doxytag: member="lbann::lbann_quantizer::rs_recv_trans_time" ref="a81db6fb79472d86023dd470c2948ea5a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classlbann_1_1lbann__quantizer.html#a81db6fb79472d86023dd470c2948ea5a">lbann::lbann_quantizer::rs_recv_trans_time</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Time spent in the reduce-scatter recv_trans. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00310">310</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a824b8b6d8964621e6a02aee94c38332a"></a><!-- doxytag: member="lbann::lbann_quantizer::rs_send_trans_time" ref="a824b8b6d8964621e6a02aee94c38332a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classlbann_1_1lbann__quantizer.html#a824b8b6d8964621e6a02aee94c38332a">lbann::lbann_quantizer::rs_send_trans_time</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Time spent in the reduce-scatter send_trans. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00306">306</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="aa25d9dbcc7af16370142f46a6c23d178"></a><!-- doxytag: member="lbann::lbann_quantizer::rs_time" ref="aa25d9dbcc7af16370142f46a6c23d178" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classlbann_1_1lbann__quantizer.html#aa25d9dbcc7af16370142f46a6c23d178">lbann::lbann_quantizer::rs_time</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Time spent in the reduce-scatter. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00302">302</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>include/lbann/utils/<a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a></li>
<li>src/utils/<a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 21 Sep 2016 for LBANN by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
