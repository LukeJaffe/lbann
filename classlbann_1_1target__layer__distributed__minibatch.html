<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>LBANN: lbann::target_layer_distributed_minibatch Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
  <div class="navpath"><a class="el" href="namespacelbann.html">lbann</a>::<a class="el" href="classlbann_1_1target__layer__distributed__minibatch.html">target_layer_distributed_minibatch</a>
  </div>
<div class="contents">
<h1>lbann::target_layer_distributed_minibatch Class Reference</h1><!-- doxytag: class="lbann::target_layer_distributed_minibatch" --><!-- doxytag: inherits="lbann::target_layer" -->
<p><code>#include &lt;<a class="el" href="lbann__target__layer__distributed__minibatch_8hpp_source.html">lbann_target_layer_distributed_minibatch.hpp</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for lbann::target_layer_distributed_minibatch:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1target__layer__distributed__minibatch__inherit__graph.png" border="0" usemap="#lbann_1_1target__layer__distributed__minibatch_inherit__map" alt="Inheritance graph"/></div>
<map name="lbann_1_1target__layer__distributed__minibatch_inherit__map" id="lbann_1_1target__layer__distributed__minibatch_inherit__map">
<area shape="rect" id="node2" href="classlbann_1_1target__layer.html" title="lbann::target_layer" alt="" coords="71,160,199,189"/><area shape="rect" id="node4" href="classlbann_1_1io__layer.html" title="lbann::io_layer" alt="" coords="81,83,188,112"/><area shape="rect" id="node6" href="classlbann_1_1Layer.html" title="lbann::Layer" alt="" coords="88,5,181,35"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for lbann::target_layer_distributed_minibatch:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1target__layer__distributed__minibatch__coll__graph.png" border="0" usemap="#lbann_1_1target__layer__distributed__minibatch_coll__map" alt="Collaboration graph"/></div>
<map name="lbann_1_1target__layer__distributed__minibatch_coll__map" id="lbann_1_1target__layer__distributed__minibatch_coll__map">
<area shape="rect" id="node2" href="classlbann_1_1target__layer.html" title="lbann::target_layer" alt="" coords="320,312,448,341"/><area shape="rect" id="node4" href="classlbann_1_1io__layer.html" title="lbann::io_layer" alt="" coords="331,232,437,261"/><area shape="rect" id="node6" href="classlbann_1_1Layer.html" title="lbann::Layer" alt="" coords="216,101,309,131"/><area shape="rect" id="node8" href="classlbann_1_1lbann__comm.html" title="lbann::lbann_comm" alt="" coords="5,5,139,35"/><area shape="rect" id="node10" href="classlbann_1_1Optimizer.html" title="lbann::Optimizer" alt="" coords="163,5,280,35"/><area shape="rect" id="node12" href="classlbann_1_1Activation.html" title="lbann::Activation" alt="" coords="304,5,421,35"/><area shape="rect" id="node14" href="classlbann_1_1dataset.html" title="lbann::dataset" alt="" coords="416,101,520,131"/><area shape="rect" id="node16" href="classlbann_1_1DataReader.html" title="lbann::DataReader" alt="" coords="445,5,576,35"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="classlbann_1_1target__layer__distributed__minibatch-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1target__layer__distributed__minibatch.html#a4dc5c8b6d96aecf1fa6cc71e1cbdadf6">target_layer_distributed_minibatch</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="classlbann_1_1Layer.html#ad20dd05617ed950162e0fdb95bc23096">comm</a>, <a class="el" href="datatype_8hpp.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> mini_batch_size, std::map&lt; <a class="el" href="lbann__base_8hpp.html#a2781a159088df64ed7d47cc91c4dc0a8">execution_mode</a>, <a class="el" href="classlbann_1_1DataReader.html">DataReader</a> * &gt; data_readers, bool shared_data_reader)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1target__layer__distributed__minibatch.html#ae10872bc60397e7fbb658c4cd2682856">setup</a> (int num_prev_neurons)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1target__layer__distributed__minibatch.html#ac65d7338c511d59e5f8e779bd7688919">forwardProp</a> (<a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> prev_WBL2NormSum)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1target__layer__distributed__minibatch.html#a3c8d6cabd1c46c755d47d542306abb0e">backProp</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1target__layer__distributed__minibatch.html#a9e6fb3d242f50ca174110f238d75a2f8">update</a> ()</td></tr>
<tr><td colspan="2"><h2>Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1target__layer__distributed__minibatch.html#a6bf7e2865e7f2709a3f74536d0c51051">m_root</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1target__layer__distributed__minibatch.html#a801eafa531cbddd89471be22486964df">Y_local</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="lbann__base_8hpp.html#aaf89a79f1476644edba844c4937abbcc">CircMat</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1target__layer__distributed__minibatch.html#aca27db2bd7309faa315aad8865c0601e">Ys</a></td></tr>
<tr><td colspan="2"><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1target__layer__distributed__minibatch.html#a0047bd2bb048191a795e90292e166dd2">fp_linearity</a> (<a class="el" href="lbann__base_8hpp.html#afad88fb587c304caea8a36ee5a5c1df8">ElMat</a> &amp;, <a class="el" href="lbann__base_8hpp.html#afad88fb587c304caea8a36ee5a5c1df8">ElMat</a> &amp;, <a class="el" href="lbann__base_8hpp.html#afad88fb587c304caea8a36ee5a5c1df8">ElMat</a> &amp;, <a class="el" href="lbann__base_8hpp.html#afad88fb587c304caea8a36ee5a5c1df8">ElMat</a> &amp;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1target__layer__distributed__minibatch.html#ac11ebdf14a5e943e9fe77b5ce5667639">bp_linearity</a> ()</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>

<p>Definition at line <a class="el" href="lbann__target__layer__distributed__minibatch_8hpp_source.html#l00034">34</a> of file <a class="el" href="lbann__target__layer__distributed__minibatch_8hpp_source.html">lbann_target_layer_distributed_minibatch.hpp</a>.</p>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a4dc5c8b6d96aecf1fa6cc71e1cbdadf6"></a><!-- doxytag: member="lbann::target_layer_distributed_minibatch::target_layer_distributed_minibatch" ref="a4dc5c8b6d96aecf1fa6cc71e1cbdadf6" args="(lbann_comm *comm, uint mini_batch_size, std::map&lt; execution_mode, DataReader * &gt; data_readers, bool shared_data_reader)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">lbann::target_layer_distributed_minibatch::target_layer_distributed_minibatch </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&nbsp;</td>
          <td class="paramname"> <em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="datatype_8hpp.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>&nbsp;</td>
          <td class="paramname"> <em>mini_batch_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::map&lt; <a class="el" href="lbann__base_8hpp.html#a2781a159088df64ed7d47cc91c4dc0a8">execution_mode</a>, <a class="el" href="classlbann_1_1DataReader.html">DataReader</a> * &gt;&nbsp;</td>
          <td class="paramname"> <em>data_readers</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>shared_data_reader</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lbann__target__layer__distributed__minibatch_8cpp_source.html#l00036">36</a> of file <a class="el" href="lbann__target__layer__distributed__minibatch_8cpp_source.html">lbann_target_layer_distributed_minibatch.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00037"></a>00037   : <a class="code" href="classlbann_1_1target__layer.html#aa14c73d9d7ba12f718cf7f8ed0137c93">target_layer</a>(<a class="code" href="classlbann_1_1Layer.html#ad20dd05617ed950162e0fdb95bc23096">comm</a>, mini_batch_size, data_readers, shared_data_reader), <a class="code" href="classlbann_1_1target__layer__distributed__minibatch.html#aca27db2bd7309faa315aad8865c0601e">Ys</a>(<a class="code" href="classlbann_1_1Layer.html#ad20dd05617ed950162e0fdb95bc23096">comm</a>-&gt;get_model_grid())
<a name="l00038"></a>00038 {
<a name="l00039"></a>00039   <span class="comment">//  Index = index;</span>
<a name="l00040"></a>00040   <a class="code" href="classlbann_1_1target__layer__distributed__minibatch.html#a6bf7e2865e7f2709a3f74536d0c51051">m_root</a> = 0;
<a name="l00041"></a>00041   <span class="comment">//  NumNeurons = m_training_data_reader-&gt;get_linearized_label_size(); /// @todo NumNeurons should be hidden inside of an accessor function</span>
<a name="l00042"></a>00042 }
</pre></div></p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a3c8d6cabd1c46c755d47d542306abb0e"></a><!-- doxytag: member="lbann::target_layer_distributed_minibatch::backProp" ref="a3c8d6cabd1c46c755d47d542306abb0e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::target_layer_distributed_minibatch::backProp </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><p>Copy the results to the Ds_Temp variable for access by the next lower layer </p>
</p>

<p>Reimplemented from <a class="el" href="classlbann_1_1Layer.html#a07f230d516c76f22ff42addb542424af">lbann::Layer</a>.</p>

<p>Definition at line <a class="el" href="lbann__target__layer__distributed__minibatch_8cpp_source.html#l00111">111</a> of file <a class="el" href="lbann__target__layer__distributed__minibatch_8cpp_source.html">lbann_target_layer_distributed_minibatch.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00111"></a>00111                                                        {
<a name="l00113"></a>00113   Copy(<a class="code" href="classlbann_1_1target__layer__distributed__minibatch.html#aca27db2bd7309faa315aad8865c0601e">Ys</a>, *<a class="code" href="classlbann_1_1Layer.html#a34f5517610ada7dd06205cb97d97b369">Ds_Temp</a>);
<a name="l00114"></a>00114 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac11ebdf14a5e943e9fe77b5ce5667639"></a><!-- doxytag: member="lbann::target_layer_distributed_minibatch::bp_linearity" ref="ac11ebdf14a5e943e9fe77b5ce5667639" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::target_layer_distributed_minibatch::bp_linearity </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Handle the layer's linearity in backward propagation. </p>

<p>Reimplemented from <a class="el" href="classlbann_1_1Layer.html#a3cadcd93ddac0f0231449181a72edf1b">lbann::Layer</a>.</p>

<p>Definition at line <a class="el" href="lbann__target__layer__distributed__minibatch_8hpp_source.html#l00050">50</a> of file <a class="el" href="lbann__target__layer__distributed__minibatch_8hpp_source.html">lbann_target_layer_distributed_minibatch.hpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00050"></a>00050 {}
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac65d7338c511d59e5f8e779bd7688919"></a><!-- doxytag: member="lbann::target_layer_distributed_minibatch::forwardProp" ref="ac65d7338c511d59e5f8e779bd7688919" args="(DataType prev_WBL2NormSum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> lbann::target_layer_distributed_minibatch::forwardProp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&nbsp;</td>
          <td class="paramname"> <em>prev_WBL2NormSum</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000011">Todo:</a></b></dt><dd>update this to use the new fp_linearity framework </dd></dl>

<p><p>Check to see if the predicted results match the target results</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000012">Todo:</a></b></dt><dd>this needs to be optimized so that it is done locally first then aggregated </dd></dl>
</p>

<p>Reimplemented from <a class="el" href="classlbann_1_1Layer.html#a9bc5072a0c4105cce6f3526845abd07f">lbann::Layer</a>.</p>

<p>Definition at line <a class="el" href="lbann__target__layer__distributed__minibatch_8cpp_source.html#l00066">66</a> of file <a class="el" href="lbann__target__layer__distributed__minibatch_8cpp_source.html">lbann_target_layer_distributed_minibatch.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00066"></a>00066                                                                                        {
<a name="l00067"></a>00067   DataReader *data_reader = <a class="code" href="classlbann_1_1io__layer.html#ae400abb9ed5e3ad2c8df1efc0168bc0a">target_layer::select_data_reader</a>();
<a name="l00068"></a>00068 
<a name="l00069"></a>00069   <span class="keywordflow">if</span> (<a class="code" href="classlbann_1_1Layer.html#ad20dd05617ed950162e0fdb95bc23096">comm</a>-&gt;get_rank_in_model() == <a class="code" href="classlbann_1_1target__layer__distributed__minibatch.html#a6bf7e2865e7f2709a3f74536d0c51051">m_root</a>) {
<a name="l00070"></a>00070     Zero(<a class="code" href="classlbann_1_1target__layer__distributed__minibatch.html#a801eafa531cbddd89471be22486964df">Y_local</a>);
<a name="l00071"></a>00071     data_reader-&gt;fetch_label(<a class="code" href="classlbann_1_1target__layer__distributed__minibatch.html#a801eafa531cbddd89471be22486964df">Y_local</a>);
<a name="l00072"></a>00072   }
<a name="l00073"></a>00073 
<a name="l00074"></a>00074   <span class="keywordflow">if</span> (<a class="code" href="classlbann_1_1Layer.html#ad20dd05617ed950162e0fdb95bc23096">comm</a>-&gt;get_rank_in_model() == <a class="code" href="classlbann_1_1target__layer__distributed__minibatch.html#a6bf7e2865e7f2709a3f74536d0c51051">m_root</a>) {
<a name="l00075"></a>00075     CopyFromRoot(<a class="code" href="classlbann_1_1target__layer__distributed__minibatch.html#a801eafa531cbddd89471be22486964df">Y_local</a>, <a class="code" href="classlbann_1_1target__layer__distributed__minibatch.html#aca27db2bd7309faa315aad8865c0601e">Ys</a>);
<a name="l00076"></a>00076   }<span class="keywordflow">else</span> {
<a name="l00077"></a>00077     CopyFromNonRoot(<a class="code" href="classlbann_1_1target__layer__distributed__minibatch.html#aca27db2bd7309faa315aad8865c0601e">Ys</a>);
<a name="l00078"></a>00078   }
<a name="l00079"></a>00079 
<a name="l00080"></a>00080   <a class="code" href="classlbann_1_1Layer.html#ad20dd05617ed950162e0fdb95bc23096">comm</a>-&gt;model_barrier();
<a name="l00081"></a>00081 
<a name="l00083"></a>00083   <span class="keywordtype">int</span> num_errors = 0;
<a name="l00086"></a>00086   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; <a class="code" href="classlbann_1_1target__layer__distributed__minibatch.html#a801eafa531cbddd89471be22486964df">Y_local</a>.Width(); n++) {
<a name="l00087"></a>00087     <span class="keywordtype">int</span> targetidx = -1;
<a name="l00088"></a>00088     <span class="keywordtype">float</span> targetmax = 0;
<a name="l00089"></a>00089     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m = 0; m &lt; <a class="code" href="classlbann_1_1target__layer__distributed__minibatch.html#a801eafa531cbddd89471be22486964df">Y_local</a>.Height(); m++) {
<a name="l00090"></a>00090       <span class="keywordflow">if</span> (targetmax &lt; <a class="code" href="classlbann_1_1target__layer__distributed__minibatch.html#a801eafa531cbddd89471be22486964df">Y_local</a>.Get(m, n)) {
<a name="l00091"></a>00091         targetmax = <a class="code" href="classlbann_1_1target__layer__distributed__minibatch.html#a801eafa531cbddd89471be22486964df">Y_local</a>.Get(m, n);
<a name="l00092"></a>00092         targetidx = m;
<a name="l00093"></a>00093       }
<a name="l00094"></a>00094     }
<a name="l00095"></a>00095     <span class="keywordtype">int</span> labelidx = -1;
<a name="l00096"></a>00096     <span class="keywordtype">float</span> labelmax = 0;
<a name="l00097"></a>00097     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m = 0; m &lt; <a class="code" href="classlbann_1_1Layer.html#aa4f7b14ea6448703edc07ae4e43cb20a">fp_input</a>-&gt;Height(); m++) {
<a name="l00098"></a>00098       <span class="keywordflow">if</span> (labelmax &lt; fp_input-&gt;Get(m, n)) {
<a name="l00099"></a>00099         labelmax = <a class="code" href="classlbann_1_1Layer.html#aa4f7b14ea6448703edc07ae4e43cb20a">fp_input</a>-&gt;Get(m, n);
<a name="l00100"></a>00100         labelidx = m;
<a name="l00101"></a>00101       }
<a name="l00102"></a>00102     }
<a name="l00103"></a>00103     <span class="keywordflow">if</span> (targetidx != labelidx)
<a name="l00104"></a>00104       num_errors++;
<a name="l00105"></a>00105       
<a name="l00106"></a>00106   }
<a name="l00107"></a>00107  
<a name="l00108"></a>00108   <span class="keywordflow">return</span> num_errors;
<a name="l00109"></a>00109 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1target__layer__distributed__minibatch_ac65d7338c511d59e5f8e779bd7688919_cgraph.png" border="0" usemap="#classlbann_1_1target__layer__distributed__minibatch_ac65d7338c511d59e5f8e779bd7688919_cgraph_map" alt=""></div>
<map name="classlbann_1_1target__layer__distributed__minibatch_ac65d7338c511d59e5f8e779bd7688919_cgraph_map" id="classlbann_1_1target__layer__distributed__minibatch_ac65d7338c511d59e5f8e779bd7688919_cgraph">
<area shape="rect" id="node3" href="classlbann_1_1DataReader.html#ab9f0bd6994c5f78b5ea89c9af00fefaf" title="lbann::DataReader::fetch_label" alt="" coords="417,5,620,35"/><area shape="rect" id="node5" href="classlbann_1_1lbann__comm.html#a206bafe522a0962c450f4fc69d030656" title="lbann::lbann_comm::get_rank_in_model" alt="" coords="393,59,644,88"/><area shape="rect" id="node7" href="classlbann_1_1lbann__comm.html#a6086ced12c3eefeea6e2a78eff286983" title="lbann::lbann_comm::model_barrier" alt="" coords="408,112,629,141"/><area shape="rect" id="node9" href="classlbann_1_1io__layer.html#ae400abb9ed5e3ad2c8df1efc0168bc0a" title="lbann::io_layer::select_data_reader" alt="" coords="407,165,631,195"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0047bd2bb048191a795e90292e166dd2"></a><!-- doxytag: member="lbann::target_layer_distributed_minibatch::fp_linearity" ref="a0047bd2bb048191a795e90292e166dd2" args="(ElMat &amp;, ElMat &amp;, ElMat &amp;, ElMat &amp;)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::target_layer_distributed_minibatch::fp_linearity </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#afad88fb587c304caea8a36ee5a5c1df8">ElMat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>_WB</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#afad88fb587c304caea8a36ee5a5c1df8">ElMat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>_X</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#afad88fb587c304caea8a36ee5a5c1df8">ElMat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>_Z</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#afad88fb587c304caea8a36ee5a5c1df8">ElMat</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>_Y</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Apply the layer's linear update in forward propagation. </p>

<p>Reimplemented from <a class="el" href="classlbann_1_1Layer.html#ae9e1c671ec408bdd539ec728ce1e8b28">lbann::Layer</a>.</p>

<p>Definition at line <a class="el" href="lbann__target__layer__distributed__minibatch_8hpp_source.html#l00049">49</a> of file <a class="el" href="lbann__target__layer__distributed__minibatch_8hpp_source.html">lbann_target_layer_distributed_minibatch.hpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00049"></a>00049 {}
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae10872bc60397e7fbb658c4cd2682856"></a><!-- doxytag: member="lbann::target_layer_distributed_minibatch::setup" ref="ae10872bc60397e7fbb658c4cd2682856" args="(int num_prev_neurons)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::target_layer_distributed_minibatch::setup </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>num_prev_neurons</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><p>If the target layer shares a data reader with an input layer, do not setup the data reader a second time</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000010">Todo:</a></b></dt><dd>put in warning about bad target size </dd></dl>
</p>

<p>Reimplemented from <a class="el" href="classlbann_1_1Layer.html#a20442464265da1cb2aeb1cf82640702f">lbann::Layer</a>.</p>

<p>Definition at line <a class="el" href="lbann__target__layer__distributed__minibatch_8cpp_source.html#l00044">44</a> of file <a class="el" href="lbann__target__layer__distributed__minibatch_8cpp_source.html">lbann_target_layer_distributed_minibatch.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00044"></a>00044                                                                         {
<a name="l00045"></a>00045   <span class="keywordflow">if</span>(!<a class="code" href="classlbann_1_1target__layer.html#a576266beaf97c614d8f5f3a3ae005b0d">m_shared_data_reader</a>) { 
<a name="l00046"></a>00046     <span class="keywordflow">if</span>(<a class="code" href="classlbann_1_1io__layer.html#a8ce9b172521bbcf55c1040a3c28719b1">io_layer::m_data_sets_span_models</a>) {
<a name="l00047"></a>00047       <a class="code" href="classlbann_1_1io__layer.html#af28dac8d9a030b3554c460722236d067">io_layer::setup_data_readers</a>(0, <a class="code" href="classlbann_1_1Layer.html#ad20dd05617ed950162e0fdb95bc23096">Layer::comm</a>-&gt;get_num_models() * <a class="code" href="classlbann_1_1Layer.html#a30aaa195765788f649ce70e855a74081">Layer::m_mini_batch_size</a>,
<a name="l00048"></a>00048                                    <a class="code" href="classlbann_1_1Layer.html#ad20dd05617ed950162e0fdb95bc23096">Layer::comm</a>-&gt;get_model_rank() * <a class="code" href="classlbann_1_1Layer.html#a30aaa195765788f649ce70e855a74081">Layer::m_mini_batch_size</a>);
<a name="l00049"></a>00049     }<span class="keywordflow">else</span> {
<a name="l00050"></a>00050       <a class="code" href="classlbann_1_1io__layer.html#af28dac8d9a030b3554c460722236d067">io_layer::setup_data_readers</a>(0, <a class="code" href="classlbann_1_1Layer.html#a30aaa195765788f649ce70e855a74081">m_mini_batch_size</a>);
<a name="l00051"></a>00051     }
<a name="l00052"></a>00052   }
<a name="l00053"></a>00053 
<a name="l00055"></a>00055   <span class="keywordflow">if</span>(num_prev_neurons != <a class="code" href="classlbann_1_1Layer.html#a9d4a379d5c9e1102e63b48c53dd8ed44">NumNeurons</a>) {
<a name="l00056"></a>00056     <span class="keywordflow">throw</span> -1;
<a name="l00057"></a>00057   }
<a name="l00058"></a>00058 
<a name="l00059"></a>00059   Zeros(*<a class="code" href="classlbann_1_1Layer.html#a34f5517610ada7dd06205cb97d97b369">Ds_Temp</a>, <a class="code" href="classlbann_1_1Layer.html#a9d4a379d5c9e1102e63b48c53dd8ed44">NumNeurons</a>, <a class="code" href="classlbann_1_1Layer.html#a30aaa195765788f649ce70e855a74081">m_mini_batch_size</a>);
<a name="l00060"></a>00060   Zeros(<a class="code" href="classlbann_1_1target__layer__distributed__minibatch.html#a801eafa531cbddd89471be22486964df">Y_local</a>, <a class="code" href="classlbann_1_1Layer.html#a9d4a379d5c9e1102e63b48c53dd8ed44">NumNeurons</a>, <a class="code" href="classlbann_1_1Layer.html#a30aaa195765788f649ce70e855a74081">m_mini_batch_size</a>);
<a name="l00061"></a>00061   Zeros(<a class="code" href="classlbann_1_1target__layer__distributed__minibatch.html#aca27db2bd7309faa315aad8865c0601e">Ys</a>, <a class="code" href="classlbann_1_1Layer.html#a9d4a379d5c9e1102e63b48c53dd8ed44">NumNeurons</a>, <a class="code" href="classlbann_1_1Layer.html#a30aaa195765788f649ce70e855a74081">m_mini_batch_size</a>);
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1target__layer__distributed__minibatch_ae10872bc60397e7fbb658c4cd2682856_cgraph.png" border="0" usemap="#classlbann_1_1target__layer__distributed__minibatch_ae10872bc60397e7fbb658c4cd2682856_cgraph_map" alt=""></div>
<map name="classlbann_1_1target__layer__distributed__minibatch_ae10872bc60397e7fbb658c4cd2682856_cgraph_map" id="classlbann_1_1target__layer__distributed__minibatch_ae10872bc60397e7fbb658c4cd2682856_cgraph">
<area shape="rect" id="node3" href="classlbann_1_1io__layer.html#af28dac8d9a030b3554c460722236d067" title="lbann::io_layer::setup_data_readers" alt="" coords="353,165,580,195"/><area shape="rect" id="node5" href="classlbann_1_1DataReader.html#a85a3d25b8c7510565dec4e3346e676f6" title="lbann::DataReader::setup" alt="" coords="629,165,800,195"/><area shape="rect" id="node7" href="classlbann_1_1DataReader.html#a6ca8592b2271ceaac8cb1e29dbecbb82" title="lbann::DataReader::calculate_multi_model_data_distribution" alt="" coords="848,139,1219,168"/><area shape="rect" id="node23" href="namespacelbann.html#a4fea7ba21017b49d1e34394b4c20c764" title="lbann::get_generator" alt="" coords="964,192,1103,221"/><area shape="rect" id="node9" href="classlbann_1_1lbann__comm.html#adb87fdc17095efd8e4dcb343357a6ba5" title="lbann::lbann_comm::am_world_master" alt="" coords="1271,32,1516,61"/><area shape="rect" id="node15" href="classlbann_1_1lbann__comm.html#a6c201108eb6b5a1e23021db29cef655b" title="lbann::lbann_comm::get_model_rank" alt="" coords="1276,85,1511,115"/><area shape="rect" id="node17" href="classlbann_1_1lbann__comm.html#a54842b679a3756cf79b43baf46caf637" title="lbann::lbann_comm::get_num_models" alt="" coords="1272,139,1515,168"/><area shape="rect" id="node19" href="classlbann_1_1lbann__comm.html#a206bafe522a0962c450f4fc69d030656" title="lbann::lbann_comm::get_rank_in_model" alt="" coords="1268,192,1519,221"/><area shape="rect" id="node21" href="classlbann_1_1DataReader.html#a78d3f20a5ab7628011068127ea8b4028" title="lbann::DataReader::getNumData" alt="" coords="1287,245,1500,275"/><area shape="rect" id="node11" href="classlbann_1_1lbann__comm.html#a615265cd20ffb4863089bb94e4c82fe7" title="lbann::lbann_comm::get_rank_in_world" alt="" coords="1568,5,1816,35"/><area shape="rect" id="node13" href="classlbann_1_1lbann__comm.html#ac1bcd6a5e38ad3a7e86171435642bc9f" title="lbann::lbann_comm::get_world_master" alt="" coords="1569,59,1815,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a9e6fb3d242f50ca174110f238d75a2f8"></a><!-- doxytag: member="lbann::target_layer_distributed_minibatch::update" ref="a9e6fb3d242f50ca174110f238d75a2f8" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool lbann::target_layer_distributed_minibatch::update </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Once a mini-batch is processed, resuffle the data for the next batch if necessary </p>

<p><p>If the data reader is shared with an input layer, don't update the reader </p>
</p>

<p>Reimplemented from <a class="el" href="classlbann_1_1Layer.html#a0fbb376cebdaa4692fdc92df34bb366c">lbann::Layer</a>.</p>

<p>Definition at line <a class="el" href="lbann__target__layer__distributed__minibatch_8cpp_source.html#l00119">119</a> of file <a class="el" href="lbann__target__layer__distributed__minibatch_8cpp_source.html">lbann_target_layer_distributed_minibatch.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00119"></a>00119                                                      {
<a name="l00120"></a>00120   DataReader *data_reader = <a class="code" href="classlbann_1_1io__layer.html#ae400abb9ed5e3ad2c8df1efc0168bc0a">target_layer::select_data_reader</a>();
<a name="l00121"></a>00121   <span class="keywordflow">if</span>(<a class="code" href="classlbann_1_1target__layer.html#a576266beaf97c614d8f5f3a3ae005b0d">m_shared_data_reader</a>) { 
<a name="l00122"></a>00122     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00123"></a>00123   }<span class="keywordflow">else</span> {
<a name="l00124"></a>00124     <span class="keywordflow">return</span> data_reader-&gt;update();
<a name="l00125"></a>00125   }
<a name="l00126"></a>00126 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="classlbann_1_1target__layer__distributed__minibatch_a9e6fb3d242f50ca174110f238d75a2f8_cgraph.png" border="0" usemap="#classlbann_1_1target__layer__distributed__minibatch_a9e6fb3d242f50ca174110f238d75a2f8_cgraph_map" alt=""></div>
<map name="classlbann_1_1target__layer__distributed__minibatch_a9e6fb3d242f50ca174110f238d75a2f8_cgraph_map" id="classlbann_1_1target__layer__distributed__minibatch_a9e6fb3d242f50ca174110f238d75a2f8_cgraph">
<area shape="rect" id="node3" href="classlbann_1_1io__layer.html#ae400abb9ed5e3ad2c8df1efc0168bc0a" title="lbann::io_layer::select_data_reader" alt="" coords="360,5,584,35"/><area shape="rect" id="node5" href="classlbann_1_1DataReader.html#a3918f2ec31f985ce49fa5778db2ad4ba" title="lbann::DataReader::update" alt="" coords="383,59,561,88"/><area shape="rect" id="node7" href="namespacelbann.html#a4fea7ba21017b49d1e34394b4c20c764" title="lbann::get_generator" alt="" coords="633,59,772,88"/></map>
</div>
</p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a6bf7e2865e7f2709a3f74536d0c51051"></a><!-- doxytag: member="lbann::target_layer_distributed_minibatch::m_root" ref="a6bf7e2865e7f2709a3f74536d0c51051" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classlbann_1_1target__layer__distributed__minibatch.html#a6bf7e2865e7f2709a3f74536d0c51051">lbann::target_layer_distributed_minibatch::m_root</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lbann__target__layer__distributed__minibatch_8hpp_source.html#l00045">45</a> of file <a class="el" href="lbann__target__layer__distributed__minibatch_8hpp_source.html">lbann_target_layer_distributed_minibatch.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a801eafa531cbddd89471be22486964df"></a><!-- doxytag: member="lbann::target_layer_distributed_minibatch::Y_local" ref="a801eafa531cbddd89471be22486964df" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> <a class="el" href="classlbann_1_1target__layer__distributed__minibatch.html#a801eafa531cbddd89471be22486964df">lbann::target_layer_distributed_minibatch::Y_local</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lbann__target__layer__distributed__minibatch_8hpp_source.html#l00046">46</a> of file <a class="el" href="lbann__target__layer__distributed__minibatch_8hpp_source.html">lbann_target_layer_distributed_minibatch.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="aca27db2bd7309faa315aad8865c0601e"></a><!-- doxytag: member="lbann::target_layer_distributed_minibatch::Ys" ref="aca27db2bd7309faa315aad8865c0601e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="lbann__base_8hpp.html#aaf89a79f1476644edba844c4937abbcc">CircMat</a> <a class="el" href="classlbann_1_1target__layer__distributed__minibatch.html#aca27db2bd7309faa315aad8865c0601e">lbann::target_layer_distributed_minibatch::Ys</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lbann__target__layer__distributed__minibatch_8hpp_source.html#l00047">47</a> of file <a class="el" href="lbann__target__layer__distributed__minibatch_8hpp_source.html">lbann_target_layer_distributed_minibatch.hpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>include/lbann/layers/<a class="el" href="lbann__target__layer__distributed__minibatch_8hpp_source.html">lbann_target_layer_distributed_minibatch.hpp</a></li>
<li>src/layers/<a class="el" href="lbann__target__layer__distributed__minibatch_8cpp_source.html">lbann_target_layer_distributed_minibatch.cpp</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 21 Sep 2016 for LBANN by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
